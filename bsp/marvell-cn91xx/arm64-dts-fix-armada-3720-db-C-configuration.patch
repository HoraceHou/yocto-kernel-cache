From b8d14fedfce243fcb24f942d2176b4e65ef90e22 Mon Sep 17 00:00:00 2001
From: Yelena Krivosheev <yelena@marvell.com>
Date: Mon, 17 Sep 2018 14:55:42 +0300
Subject: [PATCH 0712/1051] arm64: dts: fix armada-3720-db-C configuration

In armada-3720-db-C eth1 is 2.5G port and can be
described like inband port with PHY mode:
   phy-mode = "2500base-x";
   managed = "in-band-status";

Change-Id: I8a8b25f1ae35184f5305f5e185195bc2901783f6
Signed-off-by: Yelena Krivosheev <yelena@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/60228
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Igal Liberman <igall@marvell.com>
[Kevin: The original patch got from Marvell sdk10.0_19.06]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 .../boot/dts/marvell/armada-3720-db-B.dts     |  1 +
 .../boot/dts/marvell/armada-3720-db-C.dts     | 20 +++++--------------
 2 files changed, 6 insertions(+), 15 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/armada-3720-db-B.dts b/arch/arm64/boot/dts/marvell/armada-3720-db-B.dts
index 8c1bdd6bdb0b..6b2e9d53ddca 100644
--- a/arch/arm64/boot/dts/marvell/armada-3720-db-B.dts
+++ b/arch/arm64/boot/dts/marvell/armada-3720-db-B.dts
@@ -8,6 +8,7 @@
 /* This file enables eth1 to work on SERDES SGMII1 interface and
  * use SMI to do PHY polling, meanwhile eth0 still works on RGMII mode.
  */
+/* Gigabit module on CON18(V2.0)/CON20(V1.4) */
 &eth1 {
 	status = "okay";
 	/* Generic PHY, providing serdes lanes */
diff --git a/arch/arm64/boot/dts/marvell/armada-3720-db-C.dts b/arch/arm64/boot/dts/marvell/armada-3720-db-C.dts
index 87670ea9fa94..937f4ea91185 100644
--- a/arch/arm64/boot/dts/marvell/armada-3720-db-C.dts
+++ b/arch/arm64/boot/dts/marvell/armada-3720-db-C.dts
@@ -5,23 +5,13 @@
  */
 
 #include "armada-3720-db.dts"
-/* This file enables eth1 to work in SGMII mode with 1g or 2.5g fixed-link,
+/* This file enables eth1 to work in SGMII mode with 1g or 2.5g,
  * eth0 still works in RGMII mode.
  */
 &eth1 {
 	status = "okay";
-	fixed-link {
-		/*
-		 * Here "speed" is set to 1000, GBE MAC is running in 1G mode,
-		 * but the actual MAC speed may be 1 Gbps or 2.5 Gbps,
-		 * it's up to the corresponding SERDES speed in u-boot fdt
-		 * comphy node.
-		 * If SERDES speed is set to 3.125G in u-boot, it implies sgmii
-		 * 2.5 Gbps;
-		 * if SERDES speed is set to 1.25G in u-boot, it implies sgmii 1
-		 * Gbps.
-		 */
-		speed = <1000>;
-		full-duplex;
-	};
+	phy-mode = "2500base-x";
+	/* Generic PHY, providing serdes lanes */
+	phys = <&a3700_comphy0 1>;
+	managed = "in-band-status";
 };
-- 
2.17.1

