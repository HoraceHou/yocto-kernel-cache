From 4d5b8fd8010cb0b652b95c6c9bc696172c32cea6 Mon Sep 17 00:00:00 2001
From: Radha Mohan Chintakuntla <radhac@marvell.com>
Date: Wed, 29 Aug 2018 14:29:06 -0700
Subject: [PATCH 0178/1051] gpio: thunderx: Remove char device when exiting
 driver

Previous patch "gpio: thunderx: Add support for EL0 interrupts for GPIO"
was missing the cleanup part that removes the special character device
when the driver is exiting.

Signed-off-by: Radha Mohan Chintakuntla <radhac@marvell.com>
[Kevin: The original patch got from Marvell sdk10.0_19.06]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/gpio/gpio-thunderx.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/drivers/gpio/gpio-thunderx.c b/drivers/gpio/gpio-thunderx.c
index e90c06249cb9..2f88eea46b43 100644
--- a/drivers/gpio/gpio-thunderx.c
+++ b/drivers/gpio/gpio-thunderx.c
@@ -885,6 +885,13 @@ static void thunderx_gpio_remove(struct pci_dev *pdev)
 	irq_domain_remove(txgpio->irqd);
 
 	pci_set_drvdata(pdev, NULL);
+
+	device_destroy(otx_class, otx_dev);
+	class_destroy(otx_class);
+	cdev_del(otx_cdev);
+	unregister_chrdev_region(otx_dev, 1);
+
+	task_cleanup_handler_remove(cleanup_el3_irqs);
 }
 
 static const struct pci_device_id thunderx_gpio_id_table[] = {
-- 
2.17.1

