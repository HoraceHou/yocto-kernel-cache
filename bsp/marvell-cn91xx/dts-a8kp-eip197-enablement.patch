From 4b6178092b9c698c2048ad634ab0ac999bd4dde8 Mon Sep 17 00:00:00 2001
From: Ofer Heifetz <oferh@marvell.com>
Date: Tue, 15 May 2018 16:46:01 +0300
Subject: [PATCH 0624/1051] dts: a8kp: eip197 enablement

Change-Id: Ib54810b502f5c68933800c670b5d97da5d1a4d7f
Signed-off-by: Ofer Heifetz <oferh@marvell.com>
[Kevin: The original patch got from Marvell sdk10.0_19.06]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 arch/arm64/boot/dts/marvell/armada-8082.dtsi  |  3 ++-
 arch/arm64/boot/dts/marvell/armada-8084.dtsi  |  3 ++-
 arch/arm64/boot/dts/marvell/armada-8160.dtsi  |  4 ++++
 arch/arm64/boot/dts/marvell/armada-8162.dtsi  |  4 ++++
 arch/arm64/boot/dts/marvell/armada-8164.dtsi  |  3 +++
 arch/arm64/boot/dts/marvell/armada-8320.dtsi  |  8 +++++++
 arch/arm64/boot/dts/marvell/armada-ap810.dtsi | 21 +++++++++++++++++++
 7 files changed, 44 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/armada-8082.dtsi b/arch/arm64/boot/dts/marvell/armada-8082.dtsi
index 87c259ba1a5f..d2fafb92308e 100644
--- a/arch/arm64/boot/dts/marvell/armada-8082.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-8082.dtsi
@@ -51,7 +51,7 @@
 #define AP_NUM					0
 #define AP810_BASE				0xe8000000
 #define AP810_GIC_ITS_BASE			0xf040000
-
+#define AP810_EIP197_INDEX		0
 #include "armada-ap810-octa-core.dtsi"
 
 #define CP110_EIP197_INDEX	CP110_NUM
@@ -84,6 +84,7 @@
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 / {
 	model = "Marvell Armada-8082";
diff --git a/arch/arm64/boot/dts/marvell/armada-8084.dtsi b/arch/arm64/boot/dts/marvell/armada-8084.dtsi
index d4da1eae9be5..417db185b617 100644
--- a/arch/arm64/boot/dts/marvell/armada-8084.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-8084.dtsi
@@ -51,7 +51,7 @@
 #define AP_NUM					0
 #define AP810_BASE				0xe8000000
 #define AP810_GIC_ITS_BASE			0xf040000
-
+#define AP810_EIP197_INDEX		0
 #include "armada-ap810-octa-core.dtsi"
 
 #define CP110_EIP197_INDEX	CP110_NUM
@@ -108,6 +108,7 @@
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 / {
 	model = "Marvell Armada-8084";
diff --git a/arch/arm64/boot/dts/marvell/armada-8160.dtsi b/arch/arm64/boot/dts/marvell/armada-8160.dtsi
index 6654c2624cf9..64d6cf0fe879 100644
--- a/arch/arm64/boot/dts/marvell/armada-8160.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-8160.dtsi
@@ -49,22 +49,26 @@
 #define AP_NUM			0
 #define AP810_BASE		0xe8000000
 #define AP810_GIC_ITS_BASE	0xf040000
+#define AP810_EIP197_INDEX	0
 
 #include "armada-ap810-octa-core.dtsi"
 
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 #define AP_NUM			1
 #define AP810_BASE		0xe4000000
 #define AP810_GIC_ITS_BASE	0xb040000
+#define AP810_EIP197_INDEX	1
 
 #include "armada-ap810-octa-core.dtsi"
 
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 / {
 	model = "Marvell 8160 SoC";
diff --git a/arch/arm64/boot/dts/marvell/armada-8162.dtsi b/arch/arm64/boot/dts/marvell/armada-8162.dtsi
index 0a87d6136861..f32693d93f31 100644
--- a/arch/arm64/boot/dts/marvell/armada-8162.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-8162.dtsi
@@ -51,6 +51,7 @@
 #define AP_NUM				0
 #define AP810_BASE			0xe8000000
 #define AP810_GIC_ITS_BASE		0xf040000
+#define AP810_EIP197_INDEX		0
 #include "armada-ap810-octa-core.dtsi"
 /* CP110-0 Settings */
 #define CP110_NUM		0
@@ -62,10 +63,12 @@
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 #define AP_NUM				1
 #define AP810_BASE			0xe4000000
 #define AP810_GIC_ITS_BASE		0xb040000
+#define AP810_EIP197_INDEX		1
 #include "armada-ap810-octa-core.dtsi"
 
 /* CP110-0 Settings */
@@ -79,6 +82,7 @@
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 / {
 	model = "Marvell Armada-8162";
diff --git a/arch/arm64/boot/dts/marvell/armada-8164.dtsi b/arch/arm64/boot/dts/marvell/armada-8164.dtsi
index e71b7bca3d90..39fe9cf2b9e3 100644
--- a/arch/arm64/boot/dts/marvell/armada-8164.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-8164.dtsi
@@ -51,6 +51,7 @@
 #define AP_NUM				0
 #define AP810_BASE			0xe8000000
 #define AP810_GIC_ITS_BASE		0xf040000
+#define AP810_EIP197_INDEX		0
 #include "armada-ap810-octa-core.dtsi"
 /* CP110-0 Settings */
 #define CP110_NUM		0
@@ -74,6 +75,7 @@
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 #define AP_NUM				1
 #define AP810_BASE			0xe4000000
@@ -82,6 +84,7 @@
  *(0xe4000000+0x3040000) = (0xdc000000+0xb040000) = 0xe7040000
  */
 #define AP810_GIC_ITS_BASE		0xb040000
+#define AP810_EIP197_INDEX		1
 #include "armada-ap810-octa-core.dtsi"
 
 /* CP110-0 Settings */
diff --git a/arch/arm64/boot/dts/marvell/armada-8320.dtsi b/arch/arm64/boot/dts/marvell/armada-8320.dtsi
index 8706c11a464e..16b6cf7cd8fc 100644
--- a/arch/arm64/boot/dts/marvell/armada-8320.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-8320.dtsi
@@ -49,34 +49,42 @@
 #define AP_NUM			0
 #define AP810_BASE		0xe8000000
 #define AP810_GIC_ITS_BASE	0xf040000
+#define AP810_EIP197_INDEX	0
 #include "armada-ap810-octa-core.dtsi"
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 #define AP_NUM			1
 #define AP810_BASE		0xe4000000
 #define AP810_GIC_ITS_BASE	0xb040000
+#define AP810_EIP197_INDEX	1
 #include "armada-ap810-octa-core.dtsi"
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 #define AP_NUM			2
 #define AP810_BASE		0xe0000000
 #define AP810_GIC_ITS_BASE	0x7040000
+#define AP810_EIP197_INDEX	2
 #include "armada-ap810-octa-core.dtsi"
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 #define AP_NUM			3
 #define AP810_BASE		0xdc000000
 #define AP810_GIC_ITS_BASE	0x3040000
+#define AP810_EIP197_INDEX	3
 #include "armada-ap810-octa-core.dtsi"
 #undef AP_NUM
 #undef AP810_BASE
 #undef AP810_GIC_ITS_BASE
+#undef AP810_EIP197_INDEX
 
 / {
 	model = "Marvell 8320 SoC";
diff --git a/arch/arm64/boot/dts/marvell/armada-ap810.dtsi b/arch/arm64/boot/dts/marvell/armada-ap810.dtsi
index 64b90ed7bb07..dce37fd7c2d1 100644
--- a/arch/arm64/boot/dts/marvell/armada-ap810.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-ap810.dtsi
@@ -147,6 +147,27 @@
 				reg-io-width = <1>;
 				status = "disabled";
 			};
+
+			AP810_LABEL(crypto): crypto@700000 {
+				compatible = "inside-secure,safexcel-eip197";
+				reg = <0x700000 0x200000>;
+				dma-coherent;
+				dma-bus-width = <40>;
+				interrupts = <GIC_SPI 36 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 37 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 38 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 39 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 40 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 41 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 42 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 43 IRQ_TYPE_LEVEL_HIGH>,
+					<GIC_SPI 44 IRQ_TYPE_LEVEL_HIGH>;
+				interrupt-names = "ring0", "ring1", "ring2",
+						"ring3", "ring4", "ring5",
+						"ring6", "ring7", "global";
+				cell-index = <AP810_EIP197_INDEX>;
+				status = "okay";
+			};
 		};
 	};
 };
-- 
2.17.1

