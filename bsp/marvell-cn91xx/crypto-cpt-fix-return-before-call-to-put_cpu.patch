From 9a5923f71df38410a1de63834291696a1aa26ed5 Mon Sep 17 00:00:00 2001
From: Lukasz Bartosik <lbartosik@marvell.com>
Date: Thu, 10 Jan 2019 14:34:14 +0100
Subject: [PATCH 0902/1051] crypto: cpt - fix return before call to put_cpu()

Change-Id: I21f21069c469b6ca8e0708715f62264dd45d6e6a
Signed-off-by: Lukasz Bartosik <lukasz.bartosik@cavium.com>
Reviewed-on: https://sj1git1.cavium.com/2678
Tested-by: sa_ip-sw-jenkins
Reviewed-by: Srujana Challa <schalla@cavium.com>
[Kevin: The original patch got from Marvell sdk10.0_19.06]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/crypto/cavium/cpt/common/cpt_algs.c | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/crypto/cavium/cpt/common/cpt_algs.c b/drivers/crypto/cavium/cpt/common/cpt_algs.c
index 400a4cf1b3cb..981b9d4276e5 100644
--- a/drivers/crypto/cavium/cpt/common/cpt_algs.c
+++ b/drivers/crypto/cavium/cpt/common/cpt_algs.c
@@ -49,7 +49,7 @@ static struct cpt_device_table ae_devices = {
 
 static inline int get_se_device(struct pci_dev **pdev, int *cpu_num)
 {
-	int count;
+	int count, err = 0;
 
 	count = atomic_read(&se_devices.count);
 	if (count < 1)
@@ -84,11 +84,11 @@ static inline int get_se_device(struct pci_dev **pdev, int *cpu_num)
 
 	default:
 		pr_err("Unknown PF type %d\n", se_devices.desc[0].pf_type);
-		return -EINVAL;
+		err = -EINVAL;
 	}
 
 	put_cpu();
-	return 0;
+	return err;
 }
 
 static inline int validate_hmac_cipher_null(struct cpt_request_info *cpt_req)
-- 
2.17.1

