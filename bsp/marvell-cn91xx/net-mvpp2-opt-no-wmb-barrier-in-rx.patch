From 5fddbe7fd28aabd31c7679c8af058410230ebf27 Mon Sep 17 00:00:00 2001
From: Yan Markman <ymarkman@marvell.com>
Date: Sun, 5 Aug 2018 13:21:23 +0300
Subject: [PATCH 0543/1051] net: mvpp2: opt no wmb barrier in rx

Explicit wmb barrier in rx data path
- it is not needed before HW-RX update
- it is present in HW-RX update inside of writel
The removing wdb improves CPU-utilization for ~2%.

Change-Id: Ia2329158038fe9a63b087a2a541eb6705fca45d4
Signed-off-by: Yan Markman <ymarkman@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/59473
Reviewed-by: Stefan Chulski <stefanc@marvell.com>
Tested-by: Stefan Chulski <stefanc@marvell.com>
[Kevin: The original patch got from Marvell sdk10.0_19.06]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/net/ethernet/marvell/mvpp2/mvpp2_main.c | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/marvell/mvpp2/mvpp2_main.c b/drivers/net/ethernet/marvell/mvpp2/mvpp2_main.c
index a84cbd8bc07c..104f70bc0e72 100644
--- a/drivers/net/ethernet/marvell/mvpp2/mvpp2_main.c
+++ b/drivers/net/ethernet/marvell/mvpp2/mvpp2_main.c
@@ -2868,8 +2868,7 @@ static int mvpp2_rx(struct mvpp2_port *port, struct napi_struct *napi,
 		u64_stats_update_end(&stats->syncp);
 	}
 
-	/* Update Rx queue management counters */
-	wmb();
+	/* Update HW Rx queue management counters with RX-done */
 	mvpp2_rxq_status_update(port, rxq->id, rx_done, rx_done);
 
 	return rx_todo;
-- 
2.17.1

