From 780fdc21592523db76bdeb0f6fb0e03f8d5d712d Mon Sep 17 00:00:00 2001
From: Peter Swain <peter.swain@cavium.com>
Date: Thu, 7 Jun 2018 19:05:45 -0700
Subject: [PATCH 0348/1051] mtd: cavium_nand: disable BCH on early cn81xx

Signed-off-by: Peter Swain <peter.swain@cavium.com>
Signed-off-by: Yury Norov <ynorov@caviumnetworks.com>
[Kevin: The original patch got from Marvell sdk10.0_19.06]
Signed-off-by: Kevin Hao <kexin.hao@windriver.com>
---
 drivers/mtd/nand/raw/cavium/bch_pf.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/mtd/nand/raw/cavium/bch_pf.c b/drivers/mtd/nand/raw/cavium/bch_pf.c
index 4e4659cd242c..e7138a102e28 100644
--- a/drivers/mtd/nand/raw/cavium/bch_pf.c
+++ b/drivers/mtd/nand/raw/cavium/bch_pf.c
@@ -187,6 +187,11 @@ static int bch_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
 	struct bch_device *bch;
 	int err;
 
+	/* unsafe on CN81XX pass 1.0/1.1 */
+	if (MIDR_IS_CPU_MODEL_RANGE(read_cpuid_id(),
+			MIDR_OCTEON_T81, 0x00, 0x01))
+		return -ENODEV;
+
 	bch = devm_kzalloc(dev, sizeof(*bch), GFP_KERNEL);
 	if (!bch)
 		return -ENOMEM;
-- 
2.17.1

