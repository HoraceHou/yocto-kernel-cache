From 2c7ad31df04dc132ed0ca8067822274539bf5484 Mon Sep 17 00:00:00 2001
From: Angela Czubak <aczubak@marvell.com>
Date: Thu, 23 May 2019 16:39:20 +0200
Subject: [PATCH 253/386] octeontx: fix bgx_port_config

Make this function fill promiscuous field.

Change-Id: Ibc6c24ddb3fde3fbcff9409da40df635064572f8
Signed-off-by: Angela Czubak <aczubak@marvell.com>
Reviewed-on: https://sj1git1.cavium.com/9827
Tested-by: sa_ip-sw-jenkins <sa_ip-sw-jenkins@marvell.com>
Reviewed-by: Sunil Kovvuri Goutham <Sunil.Goutham@cavium.com>
Reviewed-by: Stanislaw Kardach <Stanislaw.Kardach@cavium.com>
[RH: Original patch taken from marvell 88F3720 board support SDK 10.0-PR2003]
Signed-off-by: Ruiqiang Hao <Ruiqiang.Hao@windriver.com>
---
 drivers/net/ethernet/cavium/octeontx-83xx/bgx.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/net/ethernet/cavium/octeontx-83xx/bgx.c b/drivers/net/ethernet/cavium/octeontx-83xx/bgx.c
index 57d90bfe2fef..1c7fdf246114 100644
--- a/drivers/net/ethernet/cavium/octeontx-83xx/bgx.c
+++ b/drivers/net/ethernet/cavium/octeontx-83xx/bgx.c
@@ -505,6 +505,7 @@ int bgx_port_config(struct octtx_bgx_port *port, mbox_bgx_port_conf_t *conf)
 	reg = bgx_reg_read(bgx, port->lmac, BGX_CMRX_RX_DMAC_CTL);
 	conf->bcast_mode = reg & 0x1; /* BCAST_ACCEPT */
 	conf->mcast_mode = (reg >> 1) & 0x3; /* MCAST_MODE */
+	conf->promisc = !((reg >> 3) & 0x1); /* reverse of CAM_ACCEPT */
 
 	macaddr = thbgx->get_mac_addr(port->node, port->bgx, port->lmac);
 	memcpy(conf->macaddr, macaddr, 6);
-- 
2.17.1

