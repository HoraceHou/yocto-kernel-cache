From 3123b9ea0805fd03b6f2e6a9b98b1b054466933f Mon Sep 17 00:00:00 2001
From: Tomasz Duszynski <tduszynski@cavium.com>
Date: Thu, 14 Mar 2019 12:34:58 +0100
Subject: [PATCH 046/386] octeontx2-pf: fix VF index calculation

Fix VF index calculation by changing subtraction order. Currently
we end up with negative indexes which is obviously wrong.

Change-Id: I036884b62edef51f5cd82ac9fad20205810e2c61
Signed-off-by: Tomasz Duszynski <tduszynski@marvell.com>
Reviewed-on: https://sj1git1.cavium.com/5712
Tested-by: sa_ip-sw-jenkins
Reviewed-by: Sunil Kovvuri Goutham <Sunil.Goutham@cavium.com>
[RH: Original patch taken from marvell 88F3720 board support SDK 10.0-PR2003]
Signed-off-by: Ruiqiang Hao <Ruiqiang.Hao@windriver.com>
---
 drivers/net/ethernet/marvell/octeontx2/nic/otx2_pf.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/marvell/octeontx2/nic/otx2_pf.c b/drivers/net/ethernet/marvell/octeontx2/nic/otx2_pf.c
index 41bf21160589..63df47792684 100644
--- a/drivers/net/ethernet/marvell/octeontx2/nic/otx2_pf.c
+++ b/drivers/net/ethernet/marvell/octeontx2/nic/otx2_pf.c
@@ -1898,7 +1898,7 @@ static void otx2_vf_link_event_task(struct work_struct *work)
 
 	config = container_of(work, struct otx2_vf_config,
 			      link_event_work.work);
-	vf_idx = config->pf->vf_configs - config;
+	vf_idx = config - config->pf->vf_configs;
 	pf = config->pf;
 
 	msghdr = otx2_mbox_alloc_msg_rsp(&pf->mbox_pfvf[0].mbox_up, vf_idx,
-- 
2.17.1

