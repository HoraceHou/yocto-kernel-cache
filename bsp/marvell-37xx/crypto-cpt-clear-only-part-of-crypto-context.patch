From 89ce8e4a6c47fa4cd9be17f277e5660c621ce02a Mon Sep 17 00:00:00 2001
From: Lukasz Bartosik <lukasz.bartosik@cavium.com>
Date: Wed, 27 Mar 2019 13:38:48 +0100
Subject: [PATCH 137/386] crypto: cpt - clear only part of crypto context

Instead of clearing entire crypto context which size
is over 2kB for each encryption/decryption request
clear only two control words which are 16 bytes in total.

Change-Id: I2ad86ddc3fc338079cbbc478d42b8dc2157803cb
Signed-off-by: Lukasz Bartosik <lukasz.bartosik@cavium.com>
Reviewed-on: https://sj1git1.cavium.com/6423
Tested-by: sa_ip-sw-jenkins
Reviewed-by: Srujana Challa <schalla@cavium.com>
[RH: Original patch taken from marvell 88F3720 board support SDK 10.0-PR2003]
Signed-off-by: Ruiqiang Hao <Ruiqiang.Hao@windriver.com>
---
 drivers/crypto/cavium/cpt/common/cpt_algs.c | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/drivers/crypto/cavium/cpt/common/cpt_algs.c b/drivers/crypto/cavium/cpt/common/cpt_algs.c
index a8ea7bd5a748..a9f156e54ab0 100644
--- a/drivers/crypto/cavium/cpt/common/cpt_algs.c
+++ b/drivers/crypto/cavium/cpt/common/cpt_algs.c
@@ -271,7 +271,10 @@ static inline int cvm_enc_dec(struct ablkcipher_request *req, u32 enc)
 	if (req->nbytes > CPT_MAX_REQ_SIZE)
 		return -E2BIG;
 
-	memset(rctx, 0, sizeof(struct cvm_req_ctx));
+	/* Clear control words */
+	rctx->ctrl_word.flags = 0;
+	rctx->fctx.enc.enc_ctrl.flags = 0;
+
 	create_input_list(req, enc, enc_iv_len);
 	create_output_list(req, enc_iv_len);
 
@@ -1115,7 +1118,10 @@ u32 cvm_aead_enc_dec(struct aead_request *req, u8 reg_type, u8 enc)
 	struct algs_ops *ops;
 	u32 status, cpu_num;
 
-	memset(rctx, 0, sizeof(struct cvm_req_ctx));
+	/* Clear control words */
+	rctx->ctrl_word.flags = 0;
+	rctx->fctx.enc.enc_ctrl.flags = 0;
+
 	req_info->callback = cvm_callback;
 	req_info->areq = &req->base;
 	req_info->req_type = reg_type;
-- 
2.17.1

