From 01988b2db6df79c64d7ded692217fbea5c701f0e Mon Sep 17 00:00:00 2001
From: Yue Tao <Yue.Tao@windriver.com>
Date: Sun, 24 Mar 2019 19:08:59 -0700
Subject: [PATCH] vfio_fsl_mc: workaround to fix build issue of the prototype
 change of __iormb()

The prototype of function __iormb() is changed by upstream commit 6460d3201471.

6460d3201471: arm64: io: Ensure calls to delay routines are ordered against prior readX()

Signed-off-by: Yue Tao <Yue.Tao@windriver.com>
---
 drivers/vfio/fsl-mc/vfio_fsl_mc.c |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/vfio/fsl-mc/vfio_fsl_mc.c b/drivers/vfio/fsl-mc/vfio_fsl_mc.c
index 9a356fc..0aeb749 100644
--- a/drivers/vfio/fsl-mc/vfio_fsl_mc.c
+++ b/drivers/vfio/fsl-mc/vfio_fsl_mc.c
@@ -332,9 +332,10 @@ static int vfio_fsl_mc_dprc_wait_for_response(void __iomem *ioaddr)
 		u64 header;
 		struct mc_cmd_header *resp_hdr;
 
-		__iormb();
+		u64 __v = readq_relaxed(ioaddr);
+		__iormb(__v);
 		header = readq(ioaddr);
-		__iormb();
+		__iormb(__v);
 
 		resp_hdr = (struct mc_cmd_header *)&header;
 		status = (enum mc_cmd_status)resp_hdr->status;
-- 
1.7.9.5

