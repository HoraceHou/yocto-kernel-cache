From 0e7fe0e4588abf27d54c703a38e442cbd84e199b Mon Sep 17 00:00:00 2001
From: Dave Stevenson <dave.stevenson@raspberrypi.org>
Date: Tue, 23 Oct 2018 15:16:35 +0100
Subject: [PATCH 194/198] ASoC: googlevoicehat-codec: Use correct device when
 grabbing GPIO

commit 3c1526259ff39220001222661d2c8191ddf7d249 from
https://github.com/raspberrypi/linux.git

The fixup for the VoiceHAT in 4.18 incorrectly tried to find the
sdmode GPIO pin under the card device, not the codec device.
This failed, and therefore caused the device probe to fail.

Signed-off-by: Dave Stevenson <dave.stevenson@raspberrypi.org>
Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 sound/soc/bcm/googlevoicehat-codec.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/sound/soc/bcm/googlevoicehat-codec.c b/sound/soc/bcm/googlevoicehat-codec.c
index 1cbd3ed6899b..187706ce5f1e 100644
--- a/sound/soc/bcm/googlevoicehat-codec.c
+++ b/sound/soc/bcm/googlevoicehat-codec.c
@@ -50,9 +50,9 @@ static void voicehat_enable_sdmode_work(struct work_struct *work) {
 static int voicehat_component_probe(struct snd_soc_component *component) {
   struct voicehat_priv *voicehat = snd_soc_component_get_drvdata(component);
 
-  voicehat->sdmode_gpio = devm_gpiod_get(component->card->dev, "sdmode", GPIOD_OUT_LOW);
+  voicehat->sdmode_gpio = devm_gpiod_get(component->dev, "sdmode", GPIOD_OUT_LOW);
   if (IS_ERR(voicehat->sdmode_gpio)) {
-    dev_err(component->card->dev, "Unable to allocate GPIO pin\n");
+    dev_err(component->dev, "Unable to allocate GPIO pin\n");
     return PTR_ERR(voicehat->sdmode_gpio);
   }
 
-- 
2.17.1

