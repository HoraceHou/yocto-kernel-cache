From 4b9ba11e36de5c01f6e26c28a080055e1a44b225 Mon Sep 17 00:00:00 2001
From: Xulin Sun <xulin.sun@windriver.com>
Date: Wed, 25 Dec 2019 12:52:58 +0800
Subject: [PATCH 4/4] i2c: mux: pca954x: add the device id element for chip
 pca9646

Commit 2d74187d5b4e(i2c: mux: pca954x: verify the device id of the pca984x chips)
Added the device id element for the struct chip_desc chips[], pca9646
added later missing the id element. It will cause to verify the id fault
and series I2C devices can not be probed to fix below kernel panic issue:

imx-wm8960 sound: ASoC: no sink widget found for ASRC-Capture
Unable to handle kernel NULL pointer dereference at virtual address 0000000000000000
Mem abort info:
  ESR = 0x86000004
  Exception class = IABT (current EL), IL = 32 bits
  SET = 0, FnV = 0
  EA = 0, S1PTW = 0
[0000000000000000] user address but active_mm is swapper
Internal error: Oops: 86000004 [#1] PREEMPT SMP
Modules linked in:
Process swapper/0 (pid: 1, stack limit = 0x(____ptrval____))
CPU: 0 PID: 1 Comm: swapper/0 Not tainted 4.18.45-yocto-standard #1
Hardware name: Freescale i.MX8QXP MEK (DT)
pstate: 60000005 (nZCv daif -PAN -UAO)
pc :           (null)
lr : call_timer_fn+0x4c/0x1e8
sp : ffff000008003d90
x29: ffff000008003d90 x28: 0000000000000000
x27: ffff0000090f85c8 x26: ffff0000090f6980
x25: dead000000000200 x24: ffff00000924a710
x23: ffff000008003e30 x22: ffff80083b6b8200
x21: 0000000000000101 x20: 0000000000000000
x19: ffff00000924a788 x18: 0000000000000001
x17: 0000000000000000 x16: 0000000000000000
x15: ffffffffffffffff x14: 0000000000000008
x13: 0000000000000000 x12: 003d090000000000
x11: 00003d0900000000 x10: ffff80083ff33db0
x9 : 0000000000000001 x8 : ffff000008003e38
x7 : 0000000000000000 x6 : ffff80083ff33d68
x5 : 0000000000000040 x4 : ffff80083b6b8200
x3 : 0000000000000000 x2 : 0000000000000000
x1 : ffff00000924a760 x0 : ffff80083b6b8200
Call trace:
           (null)
 run_timer_softirq+0x254/0x2a8
 __do_softirq+0x168/0x3a8
 irq_exit+0x98/0xb0
 __handle_domain_irq+0x9c/0x108
 gic_handle_irq+0xdc/0x1d8
 el1_irq+0xb0/0x128
 console_unlock.part.5+0x2e4/0x490
 vprintk_emit+0x184/0x1f0
 dev_vprintk_emit+0x118/0x230
 dev_printk_emit+0x80/0xa8
 __dev_printk+0x5c/0xa0
 dev_err+0x74/0x98
 snd_soc_dapm_add_route+0x1ac/0x250
 snd_soc_dapm_add_routes+0x6c/0xc8
 snd_soc_register_card+0x810/0xc88
 devm_snd_soc_register_card+0x4c/0xa0
 imx_wm8960_probe+0x330/0x5a0
 platform_drv_probe+0x58/0xa8
 driver_probe_device+0x210/0x2f8
 __driver_attach+0xf4/0xf8
 bus_for_each_dev+0x84/0xd8
 driver_attach+0x30/0x40
 bus_add_driver+0x1e0/0x210
 driver_register+0x64/0x110
 __platform_driver_register+0x54/0x60
 imx_wm8960_driver_init+0x20/0x28
 do_one_initcall+0x68/0x248
 kernel_init_freeable+0x2d4/0x3cc
 kernel_init+0x18/0x108
 ret_from_fork+0x10/0x1c
Code: bad PC value
---[ end trace 256fc74bb82fb85f ]---
Kernel panic - not syncing: Fatal exception in interrupt

Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/i2c/muxes/i2c-mux-pca954x.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/i2c/muxes/i2c-mux-pca954x.c b/drivers/i2c/muxes/i2c-mux-pca954x.c
index 930bab3765e4..c42abb90d649 100644
--- a/drivers/i2c/muxes/i2c-mux-pca954x.c
+++ b/drivers/i2c/muxes/i2c-mux-pca954x.c
@@ -181,6 +181,7 @@ static const struct chip_desc chips[] = {
 	[pca_9646] = {
 		.nchans = 4,
 		.muxtype = pca954x_isswi,
+		.id = { .manufacturer_id = I2C_DEVICE_ID_NONE },
 	},
 };
 
-- 
2.17.1

