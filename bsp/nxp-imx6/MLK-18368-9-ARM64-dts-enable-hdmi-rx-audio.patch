From 35ea63db3c6a4a0f11547daa7502bae7d3f84abc Mon Sep 17 00:00:00 2001
From: Shengjiu Wang <shengjiu.wang@nxp.com>
Date: Tue, 22 May 2018 15:43:55 +0800
Subject: [PATCH 3873/5242] MLK-18368-9: ARM64: dts: enable hdmi rx audio

commit  ce820630b57892552703b8e051643e617afbb888 from
https://source.codeaurora.org/external/imx/linux-imx.git

enable hdmi rx audio

Signed-off-by: Shengjiu Wang <shengjiu.wang@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-imx8mq-evk.dts   |    1 +
 .../boot/dts/freescale/fsl-imx8qm-device.dtsi      |    4 +++-
 .../boot/dts/freescale/fsl-imx8qm-mek-hdmi.dts     |   18 ++++++++++++++++--
 3 files changed, 20 insertions(+), 3 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8mq-evk.dts b/arch/arm64/boot/dts/freescale/fsl-imx8mq-evk.dts
index 2aee3b0..a116a44 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8mq-evk.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8mq-evk.dts
@@ -83,6 +83,7 @@
 		model = "imx-audio-hdmi";
 		audio-cpu = <&sai4>;
 		protocol = <1>;
+		hdmi-out;
 	};
 
 	sound-spdif {
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm-device.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8qm-device.dtsi
index 6230465..44dfffa 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm-device.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm-device.dtsi
@@ -2508,10 +2508,12 @@
 						<&clk IMX8QM_HDMI_RX_SINK_PCLK>,
 						<&clk IMX8QM_HDMI_RX_SINK_SCLK>,
 						<&clk IMX8QM_HDMI_RX_PXL_ENC_CLK>,
+						<&clk IMX8QM_HDMI_RX_I2S_CLK>,
 						<&clk IMX8QM_HDMI_RX_SPDIF_CLK>,
 						<&clk IMX8QM_IMG_PXL_LINK_HDMI_IN_CLK>;
 			clock-names = "ref_clk", "core_clk", "pxl_clk",
-							"pclk", "sclk", "enc_clk", "spdif_clk",
+							"pclk", "sclk", "enc_clk",
+							"i2s_clk", "spdif_clk",
 							"pxl_link_clk";
 			power-domains = <&pd_hdmi_rx_bypass>;
 			status = "disabled";
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-hdmi.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-hdmi.dts
index a502793..2764b38 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-hdmi.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-hdmi.dts
@@ -18,12 +18,21 @@
 #include "fsl-imx8qm-mek.dts"
 
 / {
-	sound-hdmi {
+	sound-hdmi-tx {
 		compatible = "fsl,imx-audio-cdnhdmi";
-		model = "imx-audio-hdmi";
+		model = "imx-audio-hdmi-tx";
 		audio-cpu = <&sai_hdmi_tx>;
 		constraint-rate = <48000>;
 		protocol = <1>;
+		hdmi-out;
+	};
+
+	sound-hdmi-rx {
+		compatible = "fsl,imx-audio-cdnhdmi";
+		model = "imx-audio-hdmi-rx";
+		audio-cpu = <&sai_hdmi_rx>;
+		protocol = <1>;
+		hdmi-in;
 	};
 
 	sound-amix-sai {
@@ -93,6 +102,11 @@
 	status = "okay";
 };
 
+&sai_hdmi_rx {
+	fsl,sai-asynchronous;
+	status = "okay";
+};
+
 &spdif1 {
 	assigned-clocks =<&clk IMX8QM_AUD_PLL0_DIV>,
 			<&clk IMX8QM_AUD_ACM_AUD_PLL_CLK0_DIV>,
-- 
1.7.9.5

