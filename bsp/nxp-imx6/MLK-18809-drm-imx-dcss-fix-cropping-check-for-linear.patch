From 99393b0ca50a666551fa42cb8799f4b6f06332fb Mon Sep 17 00:00:00 2001
From: Laurentiu Palcu <laurentiu.palcu@nxp.com>
Date: Tue, 10 Jul 2018 13:11:40 +0300
Subject: [PATCH 4090/5242] MLK-18809: drm: imx: dcss: fix cropping check for
 linear buffers

commit  49988696ea213f6e7437d266a7b19c193275deda from
https://source.codeaurora.org/external/imx/linux-imx.git

Currently, DCSS driver does not support cropping for linear buffers,
only tiled ones. Current checks return an error only if the submitted
buffer has no modifiers present. However, Weston uses modifiers even for
linear buffers and we need to check for that.

Signed-off-by: Laurentiu Palcu <laurentiu.palcu@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/gpu/drm/imx/dcss/dcss-plane.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/imx/dcss/dcss-plane.c b/drivers/gpu/drm/imx/dcss/dcss-plane.c
index b121027..a91945ad 100644
--- a/drivers/gpu/drm/imx/dcss/dcss-plane.c
+++ b/drivers/gpu/drm/imx/dcss/dcss-plane.c
@@ -222,7 +222,9 @@ static int dcss_plane_atomic_check(struct drm_plane *plane,
 	    state->crtc_y + state->crtc_h > vdisplay) {
 		if (plane->type == DRM_PLANE_TYPE_PRIMARY)
 			return -EINVAL;
-		else if (!(fb->flags & DRM_MODE_FB_MODIFIERS))
+		else if (!(fb->flags & DRM_MODE_FB_MODIFIERS) ||
+			 (fb->flags & DRM_MODE_FB_MODIFIERS &&
+			  fb->modifier == DRM_FORMAT_MOD_LINEAR))
 			return -EINVAL;
 	}
 
-- 
1.7.9.5

