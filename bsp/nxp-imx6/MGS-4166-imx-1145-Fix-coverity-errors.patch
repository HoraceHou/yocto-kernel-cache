From d35350b8005eb565a48bd1d25474f2a140cc344f Mon Sep 17 00:00:00 2001
From: Yong Gan <yong.gan@nxp.com>
Date: Fri, 24 Aug 2018 07:59:20 +0800
Subject: [PATCH 4435/5242] MGS-4166 [#imx-1145] Fix coverity errors

commit  7324eb3e5ed1c257112f35df74f32bf8549da18a from
https://source.codeaurora.org/external/imx/linux-imx.git

Fix potential Resource leaks and memory illegal access issues.

Signed-off-by Yong Gan <yong.gan@ncp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 .../hal/os/linux/kernel/gc_hal_kernel_device.c     |    2 +-
 .../gpu-viv/hal/os/linux/kernel/gc_hal_kernel_os.c |    2 +-
 .../hal/os/linux/kernel/gc_hal_kernel_sync.c       |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_device.c b/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_device.c
index 5543d1d..d11b6dd 100644
--- a/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_device.c
+++ b/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_device.c
@@ -2102,7 +2102,7 @@ static irqreturn_t isrRoutineVG(int irq, void *ctxt)
     IN gckGALDEVICE Device
     )
 {
-    gctUINT64 mcStart[gcvCORE_COUNT], shStart[gcvCORE_COUNT];
+    gctUINT64 mcStart[gcvCORE_COUNT] = { 0 }, shStart[gcvCORE_COUNT];
     gctUINT32 mcClk[gcvCORE_COUNT], shClk[gcvCORE_COUNT];
     gckHARDWARE hardware = gcvNULL;
     gceSTATUS status;
diff --git a/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_os.c b/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_os.c
index f79d999..dcf4daf 100644
--- a/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_os.c
+++ b/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_os.c
@@ -6946,7 +6946,7 @@ gceSTATUS gckOS_UserLogicalToPhysical(
 {
     struct dma_fence *fence = NULL;
     struct sync_file *sync = NULL;
-    int fd;
+    int fd = -1;
     struct viv_sync_timeline *timeline;
     gcsSIGNAL_PTR signal = gcvNULL;
     gceSTATUS status = gcvSTATUS_OK;
diff --git a/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_sync.c b/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_sync.c
index ee30a54..5cda578 100644
--- a/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_sync.c
+++ b/drivers/mxc/gpu-viv/hal/os/linux/kernel/gc_hal_kernel_sync.c
@@ -236,7 +236,7 @@ struct viv_sync_timeline * viv_sync_timeline_create(const char *name, gckOS Os)
     if (!timeline)
         return NULL;
 
-    strncpy(timeline->name, name, sizeof(timeline->name));
+    strncpy(timeline->name, name, sizeof(timeline->name) - 1);
     timeline->context = dma_fence_context_alloc(1);
     atomic64_set(&timeline->seqno, 0);
     timeline->os = Os;
-- 
1.7.9.5

