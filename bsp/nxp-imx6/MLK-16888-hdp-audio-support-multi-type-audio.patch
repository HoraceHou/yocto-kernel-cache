From f3621eeb577f486140445f706caff82a974f50de Mon Sep 17 00:00:00 2001
From: Sandor Yu <Sandor.yu@nxp.com>
Date: Fri, 17 Nov 2017 16:30:53 +0800
Subject: [PATCH 2827/5242] MLK-16888: hdp audio: support multi-type audio

commit  b8c0c60dfca550522cce9b7ec129d0a00d2ae4cc from
https://source.codeaurora.org/external/imx/linux-imx.git

Add audio_type variable to support different audio type.

Signed-off-by: Sandor Yu <Sandor.yu@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/gpu/drm/imx/hdp/imx-hdp.c |    6 +++++-
 drivers/gpu/drm/imx/hdp/imx-hdp.h |    2 ++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/gpu/drm/imx/hdp/imx-hdp.c b/drivers/gpu/drm/imx/hdp/imx-hdp.c
index 145d86f..f0a0150 100644
--- a/drivers/gpu/drm/imx/hdp/imx-hdp.c
+++ b/drivers/gpu/drm/imx/hdp/imx-hdp.c
@@ -145,7 +145,7 @@ u32 imx_hdp_audio(AUDIO_TYPE type, u32 sample_rate, u32 channels, u32 width)
 				freq,
 				0,
 				bits,
-				CDN_DPTX,
+				g_hdp->audio_type,
 				ncts_n,
 				AUDIO_MUTE_MODE_UNMUTE);
 	return 0;
@@ -880,6 +880,7 @@ static int imx8qm_hdp_swrite(struct hdp_mem *mem, unsigned int addr, unsigned in
 static struct hdp_devtype imx8qm_dp_devtype = {
 	.is_edid = false,
 	.is_4kp60 = false,
+	.audio_type = CDN_DPTX,
 	.ops = &imx8qm_dp_ops,
 	.rw = &imx8qm_rw,
 };
@@ -887,6 +888,7 @@ static int imx8qm_hdp_swrite(struct hdp_mem *mem, unsigned int addr, unsigned in
 static struct hdp_devtype imx8qm_hdmi_devtype = {
 	.is_edid = false,
 	.is_4kp60 = false,
+	.audio_type = CDN_HDMITX_TYPHOON,
 	.ops = &imx8qm_hdmi_ops,
 	.rw = &imx8qm_rw,
 };
@@ -907,6 +909,7 @@ static int imx8qm_hdp_swrite(struct hdp_mem *mem, unsigned int addr, unsigned in
 static struct hdp_devtype imx8mq_hdmi_devtype = {
 	.is_edid = false,
 	.is_4kp60 = true,
+	.audio_type = CDN_HDMITX_KIRAN,
 	.ops = &imx8mq_ops,
 	.rw = &imx8mq_rw,
 };
@@ -1046,6 +1049,7 @@ static int imx_hdp_imx_bind(struct device *dev, struct device *master,
 
 	hdp->is_edid = devtype->is_edid;
 	hdp->is_4kp60 = devtype->is_4kp60;
+	hdp->audio_type = devtype->audio_type;
 	hdp->ops = devtype->ops;
 	hdp->rw = devtype->rw;
 
diff --git a/drivers/gpu/drm/imx/hdp/imx-hdp.h b/drivers/gpu/drm/imx/hdp/imx-hdp.h
index c30581c..f59976f 100644
--- a/drivers/gpu/drm/imx/hdp/imx-hdp.h
+++ b/drivers/gpu/drm/imx/hdp/imx-hdp.h
@@ -102,6 +102,7 @@ struct hdp_ops {
 struct hdp_devtype {
 	u8 is_edid;
 	u8 is_4kp60;
+	u8 audio_type;
 	struct hdp_ops *ops;
 	struct hdp_rw_func *rw;
 };
@@ -185,6 +186,7 @@ struct imx_hdp {
 
 	u8 is_edid;
 	u8 is_4kp60;
+	u8 audio_type;
 
 	struct mutex mutex;		/* for state below and previous_mode */
 	enum drm_connector_force force;	/* mutex-protected force state */
-- 
1.7.9.5

