From 15dc6f4c6e4f406b034a5ed0c8df9595157bef3b Mon Sep 17 00:00:00 2001
From: Han Xu <han.xu@nxp.com>
Date: Tue, 19 Apr 2016 14:44:27 -0500
Subject: [PATCH 1012/5242] MLK-12684-2: mtd: gpmi: add NAND support on
 imx6ull

commit  ac10652540f49a2c93a84a557b291be89486b40a from
https://source.codeaurora.org/external/imx/linux-imx.git

support NAND on imx6ull

Signed-off-by: Han Xu <han.xu@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c |    9 +++++++++
 drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.h |    6 ++++--
 2 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c b/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c
index 698c63f..3c6354c 100644
--- a/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c
+++ b/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.c
@@ -157,6 +157,12 @@ static int gpmi_ooblayout_free(struct mtd_info *mtd, int section,
 	.clks_count = ARRAY_SIZE(gpmi_clks_for_mx7d),
 };
 
+static const struct gpmi_devdata gpmi_devdata_imx6ull = {
+	.type = IS_MX6ULL,
+	.bch_max_ecc_strength = 40,
+	.max_chain_delay = 12,
+};
+
 static irqreturn_t bch_irq(int irq, void *cookie)
 {
 	struct gpmi_nand_data *this = cookie;
@@ -2262,6 +2268,9 @@ static int gpmi_nand_init(struct gpmi_nand_data *this)
 	}, {
 		.compatible = "fsl,imx7d-gpmi-nand",
 		.data = &gpmi_devdata_imx7d,
+	}, {
+		.compatible = "fsl,imx6ull-gpmi-nand",
+		.data = &gpmi_devdata_imx6ull,
 	}, {}
 };
 MODULE_DEVICE_TABLE(of, gpmi_nand_id_table);
diff --git a/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.h b/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.h
index e4c3f64..6dfb30d 100644
--- a/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.h
+++ b/drivers/mtd/nand/raw/gpmi-nand/gpmi-nand.h
@@ -88,7 +88,8 @@ enum gpmi_type {
 	IS_MX6QP,
 	IS_MX6SX,
 	IS_MX7D,
-	IS_MX6UL
+	IS_MX6UL,
+	IS_MX6ULL,
 };
 
 struct gpmi_devdata {
@@ -225,8 +226,9 @@ void gpmi_copy_bits(u8 *dst, size_t dst_bit_off,
 #define GPMI_IS_MX6SX(x)	((x)->devdata->type == IS_MX6SX)
 #define GPMI_IS_MX7D(x)		((x)->devdata->type == IS_MX7D)
 #define GPMI_IS_MX6UL(x)	((x)->devdata->type == IS_MX6UL)
+#define GPMI_IS_MX6ULL(x)	((x)->devdata->type == IS_MX6ULL)
 
 #define GPMI_IS_MX6(x)		(GPMI_IS_MX6Q(x) || GPMI_IS_MX6QP(x) || GPMI_IS_MX6SX(x) || \
-                                 GPMI_IS_MX6UL(x) || \
+                                 GPMI_IS_MX6UL(x) || GPMI_IS_MX6ULL(x) || \
 				 GPMI_IS_MX7D(x))
 #endif
-- 
1.7.9.5

