From 8af3a18d85b8e3d8f883647273c36a78c430fa97 Mon Sep 17 00:00:00 2001
From: Peter Chen <peter.chen@nxp.com>
Date: Mon, 11 Dec 2017 15:12:04 +0800
Subject: [PATCH 3074/5242] MLK-16715-8 ARM64: dts: fsl-imx8qm: add USB HSIC
 support

commit  ec8cad837f802aee896b50ce6b1dfb325a9e944e from
https://source.codeaurora.org/external/imx/linux-imx.git

Add USB HSIC controller support.

Acked-by: Jun Li <jun.li@nxp.com>
Signed-off-by: Peter Chen <peter.chen@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi |   36 +++++++++++++++++++++++--
 1 file changed, 34 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
index 0fa93cc..15356fd 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
@@ -421,11 +421,13 @@
 				wakeup-irq = <267>;
 			};
 
-			pd_conn_usbotg1: PD_CONN_USB_1 {
+			pd_conn_usbh1: PD_CONN_USB_1 {
 				reg = <SC_R_USB_1>;
 				#power-domain-cells = <0>;
 				power-domains = <&pd_conn>;
+				wakeup-irq = <268>;
 			};
+
 			pd_conn_usb2: PD_CONN_USB_2 {
 				reg = <SC_R_USB_2>;
 				#power-domain-cells = <0>;
@@ -3004,12 +3006,17 @@
 		reg = <0x0 0x5b0d0200 0x0 0x200>;
 	};
 
+	usbmisc2: usbmisc@5b0e0200 {
+		#index-cells = <1>;
+		compatible = "fsl,imx7ulp-usbmisc", "fsl,imx6q-usbmisc";
+		reg = <0x0 0x5b0e0200 0x0 0x200>;
+	};
+
 	usbphy1: usbphy@0x5b100000 {
 		compatible = "fsl,imx8qm-usbphy", "fsl,imx7ulp-usbphy", "fsl,imx6ul-usbphy", "fsl,imx23-usbphy";
 		reg = <0x0 0x5b100000 0x0 0x200>;
 		clocks = <&clk IMX8QM_USB2_PHY_IPG_CLK>;
 		power-domains = <&pd_conn_usbotg0_phy>;
-
 	};
 
 	usbphynop1: usbphynop1 {
@@ -3019,6 +3026,13 @@
 		power-domains = <&pd_conn_usb2_phy>;
 	};
 
+	usbphynop2: usbphynop2 {
+		compatible = "usb-nop-xceiv";
+		clocks = <&clk IMX8QM_USB2_PHY_IPG_CLK>;
+		clock-names = "main_clk";
+		power-domains = <&pd_conn_usbotg0_phy>;
+	};
+
 	usbotg1: usb@5b0d0000 {
 		compatible = "fsl,imx8qm-usb", "fsl,imx27-usb";
 		reg = <0x0 0x5b0d0000 0x0 0x200>;
@@ -3035,6 +3049,24 @@
 		status = "disabled";
 	};
 
+	usbh1: usb@5b0e0000 {
+		compatible = "fsl,imx8qm-usb", "fsl,imx27-usb";
+		reg = <0x0 0x5b0e0000 0x0 0x200>;
+		interrupt-parent = <&wu>;
+		interrupts = <GIC_SPI 268 IRQ_TYPE_LEVEL_HIGH>;
+		phy_type = "hsic";
+		dr_mode = "host";
+		fsl,usbphy = <&usbphynop2>;
+		fsl,usbmisc = <&usbmisc2 0>;
+		clocks = <&clk IMX8QM_USB2_OH_AHB_CLK>;
+		ahb-burst-config = <0x0>;
+		tx-burst-size-dword = <0x10>;
+		rx-burst-size-dword = <0x10>;
+		#stream-id-cells = <1>;
+		power-domains = <&pd_conn_usbh1>;
+		status = "disabled";
+	};
+
 	usbotg3: cdns3@5b110000 {
 		compatible = "Cadence,usb3";
 		reg = <0x0 0x5B110000 0x0 0x10000>,
-- 
1.7.9.5

