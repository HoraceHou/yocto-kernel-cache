From 2688adb78e12f08fac33fd0e7cb844b99b31085b Mon Sep 17 00:00:00 2001
From: Shengjiu Wang <shengjiu.wang@nxp.com>
Date: Fri, 24 Aug 2018 16:38:53 +0800
Subject: [PATCH 5027/5242] MLK-18643: ARM64: dts: imx8mm: change the sdma
 script for SAI
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

commit  4276b880925c7152b448e1a239e29170d2d219a0 from
https://source.codeaurora.org/external/imx/linux-imx.git

The IMX_DMATYPE_SAI(24) performance is not enough to support high
sample rate/channels of audio case, there is a lot of underrun and
the sound is noise, the reason is that with this script, sdma copy data
through a long path (SDMA->pl301_audio -> pl301_display -> â€¦ ->
pl301_wakeup -> AIPS1 -> SPBA2 -> SAI).

The IMX_DMATYPE_SSI_SP(2) performance is better, which go through a shorter
path (SDMA -> SPBA2 -> SAI).

So we switch to use the IMX_DMATYPE_SSI_SP script, then 384k/32b/16c is
supported well.

Signed-off-by: Shengjiu Wang <shengjiu.wang@nxp.com>
(cherry picked from commit d5b70e9232218c419f7f6f843249e4bba84156b6)
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi |   10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi
index e19ff87..3f5144a 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi
@@ -722,7 +722,7 @@
 			 <&clk IMX8MM_CLK_SAI1_ROOT>,
 			 <&clk IMX8MM_CLK_DUMMY>, <&clk IMX8MM_CLK_DUMMY>;
 		clock-names = "bus", "mclk0", "mclk1", "mclk2", "mclk3";
-		dmas = <&sdma2 0 24 0>, <&sdma2 1 24 0>;
+		dmas = <&sdma2 0 2 0>, <&sdma2 1 2 0>;
 		dma-names = "rx", "tx";
 		fsl,dataline = <0xff 0xff>;
 		status = "disabled";
@@ -738,7 +738,7 @@
 			<&clk IMX8MM_CLK_SAI2_ROOT>,
 			<&clk IMX8MM_CLK_DUMMY>, <&clk IMX8MM_CLK_DUMMY>;
 		clock-names = "bus", "mclk0", "mclk1", "mclk2", "mclk3";
-		dmas = <&sdma2 2 24 0>, <&sdma2 3 24 0>;
+		dmas = <&sdma2 2 2 0>, <&sdma2 3 2 0>;
 		dma-names = "rx", "tx";
 		status = "disabled";
 	};
@@ -752,7 +752,7 @@
 			 <&clk IMX8MM_CLK_SAI3_ROOT>,
 			 <&clk IMX8MM_CLK_DUMMY>, <&clk IMX8MM_CLK_DUMMY>;
 		clock-names = "bus", "mclk0", "mclk1", "mclk2", "mclk3";
-		dmas = <&sdma2 4 24 0>, <&sdma2 5 24 0>;
+		dmas = <&sdma2 4 2 0>, <&sdma2 5 2 0>;
 		dma-names = "rx", "tx";
 		status = "disabled";
 	};
@@ -766,7 +766,7 @@
 			 <&clk IMX8MM_CLK_SAI5_ROOT>,
 			 <&clk IMX8MM_CLK_DUMMY>, <&clk IMX8MM_CLK_DUMMY>;
 		clock-names = "bus", "mclk0", "mclk1", "mclk2", "mclk3";
-		dmas = <&sdma2 8 24 0>, <&sdma2 9 24 0>;
+		dmas = <&sdma2 8 2 0>, <&sdma2 9 2 0>;
 		dma-names = "rx", "tx";
 		fsl,shared-interrupt;
 		fsl,dataline = <0xf 0xf>;
@@ -783,7 +783,7 @@
 			 <&clk IMX8MM_CLK_SAI6_ROOT>,
 			 <&clk IMX8MM_CLK_DUMMY>, <&clk IMX8MM_CLK_DUMMY>;
 		clock-names = "bus", "mclk0", "mclk1", "mclk2", "mclk3";
-		dmas = <&sdma2 10 24 0>, <&sdma2 11 24 0>;
+		dmas = <&sdma2 10 2 0>, <&sdma2 11 2 0>;
 		dma-names = "rx", "tx";
 		fsl,shared-interrupt;
 		status = "disabled";
-- 
1.7.9.5

