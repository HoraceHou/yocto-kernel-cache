From f1da4cb38d0ed515744df4a5cf2f49b9df869b69 Mon Sep 17 00:00:00 2001
From: Leonard Crestez <leonard.crestez@nxp.com>
Date: Thu, 22 Feb 2018 17:49:48 +0200
Subject: [PATCH 0492/5242] drivers: soc: imx6qp: gpc: Do not turn PU off at
 init time

commit  bc0835a200cbee2dfa4bf401304f8956af8c6fc8 from
https://source.codeaurora.org/external/imx/linux-imx.git

Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/soc/imx/gpc.c |    8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/drivers/soc/imx/gpc.c b/drivers/soc/imx/gpc.c
index fd766df..bdf3982 100644
--- a/drivers/soc/imx/gpc.c
+++ b/drivers/soc/imx/gpc.c
@@ -68,6 +68,11 @@ static inline bool cpu_is_imx6sl(void)
 	return of_machine_is_compatible("fsl,imx6sl");
 }
 
+static inline bool cpu_is_imx6q(void)
+{
+	return of_machine_is_compatible("fsl,imx6q");
+}
+
 struct imx_pm_domain {
 	struct generic_pm_domain base;
 	struct regmap *regmap;
@@ -520,7 +525,8 @@ static int imx_gpc_old_dt_init(struct device *dev, struct regmap *regmap,
 	}
 
 	is_off = IS_ENABLED(CONFIG_PM);
-	if (is_off) {
+	if (is_off && !(cpu_is_imx6q() &&
+		imx_get_soc_revision() == IMX_CHIP_REVISION_2_0)) {
 		_imx6_pm_domain_power_off(&pu_domain->base);
 	} else {
 		/*
-- 
1.7.9.5

