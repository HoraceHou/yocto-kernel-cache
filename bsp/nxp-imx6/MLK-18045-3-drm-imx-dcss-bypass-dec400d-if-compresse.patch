From 6f8210baecc48b5ed09c6c9ff64addef6f6b3c85 Mon Sep 17 00:00:00 2001
From: Fancy Fang <chen.fang@nxp.com>
Date: Sun, 15 Apr 2018 13:14:34 +0800
Subject: [PATCH 3609/5242] MLK-18045-3 drm/imx: dcss: bypass dec400d if
 'compressed' is false

commit  18523b8a2921d01402b19698c4b5fde0923743fa from
https://source.codeaurora.org/external/imx/linux-imx.git

When the fb's modifier is 'DRM_FORMAT_MOD_VIVANTE_SUPER_TILED_FC',
the compression state can be changed to non-compress according to
the 'compressed' field value of 'struct dma_metadata' data. At this
moment, the DEC400D should be bypassed.

Signed-off-by: Fancy Fang <chen.fang@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/gpu/drm/imx/dcss/dcss-plane.c |    6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/gpu/drm/imx/dcss/dcss-plane.c b/drivers/gpu/drm/imx/dcss/dcss-plane.c
index 3ee75a1..8617327 100644
--- a/drivers/gpu/drm/imx/dcss/dcss-plane.c
+++ b/drivers/gpu/drm/imx/dcss/dcss-plane.c
@@ -322,6 +322,12 @@ static void dcss_plane_atomic_set_base(struct dcss_plane *dcss_plane)
 				return;
 			}
 
+			if (!mdata->compressed) {
+				/* Bypass dec400d */
+				dcss_dec400d_bypass(dcss_plane->dcss);
+				return;
+			}
+
 			gem_obj = dcss_plane_gem_import(plane->dev,
 							mdata->ts_dma_buf);
 			if (IS_ERR(gem_obj)) {
-- 
1.7.9.5

