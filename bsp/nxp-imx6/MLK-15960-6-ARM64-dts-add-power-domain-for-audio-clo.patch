From efecdd392d6de412968b1474a1195b2a0b6d5ef6 Mon Sep 17 00:00:00 2001
From: Shengjiu Wang <shengjiu.wang@freescale.com>
Date: Wed, 12 Jul 2017 18:02:35 +0800
Subject: [PATCH 2126/5242] MLK-15960-6: ARM64: dts: add power domain for
 audio clocks

commit  a13e0499bb1917a9590d9f48c7a39d8fa2f86dd0 from
https://source.codeaurora.org/external/imx/linux-imx.git

The mclk_out clock is used as codec's mclk, so need to add
its power domain to codec node.

Signed-off-by: Shengjiu Wang <shengjiu.wang@freescale.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 .../dts/freescale/fsl-imx8qm-lpddr4-arm2-mqs.dts   |    1 +
 .../dts/freescale/fsl-imx8qm-lpddr4-arm2-spdif.dts |    1 +
 .../boot/dts/freescale/fsl-imx8qm-lpddr4-arm2.dts  |    1 +
 arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi      |   31 +++++++++++++++++++-
 .../freescale/fsl-imx8qxp-lpddr4-arm2-wm8962.dts   |    1 +
 .../boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2.dts |    1 +
 arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi     |   31 +++++++++++++++++++-
 include/dt-bindings/soc/imx8_pd.h                  |    6 ++++
 8 files changed, 71 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2-mqs.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2-mqs.dts
index cebcc87..fbc4ec3 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2-mqs.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2-mqs.dts
@@ -162,6 +162,7 @@
 			0x0000 /* 5:Default */
 		>;
 		amic-mono;
+		power-domains = <&pd_mclk_out0>;
 	};
 };
 
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2-spdif.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2-spdif.dts
index 1af4135..63de79c 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2-spdif.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2-spdif.dts
@@ -165,6 +165,7 @@
 			0x0000 /* 5:Default */
 		>;
 		amic-mono;
+		power-domains = <&pd_mclk_out0>;
 	};
 };
 
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2.dts
index 43257d8..5fa65af 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm-lpddr4-arm2.dts
@@ -525,6 +525,7 @@
 		VLS-supply = <&reg_audio>;
 		VLC-supply = <&reg_audio>;
 		reset-gpio = <&pca9557_a 2 1>;
+		power-domains = <&pd_mclk_out0>;
 	};
 };
 
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
index eef4da7..c055469 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
@@ -621,6 +621,36 @@
 				#power-domain-cells = <0>;
 				power-domains =<&pd_audio>;
 			};
+			pd_mclk_out0: PD_AUD_MCLK_OUT_0 {
+				reg = <SC_R_MCLK_OUT_0>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_mclk_out1: PD_AUD_MCLK_OUT_1 {
+				reg = <SC_R_MCLK_OUT_1>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_audio_pll0: PD_AUD_AUDIO_PLL_0 {
+				reg = <SC_R_AUDIO_PLL_0>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_audio_pll1: PD_AUD_AUDIO_PLL_1 {
+				reg = <SC_R_AUDIO_PLL_1>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_audio_clk0: PD_AUD_AUDIO_CLK_0 {
+				reg = <SC_R_AUDIO_CLK_0>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_audio_clk1: PD_AUD_AUDIO_CLK_1 {
+				reg = <SC_R_AUDIO_CLK_1>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
 		};
 
 		pd_dma: PD_DMA {
@@ -2118,7 +2148,6 @@
 	acm:  acm@59e00000 {
 		compatible = "nxp,imx8qm-acm";
 		reg = <0x0 0x59e00000 0x0 0x1D0000>;
-		power-domains = <&pd_sai0>;
 		status = "disabled";
 	};
 
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2-wm8962.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2-wm8962.dts
index bcf8bf3..b441fcc 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2-wm8962.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2-wm8962.dts
@@ -98,6 +98,7 @@
 			0x0000 /* 5:Default */
 		>;
 		amic-mono;
+		power-domains = <&pd_mclk_out0>;
 	};
 };
 
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2.dts
index d70ae79..1176cf7 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qxp-lpddr4-arm2.dts
@@ -386,6 +386,7 @@
 		VLS-supply = <&reg_audio>;
 		VLC-supply = <&reg_audio>;
 		reset-gpio = <&pca9557_a 2 1>;
+		power-domains = <&pd_mclk_out0>;
 		status = "okay";
 	};
 };
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi
index a4ea4cf..0e6730b 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi
@@ -437,6 +437,36 @@
 				#power-domain-cells = <0>;
 				power-domains =<&pd_audio>;
 			};
+			pd_mclk_out0: PD_AUD_MCLK_OUT_0 {
+				reg = <SC_R_MCLK_OUT_0>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_mclk_out1: PD_AUD_MCLK_OUT_1 {
+				reg = <SC_R_MCLK_OUT_1>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_audio_pll0: PD_AUD_AUDIO_PLL_0 {
+				reg = <SC_R_AUDIO_PLL_0>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_audio_pll1: PD_AUD_AUDIO_PLL_1 {
+				reg = <SC_R_AUDIO_PLL_1>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_audio_clk0: PD_AUD_AUDIO_CLK_0 {
+				reg = <SC_R_AUDIO_CLK_0>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
+			pd_audio_clk1: PD_AUD_AUDIO_CLK_1 {
+				reg = <SC_R_AUDIO_CLK_1>;
+				#power-domain-cells = <0>;
+				power-domains =<&pd_audio>;
+			};
 		};
 
 		pd_dma: PD_DMA {
@@ -1363,7 +1393,6 @@
 	acm: acm@59e00000 {
 		compatible = "nxp,imx8qm-acm";
 		reg = <0x0 0x59e00000 0x0 0x1D0000>;
-		power-domains = <&pd_sai0>;
 		status = "disabled";
 	};
 
diff --git a/include/dt-bindings/soc/imx8_pd.h b/include/dt-bindings/soc/imx8_pd.h
index 321f6a5..6e241e0 100644
--- a/include/dt-bindings/soc/imx8_pd.h
+++ b/include/dt-bindings/soc/imx8_pd.h
@@ -143,6 +143,12 @@
 #define PD_AUD_MQS_0                audio_mqs0
 #define PD_AUD_HIFI                 audio_hifi
 #define PD_AUD_OCRAM                audio_ocram
+#define PD_AUD_MCLK_OUT_0           audio_mclkout0
+#define PD_AUD_MCLK_OUT_1           audio_mclkout1
+#define PD_AUD_AUDIO_PLL_0          audio_audiopll0
+#define PD_AUD_AUDIO_PLL_1          audio_audiopll1
+#define PD_AUD_AUDIO_CLK_0          audio_audioclk0
+#define PD_AUD_AUDIO_CLK_1          audio_audioclk1
 
 #define PD_IMAGING                  imaging_power_domain
 #define PD_IMAGING_JPEG_DEC         imaging_jpeg_dec
-- 
1.7.9.5

