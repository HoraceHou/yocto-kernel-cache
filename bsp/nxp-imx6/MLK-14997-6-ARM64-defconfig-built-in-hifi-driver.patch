From a6888c835d2fd0e498c02a867f3b9caa6ed7ad13 Mon Sep 17 00:00:00 2001
From: Shengjiu Wang <shengjiu.wang@freescale.com>
Date: Thu, 1 Jun 2017 15:19:31 +0800
Subject: [PATCH 1838/5242] MLK-14997-6: ARM64: defconfig: built-in hifi
 driver

commit  e97cac5ac668ce9eb93e7c72e1f482ad1d3afa76 from
https://source.codeaurora.org/external/imx/linux-imx.git

built-in hifi driver

Signed-off-by: Shengjiu Wang <shengjiu.wang@freescale.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi |    4 ++--
 sound/soc/fsl/fsl_hifi4.c                      |    8 ++++----
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi
index 8a89fab..c6a2f5a 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qxp.dtsi
@@ -416,12 +416,12 @@
 				power-domains =<&pd_audio>;
 			};
 			pd_hifi: PD_AUD_HIFI {
-				reg = <SC_R_HIFI>;
+				reg = <SC_R_DSP>;
 				#power-domain-cells = <0>;
 				power-domains =<&pd_audio>;
 			};
 			pd_hifi_ram: PD_AUD_OCRAM {
-				reg = <SC_R_HIFI_RAM>;
+				reg = <SC_R_DSP_RAM>;
 				#power-domain-cells = <0>;
 				power-domains =<&pd_audio>;
 			};
diff --git a/sound/soc/fsl/fsl_hifi4.c b/sound/soc/fsl/fsl_hifi4.c
index 427d63e..b54d149 100644
--- a/sound/soc/fsl/fsl_hifi4.c
+++ b/sound/soc/fsl/fsl_hifi4.c
@@ -65,7 +65,7 @@ long load_dpu_with_library(struct fsl_hifi4 *hifi4_priv)
 	srambuf = kmalloc(filesize, GFP_KERNEL);
 	vfs_llseek(fpInfile, 0, SEEK_SET);
 
-	kernel_read(fpInfile, 0, srambuf, filesize);
+	kernel_read(fpInfile, srambuf, filesize, NULL);
 	filp_close(fpInfile, NULL);
 
 	ret_val = xtlib_split_pi_library_size(
@@ -1196,7 +1196,7 @@ static void hifi4_load_firmware(const struct firmware *fw, void *context)
 
 	/* start the core */
 	sc_pm_cpu_start(hifi4_priv->hifi_ipcHandle,
-					SC_R_HIFI, true, hifi4_priv->iram);
+					SC_R_DSP, true, hifi4_priv->iram);
 }
 
 /* Initialization of the MU code. */
@@ -1301,13 +1301,13 @@ static int fsl_hifi4_probe(struct platform_device *pdev)
 	};
 
 	if (sc_pm_set_resource_power_mode(hifi4_priv->hifi_ipcHandle,
-			SC_R_HIFI, SC_PM_PW_MODE_ON) != SC_ERR_NONE) {
+			SC_R_DSP, SC_PM_PW_MODE_ON) != SC_ERR_NONE) {
 		dev_err(&pdev->dev, "Error power on HIFI\n");
 		return -EIO;
 	}
 
 	if (sc_pm_set_resource_power_mode(hifi4_priv->hifi_ipcHandle,
-			SC_R_HIFI_RAM, SC_PM_PW_MODE_ON) != SC_ERR_NONE) {
+			SC_R_DSP_RAM, SC_PM_PW_MODE_ON) != SC_ERR_NONE) {
 		dev_err(&pdev->dev, "Error power on HIFI RAM\n");
 		return -EIO;
 	}
-- 
1.7.9.5

