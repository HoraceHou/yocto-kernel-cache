From a103b9587d65c6e9f9ca6a5b547c69b952f7910b Mon Sep 17 00:00:00 2001
From: Franck LENORMAND <franck.lenormand@nxp.com>
Date: Mon, 25 Jun 2018 09:42:22 +0200
Subject: [PATCH 4205/5242] MLK-18082: boot: dtsi: Align DTSI

commit  f93f0e3419755ea9600ecafe9b91193faf24c416 from
https://source.codeaurora.org/external/imx/linux-imx.git

Signed-off-by: Franck LENORMAND <franck.lenormand@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 .../devicetree/bindings/crypto/fsl-sec4.txt        |   90 +++++++++++++++++++-
 arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi      |    5 ++
 arch/arm64/boot/dts/freescale/fsl-imx8mq.dtsi      |   32 +++++++
 .../boot/dts/freescale/fsl-imx8qm-device.dtsi      |   63 ++++++++++++++
 .../boot/dts/freescale/fsl-imx8qm-mek-dom0.dts     |    5 ++
 .../boot/dts/freescale/fsl-imx8qm-mek-domu.dts     |    2 +
 6 files changed, 195 insertions(+), 2 deletions(-)

diff --git a/Documentation/devicetree/bindings/crypto/fsl-sec4.txt b/Documentation/devicetree/bindings/crypto/fsl-sec4.txt
index 5cf810e..7747810 100644
--- a/Documentation/devicetree/bindings/crypto/fsl-sec4.txt
+++ b/Documentation/devicetree/bindings/crypto/fsl-sec4.txt
@@ -389,8 +389,7 @@ Secure Non-Volatile Storage (SNVS) Node
 
     Node defines address range and the associated
     interrupt for the SNVS function.  This function
-    monitors security state information & reports
-    security violations. This also included rtc,
+    monitors security state information. This also included rtc,
     system power off and ON/OFF key.
 
   - compatible
@@ -452,6 +451,79 @@ EXAMPLE
 	};
 
 =====================================================================
+CAAM SNVS Node
+  Load the SECVIO node.
+
+  - compatible
+      Usage: required
+      Value type: <string>
+      Definition: Must include "fsl,imx6q-caam-snvs".
+
+  - reg
+      Usage: required
+      Value type: <prop-encoded-array>
+      Definition: A standard property.  Specifies the physical
+          address and length of the SEC4 configuration
+          registers.
+
+=====================================================================
+Security Violation (SECVIO) Node
+  Reports security violations.
+
+  - compatible
+      Usage: required
+      Value type: <string>
+      Definition: Must include "fsl,imx7d-caam-secvio" or
+        "fsl,imx6q-caam-secvio".
+
+   - interrupts
+      Usage: required
+      Value type: <prop_encoded-array>
+      Definition:  Specifies the interrupts generated by this
+           device.  The value of the interrupts property
+           consists of one interrupt specifier. The format
+           of the specifier is defined by the binding document
+           describing the node's interrupt parent.
+
+  - jtag-tamper
+       Usage: optional-but-recommended
+       Value type: <string>
+       Definition:
+           Security tamper on the JTAG
+           Must include "enabled" to enable.
+
+  - watchdog-tamper
+       Usage: optional-but-recommended
+       Value type: <string>
+       Definition:
+           Security tamper on the watchdog
+           Must include "enabled" to enable.
+
+  - internal-boot-tamper
+       Usage: optional-but-recommended
+       Value type: <string>
+       Definition:
+           Security tamper on the internal boot
+           Must include "enabled" to enable.
+
+  - external-pin-tamper
+       Usage: optional-but-recommended
+       Value type: <string>
+       Definition:
+           Security tamper on the external pin
+           Must include "enabled" to enable.
+
+EXAMPLE
+    irq_sec_vio: caam_secvio {
+      compatible = "fsl,imx7d-caam-secvio", "fsl,imx6q-caam-secvio";
+      interrupts = <GIC_SPI 20 IRQ_TYPE_LEVEL_HIGH>;
+      jtag-tamper = "disabled";
+      watchdog-tamper = "enabled";
+      internal-boot-tamper = "enabled";
+      external-pin-tamper = "disabled";
+    };
+
+=====================================================================
 Secure Non-Volatile Storage (SNVS) Low Power (LP) RTC Node
 
   A SNVS child node that defines SNVS LP RTC.
@@ -645,4 +717,18 @@ FULL EXAMPLE
 		};
 	};
 
+  caam_snvs: caam-snvs@30370000 {
+    compatible = "fsl,imx6q-caam-snvs";
+    reg = <0x30370000 0x10000>;
+  };
+
+  irq_sec_vio: caam_secvio {
+    compatible = "fsl,imx7d-caam-secvio", "fsl,imx6q-caam-secvio";
+    interrupts = <GIC_SPI 20 IRQ_TYPE_LEVEL_HIGH>;
+    jtag-tamper = "disabled";
+    watchdog-tamper = "enabled";
+    internal-boot-tamper = "enabled";
+    external-pin-tamper = "disabled";
+  };
+
 =====================================================================
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi
index fc1d3ae..4b48a46 100755
--- a/arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8mm.dtsi
@@ -1189,6 +1189,11 @@
 		reg = <0 0x00100000 0 0x7fff>;
 	};
 
+	caam_snvs: caam-snvs@30370000 {
+		compatible = "fsl,imx6q-caam-snvs";
+		reg = <0 0x30370000 0 0x10000>;
+	};
+
 	irq_sec_vio: caam_secvio {
 		compatible = "fsl,imx7d-caam-secvio", "fsl,imx6q-caam-secvio";
 		interrupts = <GIC_SPI 20 IRQ_TYPE_LEVEL_HIGH>;
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8mq.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8mq.dtsi
index 74e1376..37c2c48 100755
--- a/arch/arm64/boot/dts/freescale/fsl-imx8mq.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8mq.dtsi
@@ -1362,6 +1362,38 @@
 		};
 	};
 
+	crypto: caam@30900000 {
+		compatible = "fsl,sec-v4.0";
+		#address-cells = <0x1>;
+		#size-cells = <0x1>;
+		reg = <0 0x30900000 0 0x40000>;
+		ranges = <0 0 0x30900000 0x40000>;
+		interrupts = <GIC_SPI 91 IRQ_TYPE_LEVEL_HIGH>;
+
+		sec_jr0: jr0@1000 {
+			 compatible = "fsl,sec-v4.0-job-ring";
+			 reg = <0x1000 0x1000>;
+			 interrupts = <GIC_SPI 105 IRQ_TYPE_LEVEL_HIGH>;
+		};
+
+		sec_jr1: jr1@2000 {
+			 compatible = "fsl,sec-v4.0-job-ring";
+			 reg = <0x2000 0x1000>;
+			 interrupts = <GIC_SPI 106 IRQ_TYPE_LEVEL_HIGH>;
+		};
+
+		sec_jr2: jr2@3000 {
+			 compatible = "fsl,sec-v4.0-job-ring";
+			 reg = <0x3000 0x1000>;
+			 interrupts = <GIC_SPI 114 IRQ_TYPE_LEVEL_HIGH>;
+		};
+	};
+
+	caam_sm: caam-sm@00100000 {
+		compatible = "fsl,imx6q-caam-sm";
+		reg = <0 0x00100000 0 0x7fff>;
+	};
+
 	caam_snvs: caam-snvs@30370000 {
 		compatible = "fsl,imx6q-caam-snvs";
 		reg = <0 0x30370000 0 0x10000>;
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm-device.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8qm-device.dtsi
index 03307a5..37b142c 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm-device.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm-device.dtsi
@@ -1347,6 +1347,30 @@
 				early_power_on;
 			};
 		};
+
+		pd_caam: PD_CAAM {
+			compatible = "nxp,imx8-pd";
+			reg = <SC_R_LAST>;
+			#power-domain-cells = <0>;
+			#address-cells = <1>;
+			#size-cells = <0>;
+
+			pd_caam_jr1: PD_CAAM_JR1 {
+				reg = <SC_R_CAAM_JR1>;
+				#power-domain-cells = <0>;
+				power-domains = <&pd_caam>;
+			};
+			pd_caam_jr2: PD_CAAM_JR2 {
+				reg = <SC_R_CAAM_JR2>;
+				#power-domain-cells = <0>;
+				power-domains = <&pd_caam>;
+			};
+			pd_caam_jr3: PD_CAAM_JR3 {
+				reg = <SC_R_CAAM_JR3>;
+				#power-domain-cells = <0>;
+				power-domains = <&pd_caam>;
+			};
+		};
 	};
 
 	tsens: thermal-sensor {
@@ -4118,6 +4142,45 @@
 		};
 	};
 
+	crypto: caam@0x31400000 {
+		compatible = "fsl,sec-v4.0";
+		reg = <0 0x31400000 0 0x400000>;
+		interrupts = <GIC_SPI 148 IRQ_TYPE_LEVEL_HIGH>;
+		#address-cells = <1>;
+		#size-cells = <1>;
+		ranges = <0 0 0x31400000 0x400000>;
+		fsl,first-jr-index = <2>;
+
+		sec_jr1: jr1@0x20000 {
+			compatible = "fsl,sec-v4.0-job-ring";
+			reg = <0x20000 0x1000>;
+			interrupts = <GIC_SPI 452 IRQ_TYPE_LEVEL_HIGH>;
+			power-domains = <&pd_caam_jr1>;
+			status = "disabled";
+		};
+
+		sec_jr2: jr2@30000 {
+			compatible = "fsl,sec-v4.0-job-ring";
+			reg = <0x30000 0x1000>;
+			interrupts = <GIC_SPI 453 IRQ_TYPE_LEVEL_HIGH>;
+			power-domains = <&pd_caam_jr2>;
+			status = "okay";
+		};
+
+		sec_jr3: jr3@40000 {
+			compatible = "fsl,sec-v4.0-job-ring";
+			reg = <0x40000 0x1000>;
+			interrupts = <GIC_SPI 454 IRQ_TYPE_LEVEL_HIGH>;
+			power-domains = <&pd_caam_jr3>;
+			status = "okay";
+		};
+	};
+
+	caam_sm: caam-sm@31800000 {
+		compatible = "fsl,imx6q-caam-sm";
+		reg = <0 0x31800000 0 0x1ffff>;
+	};
+
 	sc_pwrkey: sc-powerkey {
 		compatible = "fsl,imx8-pwrkey";
 		linux,keycode = <KEY_POWER>;
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-dom0.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-dom0.dts
index 9dec28c..d4ae5b3 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-dom0.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-dom0.dts
@@ -209,6 +209,11 @@
 	xen,passthrough;
 };
 
+&crypto {
+	/* Met CAAM failure on A0, disable it first */
+	status = "disabled";
+};
+
 &dpu2_intsteer {
 	xen,passthrough;
 };
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-domu.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-domu.dts
index 434c2ec..d83c37c 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-domu.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm-mek-domu.dts
@@ -495,6 +495,8 @@
 /delete-node/ &intmux_cm40;
 /delete-node/ &intmux_cm41;
 /delete-node/ &imx_rpmsg;
+/delete-node/ &crypto;
+/delete-node/ &caam_sm;
 /delete-node/ &sc_pwrkey;
 /delete-node/ &wdog;
 /delete-node/ &wu;
-- 
1.7.9.5

