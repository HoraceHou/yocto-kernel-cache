From 2890a4f16c258f5bf831a3448addffc4e46ac8da Mon Sep 17 00:00:00 2001
From: "Guoniu.Zhou" <guoniu.zhou@nxp.com>
Date: Thu, 25 Oct 2018 11:14:52 +0800
Subject: [PATCH 5005/5242] MLK-20046-2: ISI: add YUV444M format support

commit  e32c1ce18902f79662ac90077d8c57e7c0b4d292 from
https://source.codeaurora.org/external/imx/linux-imx.git

add YUV444M format support

Signed-off-by: Guoniu.Zhou <guoniu.zhou@nxp.com>
(cherry picked from commit e424d16926d0320b31850bdd293e77c164a80661)
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/media/platform/imx8/mxc-isi-cap.c |    8 ++++++++
 drivers/media/platform/imx8/mxc-isi-hw.c  |    2 ++
 drivers/media/platform/imx8/mxc-isi-m2m.c |    2 +-
 3 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/drivers/media/platform/imx8/mxc-isi-cap.c b/drivers/media/platform/imx8/mxc-isi-cap.c
index 703cfed..0eaa1fc 100644
--- a/drivers/media/platform/imx8/mxc-isi-cap.c
+++ b/drivers/media/platform/imx8/mxc-isi-cap.c
@@ -98,6 +98,14 @@ struct mxc_isi_fmt mxc_isi_out_formats[] = {
 		.memplanes	= 2,
 		.colplanes	= 2,
 		.mbus_code	= MEDIA_BUS_FMT_YUYV8_1X16,
+	}, {
+		.name		= "YUV444M (Y-U-V)",
+		.fourcc		= V4L2_PIX_FMT_YUV444M,
+		.depth		= { 8, 8, 8 },
+		.color		= MXC_ISI_OUT_FMT_YUV444_3P8P,
+		.memplanes	= 3,
+		.colplanes	= 3,
+		.mbus_code	= MEDIA_BUS_FMT_YUV8_1X24,
 	}
 };
 
diff --git a/drivers/media/platform/imx8/mxc-isi-hw.c b/drivers/media/platform/imx8/mxc-isi-hw.c
index 6f0d7be..f9736c5 100644
--- a/drivers/media/platform/imx8/mxc-isi-hw.c
+++ b/drivers/media/platform/imx8/mxc-isi-hw.c
@@ -84,6 +84,7 @@ static bool is_rgb(u32 pix_fmt)
 {
 	if ((pix_fmt == V4L2_PIX_FMT_RGB565) ||
 		(pix_fmt == V4L2_PIX_FMT_RGB24) ||
+		(pix_fmt == V4L2_PIX_FMT_BGR32) ||
 		(pix_fmt == V4L2_PIX_FMT_XRGB32) ||
 		(pix_fmt == V4L2_PIX_FMT_BGR24) ||
 	    (pix_fmt == V4L2_PIX_FMT_ARGB32)) {
@@ -97,6 +98,7 @@ static bool is_yuv(u32 pix_fmt)
 {
 	if ((pix_fmt == V4L2_PIX_FMT_YUYV) ||
 		(pix_fmt == V4L2_PIX_FMT_YUV32) ||
+		(pix_fmt == V4L2_PIX_FMT_YUV444M) ||
 		(pix_fmt == V4L2_PIX_FMT_NV12)) {
 		return true;
 	} else {
diff --git a/drivers/media/platform/imx8/mxc-isi-m2m.c b/drivers/media/platform/imx8/mxc-isi-m2m.c
index 65c7df0..805c0ee 100644
--- a/drivers/media/platform/imx8/mxc-isi-m2m.c
+++ b/drivers/media/platform/imx8/mxc-isi-m2m.c
@@ -39,7 +39,7 @@
 #define file_to_ctx(file)		\
 	container_of(file->private_data, struct mxc_isi_ctx, fh);
 
-extern struct mxc_isi_fmt mxc_isi_out_formats[8];
+extern struct mxc_isi_fmt mxc_isi_out_formats[9];
 
 struct mxc_isi_fmt mxc_isi_input_formats[] = {
 	/* Pixel link input format */
-- 
1.7.9.5

