From d8b7fcfed908da3db0f1fa7a96a8cf7dc260dd2f Mon Sep 17 00:00:00 2001
From: ming_qian <ming.qian@nxp.com>
Date: Fri, 12 Oct 2018 13:31:07 +0800
Subject: [PATCH 4828/5242] MLK-19903:VPU Encoder:flush output when stopping
 stream

commit  ea38427f16cfe1a6a6d2f93eef5f6e784ec9a90e from
https://source.codeaurora.org/external/imx/linux-imx.git

Signed-off-by: ming_qian <ming.qian@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c |    4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c b/drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c
index 782be32..7dba231 100644
--- a/drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c
+++ b/drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c
@@ -987,6 +987,7 @@ static int v4l2_ioctl_streamon(struct file *file,
 	ret = vb2_streamon(&q_data->vb2_q,
 			i);
 	ctx->forceStop = false;
+	ctx->firmware_stopped = false;
 	return ret;
 }
 
@@ -1323,9 +1324,6 @@ static void report_stream_done(struct vpu_ctx *ctx,  MEDIAIP_ENC_PIC_INFO *pEncP
 			break;
 	}
 
-	if (ctx->forceStop)
-		return;
-
 	if (!list_empty(&This->drv_q)) {
 		down(&This->drv_q_lock);
 
-- 
1.7.9.5

