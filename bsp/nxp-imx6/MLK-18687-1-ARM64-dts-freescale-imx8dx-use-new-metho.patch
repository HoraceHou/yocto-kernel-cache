From 9a93430c1d30dde17c903b9c8dd3e8b5c97dfacd Mon Sep 17 00:00:00 2001
From: Anson Huang <Anson.Huang@nxp.com>
Date: Tue, 26 Jun 2018 13:38:20 +0800
Subject: [PATCH 4097/5242] MLK-18687-1 ARM64: dts: freescale: imx8dx: use new
 method to disable DRC thermal sensor

commit  cce29924d17c6c3bc02a562177495b1c78ba986a from
https://source.codeaurora.org/external/imx/linux-imx.git

The imx_sc_thermal driver has strict thermal zone and sensor
id relationship with device tree settings, simple removing
DRC thermal zone node will introduce incorrect sensor id
settings for other thermal zones, so adding status for driver
to ignore those thermal zones with status equal "disabled".

Signed-off-by: Anson Huang <Anson.Huang@nxp.com>
Acked-by: Leonard Crestez <leonard.crestez@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-imx8dx.dtsi     |   21 ++++++++++++++++++++-
 arch/arm64/boot/dts/freescale/fsl-imx8qxp-mek.dts |    4 ++--
 2 files changed, 22 insertions(+), 3 deletions(-)

diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8dx.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8dx.dtsi
index a0c1ad8..d7fb321 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8dx.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8dx.dtsi
@@ -1355,7 +1355,7 @@
 	tsens: thermal-sensor {
 		compatible = "nxp,imx8qxp-sc-tsens";
 		/* number of the temp sensor on the chip */
-		tsens-num = <1>;
+		tsens-num = <2>;
 		#thermal-sensor-cells = <1>;
 	};
 
@@ -1386,6 +1386,25 @@
 				};
 			};
 		};
+
+		drc-thermal0 {
+			polling-delay-passive = <250>;
+			polling-delay = <2000>;
+			thermal-sensors = <&tsens 1>;
+			status = "disabled";
+			trips {
+				drc_alert0: trip0 {
+					temperature = <85000>;
+					hysteresis = <2000>;
+					type = "passive";
+				};
+				drc_crit0: trip1 {
+					temperature = <127000>;
+					hysteresis = <2000>;
+					type = "critical";
+				};
+			};
+		};
 	};
 
 	irqsteer_csi: irqsteer@58220000 {
diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qxp-mek.dts b/arch/arm64/boot/dts/freescale/fsl-imx8qxp-mek.dts
index 9d73d5c..1fd07c1 100755
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qxp-mek.dts
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qxp-mek.dts
@@ -1135,14 +1135,14 @@
 };
 
 &tsens {
-	tsens-num = <2>;
+	tsens-num = <3>;
 };
 
 &thermal_zones {
 	pmic-thermal0 {
 		polling-delay-passive = <250>;
 		polling-delay = <2000>;
-		thermal-sensors = <&tsens 1>;
+		thermal-sensors = <&tsens 2>;
 		trips {
 			pmic_alert0: trip0 {
 				temperature = <80000>;
-- 
1.7.9.5

