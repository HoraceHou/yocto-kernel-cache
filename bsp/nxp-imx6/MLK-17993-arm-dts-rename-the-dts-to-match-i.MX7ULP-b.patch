From e0fa8e530987b9e33a3264208f63d80555d517d1 Mon Sep 17 00:00:00 2001
From: Shenwei Wang <shenwei.wang@nxp.com>
Date: Tue, 10 Apr 2018 22:38:13 -0500
Subject: [PATCH 3600/5242] MLK-17993: arm: dts: rename the dts to match
 i.MX7ULP board design

commit  78ef7a19281447a4a35fc88cb68c77763662c306 from
https://source.codeaurora.org/external/imx/linux-imx.git

The default display interface on i.MX7ULP EVK board is the HDMI
interface, and a hardware rework is required to support the MIPI
panel. To match the current board design, added the HDMI node in
the imx7ulp-evk.dts and created a  new file named imx7ulp-evk-mipi.dts.

Signed-off-by: Shenwei Wang <shenwei.wang@nxp.com>
Reviewed-by: Andy Duan <fugang.duan@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm/boot/dts/Makefile             |    2 +-
 arch/arm/boot/dts/imx7ulp-evk-hdmi.dts |   26 --------------------------
 arch/arm/boot/dts/imx7ulp-evk-mipi.dts |   27 +++++++++++++++++++++++++++
 arch/arm/boot/dts/imx7ulp-evk.dts      |   28 ++++++++++++++++++++--------
 4 files changed, 48 insertions(+), 35 deletions(-)
 delete mode 100644 arch/arm/boot/dts/imx7ulp-evk-hdmi.dts
 create mode 100644 arch/arm/boot/dts/imx7ulp-evk-mipi.dts

diff --git a/arch/arm/boot/dts/Makefile b/arch/arm/boot/dts/Makefile
index 0453292..443969d 100644
--- a/arch/arm/boot/dts/Makefile
+++ b/arch/arm/boot/dts/Makefile
@@ -722,7 +722,7 @@ dtb-$(CONFIG_SOC_IMX7ULP) += \
 	imx7ulp-evk-lpuart.dtb \
 	imx7ulp-evk-qspi.dtb \
 	imx7ulp-evk-wm8960.dtb \
-	imx7ulp-evk-hdmi.dtb \
+	imx7ulp-evk-mipi.dtb \
 	imx7ulp-evk-sensors-to-i2c5.dtb
 dtb-$(CONFIG_SOC_LS1021A) += \
 	ls1021a-moxa-uc-8410a.dtb \
diff --git a/arch/arm/boot/dts/imx7ulp-evk-hdmi.dts b/arch/arm/boot/dts/imx7ulp-evk-hdmi.dts
deleted file mode 100644
index d56c8e1..0000000
--- a/arch/arm/boot/dts/imx7ulp-evk-hdmi.dts
+++ /dev/null
@@ -1,26 +0,0 @@
-/*
- * Copyright 2017 NXP.
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License version 2 as
- * published by the Free Software Foundation.
- */
-
-#include "imx7ulp-evk.dts"
-
-&adv7535 {
-	status = "okay";
-	port {
-		dsi_to_hdmi: endpoint {
-			remote-endpoint = <&mipi_dsi_ep>;
-		};
-	};
-};
-
-&mipi_dsi {
-	port {
-		mipi_dsi_ep: endpoint {
-			remote-endpoint = <&dsi_to_hdmi>;
-		};
-	};
-};
diff --git a/arch/arm/boot/dts/imx7ulp-evk-mipi.dts b/arch/arm/boot/dts/imx7ulp-evk-mipi.dts
new file mode 100644
index 0000000..2c10cba
--- /dev/null
+++ b/arch/arm/boot/dts/imx7ulp-evk-mipi.dts
@@ -0,0 +1,27 @@
+/*
+ * Copyright 2017 NXP.
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+#include "imx7ulp-evk.dts"
+
+&adv7535 {
+	status = "disabled";
+
+	/delete-node/ port;
+};
+
+&mipi_dsi {
+	pinctrl-names = "default", "sleep";
+	pinctrl-0 = <&pinctrl_mipi_dsi_reset>;
+	pinctrl-1 = <&pinctrl_mipi_dsi_reset>;
+	lcd_panel = "TRULY-WVGA-TFT3P5581E";
+	resets = <&mipi_dsi_reset>;
+
+	/delete-node/ port;
+};
+
+
diff --git a/arch/arm/boot/dts/imx7ulp-evk.dts b/arch/arm/boot/dts/imx7ulp-evk.dts
index c9f6cf9..90b0d76 100644
--- a/arch/arm/boot/dts/imx7ulp-evk.dts
+++ b/arch/arm/boot/dts/imx7ulp-evk.dts
@@ -439,9 +439,9 @@
 		interrupt-parent = <&gpio_ptc>;
 		interrupts = <18 IRQ_TYPE_EDGE_FALLING>;
 		video-mode = <1>; /*
-			           * Only support CEA modes.
-			           * Reference mxc_edid.c
-			           */
+						   * Only support CEA modes.
+						   * Reference mxc_edid.c
+						   */
 		dsi-traffic-mode = <0>;
 		bpp = <24>;
 		status = "disabled";
@@ -463,13 +463,25 @@
 	};
 };
 
+
+&adv7535 {
+	status = "okay";
+
+	port {
+		dsi_to_hdmi: endpoint {
+			remote-endpoint = <&mipi_dsi_ep>;
+		};
+	};
+};
+
 &mipi_dsi {
-	pinctrl-names = "default", "sleep";
-	pinctrl-0 = <&pinctrl_mipi_dsi_reset>;
-	pinctrl-1 = <&pinctrl_mipi_dsi_reset>;
-	lcd_panel = "TRULY-WVGA-TFT3P5581E";
-	resets = <&mipi_dsi_reset>;
 	status = "okay";
+
+	port {
+		mipi_dsi_ep: endpoint {
+			remote-endpoint = <&dsi_to_hdmi>;
+		};
+	};
 };
 
 &lpuart4 { /* console */
-- 
1.7.9.5

