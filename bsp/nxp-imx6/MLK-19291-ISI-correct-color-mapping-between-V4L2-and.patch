From ac2ac117ad6a50bd8d80117ae30cb8240cf07014 Mon Sep 17 00:00:00 2001
From: "Guoniu.Zhou" <guoniu.zhou@nxp.com>
Date: Thu, 8 Nov 2018 19:25:44 +0800
Subject: [PATCH 5095/5242] MLK-19291: ISI: correct color mapping between V4L2
 and ISI

commit  03c8d9b87dac360f473bd51e5ccce36fe19b1bd4 from
https://source.codeaurora.org/external/imx/linux-imx.git

Correct color mapping between V4L2 and ISI

Signed-off-by: Guoniu.Zhou <guoniu.zhou@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/media/platform/imx8/mxc-isi-cap.c |   36 ++++++++++++++---------------
 drivers/media/platform/imx8/mxc-isi-hw.c  |    3 +++
 drivers/media/platform/imx8/mxc-isi-m2m.c |   11 ++-------
 3 files changed, 23 insertions(+), 27 deletions(-)

diff --git a/drivers/media/platform/imx8/mxc-isi-cap.c b/drivers/media/platform/imx8/mxc-isi-cap.c
index cf86e99..664eeb5 100644
--- a/drivers/media/platform/imx8/mxc-isi-cap.c
+++ b/drivers/media/platform/imx8/mxc-isi-cap.c
@@ -46,15 +46,7 @@ struct mxc_isi_fmt mxc_isi_out_formats[] = {
 		.name		= "RGB24",
 		.fourcc		= V4L2_PIX_FMT_RGB24,
 		.depth		= { 24 },
-		.color		= MXC_ISI_OUT_FMT_RGB32P,
-		.memplanes	= 1,
-		.colplanes	= 1,
-		.mbus_code  = MEDIA_BUS_FMT_RGB888_1X24,
-	}, {
-		.name		= "RGB32",
-		.fourcc		= V4L2_PIX_FMT_XRGB32,
-		.depth		= { 32 },
-		.color		= MXC_ISI_OUT_FMT_XRGB32,
+		.color		= MXC_ISI_OUT_FMT_BGR32P,
 		.memplanes	= 1,
 		.colplanes	= 1,
 		.mbus_code  = MEDIA_BUS_FMT_RGB888_1X24,
@@ -62,19 +54,11 @@ struct mxc_isi_fmt mxc_isi_out_formats[] = {
 		.name		= "BGR24",
 		.fourcc		= V4L2_PIX_FMT_BGR24,
 		.depth		= { 24 },
-		.color		= MXC_ISI_OUT_FMT_BGR32P,
+		.color		= MXC_ISI_OUT_FMT_RGB32P,
 		.memplanes	= 1,
 		.colplanes	= 1,
 		.mbus_code  = MEDIA_BUS_FMT_BGR888_1X24,
 	}, {
-		.name		= "ARGB32",
-		.fourcc		= V4L2_PIX_FMT_ARGB32,
-		.depth		= { 32 },
-		.color		= MXC_ISI_OUT_FMT_ARGB32,
-		.memplanes	= 1,
-		.colplanes	= 1,
-		.mbus_code  = MEDIA_BUS_FMT_ARGB8888_1X32,
-	}, {
 		.name		= "YUYV-16",
 		.fourcc		= V4L2_PIX_FMT_YUYV,
 		.depth		= { 16 },
@@ -106,6 +90,22 @@ struct mxc_isi_fmt mxc_isi_out_formats[] = {
 		.memplanes	= 3,
 		.colplanes	= 3,
 		.mbus_code	= MEDIA_BUS_FMT_YUV8_1X24,
+	}, {
+		.name		= "xBGR32",
+		.fourcc		= V4L2_PIX_FMT_XBGR32,
+		.depth		= { 32 },
+		.color		= MXC_ISI_OUT_FMT_XRGB32,
+		.memplanes	= 1,
+		.colplanes	= 1,
+		.mbus_code	= MEDIA_BUS_FMT_RGB888_1X24,
+	}, {
+		.name		= "ABGR32",
+		.fourcc		= V4L2_PIX_FMT_ABGR32,
+		.depth		= { 32 },
+		.color		= MXC_ISI_OUT_FMT_ARGB32,
+		.memplanes	= 1,
+		.colplanes	= 1,
+		.mbus_code	= MEDIA_BUS_FMT_RGB888_1X24,
 	}
 };
 
diff --git a/drivers/media/platform/imx8/mxc-isi-hw.c b/drivers/media/platform/imx8/mxc-isi-hw.c
index f9736c5..0e99dd1 100644
--- a/drivers/media/platform/imx8/mxc-isi-hw.c
+++ b/drivers/media/platform/imx8/mxc-isi-hw.c
@@ -84,9 +84,12 @@ static bool is_rgb(u32 pix_fmt)
 {
 	if ((pix_fmt == V4L2_PIX_FMT_RGB565) ||
 		(pix_fmt == V4L2_PIX_FMT_RGB24) ||
+		(pix_fmt == V4L2_PIX_FMT_RGB32) ||
 		(pix_fmt == V4L2_PIX_FMT_BGR32) ||
 		(pix_fmt == V4L2_PIX_FMT_XRGB32) ||
+		(pix_fmt == V4L2_PIX_FMT_XBGR32) ||
 		(pix_fmt == V4L2_PIX_FMT_BGR24) ||
+		(pix_fmt == V4L2_PIX_FMT_ABGR32) ||
 	    (pix_fmt == V4L2_PIX_FMT_ARGB32)) {
 		return true;
 	} else {
diff --git a/drivers/media/platform/imx8/mxc-isi-m2m.c b/drivers/media/platform/imx8/mxc-isi-m2m.c
index 805c0ee..f8dfe02 100644
--- a/drivers/media/platform/imx8/mxc-isi-m2m.c
+++ b/drivers/media/platform/imx8/mxc-isi-m2m.c
@@ -44,20 +44,13 @@
 struct mxc_isi_fmt mxc_isi_input_formats[] = {
 	/* Pixel link input format */
 	{
-		.name		= "RGB32",
-		.fourcc		= V4L2_PIX_FMT_XRGB32,
+		.name		= "XBGR32",
+		.fourcc		= V4L2_PIX_FMT_XBGR32,
 		.depth		= { 32 },
 		.color =	MXC_ISI_M2M_IN_FMT_XRGB8,
 		.memplanes	= 1,
 		.colplanes	= 1,
 	}, {
-		.name		= "BGR32",
-		.fourcc		= V4L2_PIX_FMT_BGR32,
-		.depth		= { 32 },
-		.color =	MXC_ISI_M2M_IN_FMT_XBGR8,
-		.memplanes	= 1,
-		.colplanes	= 1,
-	}, {
 		.name		= "RGB565",
 		.fourcc		= V4L2_PIX_FMT_RGB565,
 		.depth		= { 16 },
-- 
1.7.9.5

