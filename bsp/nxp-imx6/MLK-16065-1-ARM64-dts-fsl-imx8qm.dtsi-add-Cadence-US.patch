From bfbd0ebaf5c1c3c82b0761db83bf0752de2c62ac Mon Sep 17 00:00:00 2001
From: Peter Chen <peter.chen@nxp.com>
Date: Mon, 24 Jul 2017 15:11:49 +0800
Subject: [PATCH 2402/5242] MLK-16065-1 ARM64: dts: fsl-imx8qm.dtsi: add
 Cadence USB3 support

commit  e526b6f3ed23fd299e6a0c6114d85692216b657e from
https://source.codeaurora.org/external/imx/linux-imx.git

Add Cadence USB3 controller and phy, the phy uses generic USB PHY
driver.

Signed-off-by: Peter Chen <peter.chen@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi |   32 +++++++++++++++++++++++++
 1 file changed, 32 insertions(+)

diff --git a/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi b/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
index 91ef2e5..c5eee90 100644
--- a/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-imx8qm.dtsi
@@ -420,6 +420,11 @@
 				#power-domain-cells = <0>;
 				power-domains = <&pd_conn>;
 			};
+			pd_conn_usb2_phy: PD_CONN_USB_2_PHY {
+				reg = <SC_R_USB_2_PHY>;
+				#power-domain-cells = <0>;
+				power-domains = <&pd_conn>;
+			};
 			pd_conn_sdch0: PD_CONN_SDHC_0 {
 				reg = <SC_R_SDHC_0>;
 				#power-domain-cells = <0>;
@@ -2273,6 +2278,13 @@
 
 	};
 
+	usbphynop1: usbphynop1 {
+		compatible = "usb-nop-xceiv";
+		clocks = <&clk IMX8QM_USB3_PHY_CLK>;
+		clock-names = "main_clk";
+		power-domains = <&pd_conn_usb2_phy>;
+	};
+
 	usbotg1: usb@5b0d0000 {
 		compatible = "fsl,imx7d-usb", "fsl,imx27-usb";
 		reg = <0x0 0x5b0d0000 0x0 0x200>;
@@ -2286,6 +2298,26 @@
 		power-domains = <&pd_conn_usbotg0>;
 	};
 
+	usbotg3: cdns3@5b110000 {
+		compatible = "Cadence,usb3";
+		reg = <0x0 0x5B110000 0x0 0x10000>,
+			<0x0 0x5B130000 0x0 0x10000>,
+			<0x0 0x5B140000 0x0 0x10000>,
+			<0x0 0x5B160000 0x0 0x40000>;
+		interrupt-parent = <&gic>;
+		interrupts = <GIC_SPI 271 IRQ_TYPE_LEVEL_HIGH>;
+		clocks = <&clk IMX8QM_USB3_LPM_CLK>,
+			<&clk IMX8QM_USB3_BUS_CLK>,
+			<&clk IMX8QM_USB3_ACLK>,
+			<&clk IMX8QM_USB3_IPG_CLK>,
+			<&clk IMX8QM_USB3_CORE_PCLK>;
+		clock-names = "usb3_lpm_clk", "usb3_bus_clk", "usb3_aclk",
+			"usb3_ipg_clk", "usb3_core_pclk";
+		power-domains = <&pd_conn_usb2>;
+		cdns3,usbphy = <&usbphynop1>;
+		status = "disabled";
+	};
+
 	ddr_pmu0: ddr_pmu@5c020000 {
 		compatible = "fsl,imx8-ddr-pmu";
 		reg = <0x0 0x5c020000 0x0 0x10000>;
-- 
1.7.9.5

