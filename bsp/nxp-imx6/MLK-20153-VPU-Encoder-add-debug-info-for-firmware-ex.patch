From 4b4d1495d6b077b656aa5ba49347a299ab5b3385 Mon Sep 17 00:00:00 2001
From: ming_qian <ming.qian@nxp.com>
Date: Thu, 1 Nov 2018 13:55:17 +0800
Subject: [PATCH 4986/5242] MLK-20153:VPU Encoder:add debug info for firmware
 exception event

commit  aa2c5c979d2f158b1fc272e1f14297909973dc3c from
https://source.codeaurora.org/external/imx/linux-imx.git

Signed-off-by: ming_qian <ming.qian@nxp.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/mxc/vpu-encoder-b0/mediasys_types.h |    1 +
 drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c |    4 ++++
 2 files changed, 5 insertions(+)

diff --git a/drivers/mxc/vpu-encoder-b0/mediasys_types.h b/drivers/mxc/vpu-encoder-b0/mediasys_types.h
index 98b6996..a499c5d 100644
--- a/drivers/mxc/vpu-encoder-b0/mediasys_types.h
+++ b/drivers/mxc/vpu-encoder-b0/mediasys_types.h
@@ -118,6 +118,7 @@
 	VID_API_ENC_EVENT_FRAME_RELEASE,
 	VID_API_ENC_EVENT_PARA_UPD_DONE,
 	VID_API_ENC_EVENT_MEM_REQUEST,
+	VID_API_ENC_EVENT_FIRMWARE_XCPT,
 	VID_API_ENC_EVENT_RESERVED
 } ENC_TB_API_ENC_EVENT;
 
diff --git a/drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c b/drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c
index 37eb583..e2657ac 100644
--- a/drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c
+++ b/drivers/mxc/vpu-encoder-b0/vpu_encoder_b0.c
@@ -99,6 +99,7 @@ struct vpu_frame_info {
 	ITEM_NAME(VID_API_ENC_EVENT_FRAME_RELEASE),
 	ITEM_NAME(VID_API_ENC_EVENT_PARA_UPD_DONE),
 	ITEM_NAME(VID_API_ENC_EVENT_MEM_REQUEST),
+	ITEM_NAME(VID_API_ENC_EVENT_FIRMWARE_XCPT),
 	ITEM_NAME(VID_API_ENC_EVENT_RESERVED)
 };
 
@@ -2323,6 +2324,9 @@ static void vpu_api_event_handler(struct vpu_ctx *ctx,
 		break;
 	case VID_API_ENC_EVENT_RESET_DONE:
 		break;
+	case VID_API_ENC_EVENT_FIRMWARE_XCPT:
+		vpu_err("firmware exception:%s\n", (char *)event_data);
+		break;
 	default:
 		vpu_dbg(LVL_ERR, "........unknown event : 0x%x\n", uEvent);
 		break;
-- 
1.7.9.5

