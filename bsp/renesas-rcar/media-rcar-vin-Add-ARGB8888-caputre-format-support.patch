From de81cb207118f208f976f0ef15a6927cd7feafbd Mon Sep 17 00:00:00 2001
From: Koji Matsuoka <koji.matsuoka.xm@renesas.com>
Date: Fri, 31 Aug 2018 11:28:41 +0900
Subject: [PATCH 345/909] media: rcar-vin: Add ARGB8888 caputre format support

commit b354fffb0c5e7680113d9c1ab42077bd3d7dcb18 from
git://git.kernel.org/pub/scm/linux/kernel/git/horms/renesas-bsp.git

Signed-off-by: Koji Matsuoka <koji.matsuoka.xm@renesas.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/media/platform/rcar-vin/rcar-dma.c  | 3 +++
 drivers/media/platform/rcar-vin/rcar-v4l2.c | 8 +++++++-
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/drivers/media/platform/rcar-vin/rcar-dma.c b/drivers/media/platform/rcar-vin/rcar-dma.c
index 377669a4709c..da2a1c0cfc61 100644
--- a/drivers/media/platform/rcar-vin/rcar-dma.c
+++ b/drivers/media/platform/rcar-vin/rcar-dma.c
@@ -814,6 +814,9 @@ static int rvin_setup(struct rvin_dev *vin)
 	case V4L2_PIX_FMT_RGB565:
 		dmr = 0;
 		break;
+	case V4L2_PIX_FMT_ABGR32:
+		dmr = VNDMR_EXRGB | VNDMR_DTMD_ARGB;
+		break;
 	case V4L2_PIX_FMT_XBGR32:
 		/* Note: not supported on M1 */
 		dmr = VNDMR_EXRGB;
diff --git a/drivers/media/platform/rcar-vin/rcar-v4l2.c b/drivers/media/platform/rcar-vin/rcar-v4l2.c
index e74821adc9e3..b2699d1a983b 100644
--- a/drivers/media/platform/rcar-vin/rcar-v4l2.c
+++ b/drivers/media/platform/rcar-vin/rcar-v4l2.c
@@ -58,6 +58,10 @@ static const struct rvin_video_format rvin_formats[] = {
 		.fourcc			= V4L2_PIX_FMT_ARGB555,
 		.bpp			= 2,
 	},
+	{
+		.fourcc			= V4L2_PIX_FMT_ABGR32,
+		.bpp			= 4,
+	},
 	{
 		.fourcc			= V4L2_PIX_FMT_XBGR32,
 		.bpp			= 4,
@@ -106,7 +110,9 @@ static void rvin_format_align(struct rvin_dev *vin, struct v4l2_pix_format *pix)
 	    (vin->info->model == RCAR_M1 &&
 	     pix->pixelformat == V4L2_PIX_FMT_XBGR32) ||
 	    (vin->info->model != RCAR_GEN3 &&
-	     pix->pixelformat == V4L2_PIX_FMT_NV12)) {
+	     pix->pixelformat == V4L2_PIX_FMT_NV12) ||
+	    (vin->info->model != RCAR_GEN3 &&
+	     pix->pixelformat == V4L2_PIX_FMT_ABGR32)) {
 		vin_warn(vin, "set default format, so unsupported format\n");
 		pix->pixelformat = RVIN_DEFAULT_FORMAT;
 	}
-- 
2.17.1

