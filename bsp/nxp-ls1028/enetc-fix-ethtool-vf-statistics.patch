From 9ccba4ce1a27c2a826082333fdabbaafe9e9736c Mon Sep 17 00:00:00 2001
From: Alex Marginean <alexandru.marginean@nxp.com>
Date: Wed, 28 Mar 2018 16:27:56 +0300
Subject: [PATCH 126/706] enetc: fix ethtool vf statistics

Signed-off-by: Alex Marginean <alexandru.marginean@nxp.com>
(cherry picked from commit 16e0f88be47cdd8c6a48d2d909ed3aec575ba792)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc_ethtool.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc_ethtool.c b/drivers/net/ethernet/freescale/enetc/enetc_ethtool.c
index f7ba26c00569..1b90c95ae2cb 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_ethtool.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc_ethtool.c
@@ -215,6 +215,7 @@ static int enetc_get_sset_count(struct net_device *ndev, int sset)
 
 static void enetc_get_strings(struct net_device *ndev, u32 stringset, u8 *data)
 {
+	struct enetc_ndev_priv *priv = netdev_priv(ndev);
 	u8 *p = data;
 	int i;
 
@@ -224,6 +225,9 @@ static void enetc_get_strings(struct net_device *ndev, u32 stringset, u8 *data)
 			strlcpy(p, enetc_si_counters[i].name, ETH_GSTRING_LEN);
 			p += ETH_GSTRING_LEN;
 		}
+		if (!enetc_si_is_pf(priv->si))
+			break;
+
 		for (i = 0; i < ARRAY_SIZE(enetc_port_counters); i++) {
 			strlcpy(p, enetc_port_counters[i].name,
 				ETH_GSTRING_LEN);
@@ -243,6 +247,9 @@ static void enetc_get_ethtool_stats(struct net_device *ndev,
 	for (i = 0; i < ARRAY_SIZE(enetc_si_counters); i++)
 		data[o++] = enetc_rd64(hw, enetc_si_counters[i].reg);
 
+	if (!enetc_si_is_pf(priv->si))
+		return;
+
 	for (i = 0; i < ARRAY_SIZE(enetc_port_counters); i++)
 		data[o++] = enetc_port_rd(hw, enetc_port_counters[i].reg);
 }
-- 
2.17.1

