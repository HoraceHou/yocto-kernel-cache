From c1939ea7a943c44048d464844fac8ea86862be40 Mon Sep 17 00:00:00 2001
From: Zhang Ying-22455 <ying.zhang22455@nxp.com>
Date: Mon, 3 Dec 2018 16:23:35 +0800
Subject: [PATCH 372/706] arm64: dts: ls1028a: add flextimer support

Signed-off-by: Zhang Ying-22455 <ying.zhang22455@nxp.com>
(cherry picked from commit 5b2a52eae0c48c14a02288ac587110c59adb1aa8)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 arch/arm64/boot/dts/freescale/fsl-ls1028a.dtsi | 9 +++++++++
 drivers/soc/fsl/layerscape/ftm_alarm.c         | 7 +++++++
 2 files changed, 16 insertions(+)

diff --git a/arch/arm64/boot/dts/freescale/fsl-ls1028a.dtsi b/arch/arm64/boot/dts/freescale/fsl-ls1028a.dtsi
index 20f417613e7e..1b3d9b63d0e5 100755
--- a/arch/arm64/boot/dts/freescale/fsl-ls1028a.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-ls1028a.dtsi
@@ -729,6 +729,15 @@
 			queue-sizes = <64 64>;
 		};
 
+		ftm0: ftm0@2800000 {
+			compatible = "fsl,ls1028a-ftm";
+			reg = <0x0 0x2800000 0x0 0x10000>,
+			      <0x0 0x1e34050 0x0 0x4>;
+			reg-names = "ftm", "FlexTimer1";
+			interrupts = <GIC_SPI 44 IRQ_TYPE_LEVEL_HIGH>;
+			status = "okay";
+		};
+
 		sai1: sai@f100000 {
 			#sound-dai-cells = <0>;
 			compatible = "fsl,vf610-sai";
diff --git a/drivers/soc/fsl/layerscape/ftm_alarm.c b/drivers/soc/fsl/layerscape/ftm_alarm.c
index 4c79c02cc50a..e9ef820270e8 100644
--- a/drivers/soc/fsl/layerscape/ftm_alarm.c
+++ b/drivers/soc/fsl/layerscape/ftm_alarm.c
@@ -84,6 +84,11 @@ static struct rcpm_cfg ls208xa_rcpm_cfg = {
 	.flextimer_set_bit = 0x4000,
 };
 
+static struct rcpm_cfg ls1028a_rcpm_cfg = {
+	.big_endian = LITTLE_ENDIAN,
+	.flextimer_set_bit = 0x4000,
+};
+
 static const struct of_device_id ippdexpcr_of_match[] = {
 	{ .compatible = "fsl,ls1012a-ftm-alarm", .data = &ls1012a_rcpm_cfg},
 	{ .compatible = "fsl,ls1021a-ftm-alarm", .data = &ls1021a_rcpm_cfg},
@@ -91,6 +96,7 @@ static const struct of_device_id ippdexpcr_of_match[] = {
 	{ .compatible = "fsl,ls1046a-ftm-alarm", .data = &ls1046a_rcpm_cfg},
 	{ .compatible = "fsl,ls1088a-ftm-alarm", .data = &ls1088a_rcpm_cfg},
 	{ .compatible = "fsl,ls208xa-ftm-alarm", .data = &ls208xa_rcpm_cfg},
+	{ .compatible = "fsl,ls1028a-ftm-alarm", .data = &ls1028a_rcpm_cfg},
 	{},
 };
 MODULE_DEVICE_TABLE(of, ippdexpcr_of_match);
@@ -348,6 +354,7 @@ static const struct of_device_id ftm_alarm_match[] = {
 	{ .compatible = "fsl,ls1046a-ftm-alarm", },
 	{ .compatible = "fsl,ls1088a-ftm-alarm", },
 	{ .compatible = "fsl,ls208xa-ftm-alarm", },
+	{ .compatible = "fsl,ls1028a-ftm-alarm", },
 	{ .compatible = "fsl,ftm-timer", },
 	{ },
 };
-- 
2.17.1

