From 2d7d320a05266aa1480fcd469afb1150565b277c Mon Sep 17 00:00:00 2001
From: Po Liu <Po.Liu@nxp.com>
Date: Thu, 4 Apr 2019 15:49:44 +0800
Subject: [PATCH 681/706] mscc: felix tsn switch qbv basetime express change

Signed-off-by: Po Liu <Po.Liu@nxp.com>
(cherry picked from commit ca020c9d101690c08b5079fd931114df281d9acb)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/mscc/tsn_switch.c | 10 ++++++----
 1 file changed, 6 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/mscc/tsn_switch.c b/drivers/net/ethernet/mscc/tsn_switch.c
index 5e39a010ccf5..be2015188f7b 100644
--- a/drivers/net/ethernet/mscc/tsn_switch.c
+++ b/drivers/net/ethernet/mscc/tsn_switch.c
@@ -75,8 +75,9 @@ int switch_qbv_set(struct net_device *ndev, struct tsn_qbv_conf *shaper_config)
 	int  i, count;
 	struct tsn_qbv_basic *admin_basic = &shaper_config->admin;
 	struct tsn_qbv_entry *control_list = admin_basic->control_list;
-	u32 base_time_nsec = admin_basic->base_time & 0xffffffff;
-	u64 base_time_sec = admin_basic->base_time >> 32;
+	u32 base_time_nsec = admin_basic->base_time -
+		admin_basic->base_time / 1000000000 * 1000000000;
+	u64 base_time_sec = admin_basic->base_time / 1000000000;
 	u64 cur_time;
 	u32 val;
 
@@ -744,8 +745,9 @@ int switch_qci_sgi_set(struct net_device *ndev, u32 index,
 	u32 list_length = sgi_conf->admin.control_list_length;
 	u32 cycle_time = sgi_conf->admin.cycle_time;
 	u32 cycle_time_ex = sgi_conf->admin.cycle_time_extension;
-	u32 l_basetime = sgi_conf->admin.base_time & 0x00000000ffffffff;
-	u64 h_basetime = (sgi_conf->admin.base_time & 0xffffffff00000000) >> 32;
+	u32 l_basetime = sgi_conf->admin.base_time -
+		sgi_conf->admin.base_time / 1000000000 * 1000000000;
+	u64 h_basetime = sgi_conf->admin.base_time / 1000000000;
 	u64 cur_time;
 
 	/*configure SGID*/
-- 
2.17.1

