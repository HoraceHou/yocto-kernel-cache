From 3ab875b406891f72cffc69777c5501e25c527018 Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@nxp.com>
Date: Wed, 14 Nov 2018 18:06:01 +0200
Subject: [PATCH 482/706] enetc: Fix 64b read accessors for 32b systems

Signed-off-by: Claudiu Manoil <claudiu.manoil@nxp.com>
(cherry picked from commit ff4e93a9a10fc8f180c1f739739d0e04a2f481b2)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc_hw.h | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc_hw.h b/drivers/net/ethernet/freescale/enetc/enetc_hw.h
index 5a376d4c9e6b..f5e08b6ffcda 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_hw.h
+++ b/drivers/net/ethernet/freescale/enetc/enetc_hw.h
@@ -301,7 +301,15 @@ struct enetc_hw {
 /* using this to read out stats on 32b systems */
 static inline u64 enetc_rd_reg64(void __iomem *reg)
 {
-	return __le64_to_cpu(*(u64 *)reg);
+	u32 low, high, tmp;
+
+	do {
+		high = ioread32(reg + 4);
+		low = ioread32(reg);
+		tmp = ioread32(reg + 4);
+	} while (high != tmp);
+
+	return le64_to_cpu((u64)high << 32 | low);
 }
 #endif
 
-- 
2.17.1

