From d3141a4640d34d79f7f4bd28053173170401d2df Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@nxp.com>
Date: Tue, 17 Oct 2017 14:21:06 +0300
Subject: [PATCH 065/706] enetc: Enable jumbo frame capability on Tx

Signed-off-by: Claudiu Manoil <claudiu.manoil@nxp.com>
(cherry picked from commit fef03531380a1f45d22111b59adfea869c6a4566)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc.c | 2 ++
 drivers/net/ethernet/freescale/enetc/enetc.h | 7 ++++++-
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc.c b/drivers/net/ethernet/freescale/enetc/enetc.c
index bd62f7b79b66..ed252b2efc65 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc.c
@@ -1229,6 +1229,8 @@ static void enetc_netdev_setup(struct enetc_si *si, struct net_device *ndev,
 	ndev->netdev_ops = ndev_ops;
 	enetc_set_ethtool_ops(ndev);
 	ndev->watchdog_timeo = 5 * HZ;
+	ndev->min_mtu = ETH_MIN_MTU;
+	ndev->max_mtu = ENETC_MAX_MTU;
 
 	ndev->features = NETIF_F_HIGHDMA | NETIF_F_SG;
 	ndev->priv_flags |= IFF_UNICAST_FLT;
diff --git a/drivers/net/ethernet/freescale/enetc/enetc.h b/drivers/net/ethernet/freescale/enetc/enetc.h
index 2bf8d2ffedc2..026a8e6979b8 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc.h
+++ b/drivers/net/ethernet/freescale/enetc/enetc.h
@@ -5,9 +5,14 @@
 #include <linux/dma-mapping.h>
 #include <linux/skbuff.h>
 #include <linux/ethtool.h>
+#include <linux/if_vlan.h>
 
 #include "enetc_hw.h"
 
+#define ENETC_MAC_MAXFRM_SIZE	9600
+#define ENETC_MAX_MTU		(ENETC_MAC_MAXFRM_SIZE - \
+				(ETH_FCS_LEN + ETH_HLEN + VLAN_HLEN))
+
 struct enetc_tx_swbd {
 	struct sk_buff *skb;
 	dma_addr_t dma;
@@ -16,7 +21,7 @@ struct enetc_tx_swbd {
 	u16 is_dma_page;
 };
 
-#define ENETC_RX_MAXFRM_SIZE	9600
+#define ENETC_RX_MAXFRM_SIZE	ENETC_MAC_MAXFRM_SIZE
 #define ENETC_RXB_TRUESIZE	2048 // PAGE_SIZE >> 1
 #define ENETC_RXB_PAD		NET_SKB_PAD // TODO: extra space? IP_ALIGN?
 #define ENETC_RXB_DMA_SIZE	\
-- 
2.17.1

