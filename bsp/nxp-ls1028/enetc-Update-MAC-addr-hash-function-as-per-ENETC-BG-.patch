From 03cf8290babde0a939480bd091fb15ad6124ad6f Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@nxp.com>
Date: Thu, 22 Mar 2018 16:31:02 +0200
Subject: [PATCH 121/706] enetc: Update MAC addr hash function as per ENETC BG
 v88

From ENETC BG v88 (BOM62.5) on, approx. sim model m0169+.

Signed-off-by: Claudiu Manoil <claudiu.manoil@nxp.com>
(cherry picked from commit e80bb8afa8cfd164c65b5d9e9b90b914ba76abb5)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc_pf.c | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc_pf.c b/drivers/net/ethernet/freescale/enetc/enetc_pf.c
index b80b2672e12c..4f15978b39cb 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_pf.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc_pf.c
@@ -80,12 +80,16 @@ static void enetc_set_isol_vlan(struct enetc_hw *hw, int si, u16 vlan, u8 qos)
 
 static int enetc_mac_addr_hash_idx(const u8 *addr)
 {
-	int i, n = 5;
+	u64 fold = ether_addr_to_u64(addr);
+	u64 mask = 0;
 	int res = 0;
+	int i;
 
-	for (i = 0; i < n; i++)
-		res |= (__sw_hweight8(addr[i]) & 0x1) << (n - i);
-	res |= __sw_hweight8(addr[n]) & 0x1;
+	for (i = 0; i < 8; i++)
+		mask |= BIT_ULL(i * 6);
+
+	for (i = 0; i < 6; i++)
+		res |= (__sw_hweight64(fold & (mask << i)) & 0x1) << i;
 
 	return res;
 }
-- 
2.17.1

