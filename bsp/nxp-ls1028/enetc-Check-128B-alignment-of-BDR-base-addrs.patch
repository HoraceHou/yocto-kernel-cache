From ce60db6a3b8f9c5b29ce3e948a122fa82262d8b3 Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@nxp.com>
Date: Wed, 31 Jan 2018 15:11:12 +0200
Subject: [PATCH 102/706] enetc: Check 128B alignment of BDR base addrs

Signed-off-by: Claudiu Manoil <claudiu.manoil@nxp.com>
(cherry picked from commit 9aed2012f56de09c56ea4a9f210c16b9a8caceea)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc.c b/drivers/net/ethernet/freescale/enetc/enetc.c
index b66220a6c705..06befa60a945 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc.c
@@ -871,7 +871,7 @@ static void enetc_free_cbdr(struct device *dev, struct enetc_cbdr *cbdr)
 
 static void enetc_setup_cbdr(struct enetc_hw *hw, struct enetc_cbdr *cbdr)
 {
-	WARN_ON(lower_32_bits(cbdr->bd_dma_base) & 0x1f);
+	WARN_ON(lower_32_bits(cbdr->bd_dma_base) & 0x3f);
 
 	enetc_wr(hw, ENETC_SICBDRBAR0, lower_32_bits(cbdr->bd_dma_base));
 	enetc_wr(hw, ENETC_SICBDRBAR1, upper_32_bits(cbdr->bd_dma_base));
@@ -937,7 +937,8 @@ static void enetc_setup_txbdr(struct enetc_hw *hw, struct enetc_bdr *tx_ring)
 	int idx = tx_ring->index;
 	u32 tbmr;
 
-	WARN_ON(lower_32_bits(tx_ring->bd_dma_base) & 0x1f);
+	/* 128B alignment required */
+	WARN_ON(lower_32_bits(tx_ring->bd_dma_base) & 0x3f);
 
 	enetc_txbdr_wr(hw, idx, ENETC_TBBAR0,
 		       lower_32_bits(tx_ring->bd_dma_base));
@@ -969,7 +970,8 @@ static void enetc_setup_rxbdr(struct enetc_hw *hw, struct enetc_bdr *rx_ring)
 	int idx = rx_ring->index;
 	u32 rbmr;
 
-	WARN_ON(lower_32_bits(rx_ring->bd_dma_base) & 0x1f);
+	/* 128B alignment required */
+	WARN_ON(lower_32_bits(rx_ring->bd_dma_base) & 0x3f);
 
 	enetc_rxbdr_wr(hw, idx, ENETC_RBBAR0,
 		       lower_32_bits(rx_ring->bd_dma_base));
-- 
2.17.1

