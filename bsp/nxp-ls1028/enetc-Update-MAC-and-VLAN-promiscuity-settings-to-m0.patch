From e1fdd76e9d186d0b35e800741bfd6d188c92f34e Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@nxp.com>
Date: Thu, 8 Feb 2018 16:01:15 +0200
Subject: [PATCH 105/706] enetc: Update MAC and VLAN promiscuity settings to
 m0169 (BG v86)

Signed-off-by: Claudiu Manoil <claudiu.manoil@nxp.com>
(cherry picked from commit 6e383ebba697e5bf846f715826bc454214f99160)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc_hw.h | 8 +++++---
 drivers/net/ethernet/freescale/enetc/enetc_pf.c | 4 +++-
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc_hw.h b/drivers/net/ethernet/freescale/enetc/enetc_hw.h
index bab7e8b900ee..b88a2bc22092 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_hw.h
+++ b/drivers/net/ethernet/freescale/enetc/enetc_hw.h
@@ -159,9 +159,11 @@ enum enetc_bdr_type {TX, RX};
 #define ENETC_PMR_EN	GENMASK(18, 16)
 #define ENETC_PSR	0x00004 /* RO */
 #define ENETC_PSIPMR	0x00018
-#define ENETC_PSIPMR_SET_UP(n)	(0x1 << (n)) /* n = SI index */
-#define ENETC_PSIPMR_SET_MP(n)	(0x1 << ((n) + 8))
-#define ENETC_PSIPMR_SET_VP(n)	(0x1 << ((n) + 16))
+#define ENETC_PSIPMR_SET_UP(n)	BIT(n) /* n = SI index */
+#define ENETC_PSIPMR_SET_MP(n)	BIT((n) + 16)
+#define ENETC_PSIPVMR	0x0001c
+#define ENETC_PSIPVMR_SET_VP(n)	BIT(n)
+#define ENETC_PSIPVMR_SET_VUTA(n)	BIT((n) + 16)
 #define ENETC_PSIPMAR0(n)	(0x00100 + (n) * 0x20) /* n = SI index */
 #define ENETC_PSIPMAR1(n)	(0x00104 + (n) * 0x20)
 #define ENETC_PSIIVLANR(n)	(0x00210 + (n) * 4) /* n = SI index */
diff --git a/drivers/net/ethernet/freescale/enetc/enetc_pf.c b/drivers/net/ethernet/freescale/enetc/enetc_pf.c
index cec730ccc779..c671d0082928 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_pf.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc_pf.c
@@ -327,7 +327,9 @@ static void enetc_configure_port(struct enetc_si *si)
 	enetc_port_setup_primary_mac_address(si);
 
 	/* reset promiscuity to default values, except VLAN promisc for SI0 */
-	enetc_port_wr(hw, ENETC_PSIPMR, ENETC_PSIPMR_SET_VP(0));
+	enetc_port_wr(hw, ENETC_PSIPMR, 0);
+	enetc_port_wr(hw, ENETC_PSIPVMR,
+		      ENETC_PSIPVMR_SET_VP(0) | ENETC_PSIPVMR_SET_VUTA(0));
 
 	/* enable port */
 	enetc_port_wr(hw, ENETC_PMR, ENETC_PMR_EN);
-- 
2.17.1

