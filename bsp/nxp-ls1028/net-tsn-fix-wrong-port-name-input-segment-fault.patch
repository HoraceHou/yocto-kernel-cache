From 98ef5becb77af0543ae6d9c5a1611641a010381f Mon Sep 17 00:00:00 2001
From: Po Liu <Po.Liu@nxp.com>
Date: Tue, 26 Feb 2019 10:25:50 +0800
Subject: [PATCH 654/706] net: tsn: fix wrong port name input segment fault

Signed-off-by: Po Liu <Po.Liu@nxp.com>
(cherry picked from commit 11b7e3371ef2e6b0bd4f19382aefe3238f164217)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 net/tsn/genl_tsn.c | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/net/tsn/genl_tsn.c b/net/tsn/genl_tsn.c
index fd2d3047ea2d..49bc331d9720 100644
--- a/net/tsn/genl_tsn.c
+++ b/net/tsn/genl_tsn.c
@@ -370,18 +370,20 @@ struct tsn_port *tsn_init_check(struct genl_info *info,
 	struct tsn_port *port;
 	bool tsn_found = false;
 
-	na = info->attrs[TSN_ATTR_IFNAME];
-	if (!na) {
+	if (!info->attrs[TSN_ATTR_IFNAME]) {
 		tsn_simple_reply(info, TSN_CMD_REPLY,
 				 "no portname", -TSN_ATTRERR);
 		return NULL;
 	}
 
+	na = info->attrs[TSN_ATTR_IFNAME];
+
 	portname = (char *)nla_data(na);
+
 	netdev = __dev_get_by_name(genl_info_net(info), portname);
 	if (!netdev) {
 		tsn_simple_reply(info, TSN_CMD_REPLY,
-				 netdev->name, -TSN_NODEVOPS);
+				 "error device", -TSN_NODEVOPS);
 		return NULL;
 	}
 
-- 
2.17.1

