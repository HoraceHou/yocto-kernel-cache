From f98e90c9f9b821bad51d206f395aea4717ce1356 Mon Sep 17 00:00:00 2001
From: Rajat Srivastava <rajat.srivastava@nxp.com>
Date: Wed, 31 Oct 2018 18:14:54 +0530
Subject: [PATCH 342/706] spi-nor: flexspi: add ls1028 support

enable nxp flexspi driver by default.

Signed-off-by: Rajat Srivastava <rajat.srivastava@nxp.com>
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/mtd/spi-nor/nxp-flexspi.c | 15 +++++++++++++--
 1 file changed, 13 insertions(+), 2 deletions(-)

diff --git a/drivers/mtd/spi-nor/nxp-flexspi.c b/drivers/mtd/spi-nor/nxp-flexspi.c
index 595d756750ed..6aef595c7e01 100644
--- a/drivers/mtd/spi-nor/nxp-flexspi.c
+++ b/drivers/mtd/spi-nor/nxp-flexspi.c
@@ -429,6 +429,7 @@
 
 enum nxp_fspi_devtype {
 	NXP_FSPI_LX2160A,
+	NXP_FSPI_LS1028A
 };
 
 struct nxp_fspi_devtype_data {
@@ -447,6 +448,14 @@ static struct nxp_fspi_devtype_data lx2160a_data = {
 	.driver_data = 0,
 };
 
+static struct nxp_fspi_devtype_data ls1028a_data = {
+	.devtype = NXP_FSPI_LS1028A,
+	.rxfifo = RX_IPBUF_SIZE,
+	.txfifo = TX_IPBUF_SIZE,
+	.ahb_buf_size = RX_AHBBUF_SIZE,
+	.driver_data = 0,
+};
+
 #define NXP_FSPI_MAX_CHIP	4
 struct nxp_fspi {
 	struct mtd_info mtd[NXP_FSPI_MAX_CHIP];
@@ -1152,7 +1161,7 @@ static void nxp_fspi_unprep(struct spi_nor *nor, enum spi_nor_ops ops)
 }
 
 static const struct of_device_id nxp_fspi_dt_ids[] = {
-	{ .compatible = "nxp,lx2160a-fspi", .data = (void *)&lx2160a_data, },
+	{ .compatible = "nxp,lx2160a-fspi", .data = (void *)&ls1028a_data, },
 	{ /* sentinel */ }
 };
 MODULE_DEVICE_TABLE(of, nxp_fspi_dt_ids);
@@ -1160,7 +1169,9 @@ MODULE_DEVICE_TABLE(of, nxp_fspi_dt_ids);
 static int nxp_fspi_probe(struct platform_device *pdev)
 {
 	struct spi_nor_hwcaps hwcaps = {
-		.mask = SNOR_HWCAPS_READ | SNOR_HWCAPS_PP
+		.mask = SPINOR_OP_READ_FAST_4B |
+			SPINOR_OP_READ_4B |
+			SNOR_HWCAPS_PP
 	};
 	struct device_node *np = pdev->dev.of_node;
 	struct device *dev = &pdev->dev;
-- 
2.17.1

