From 22d6a8376a74040eda7a3f286f1e2d259cc4855a Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@nxp.com>
Date: Fri, 9 Feb 2018 14:39:20 +0200
Subject: [PATCH 107/706] enetc: Update to new PSICFGR0 definition for m0169
 (BG v86)

Signed-off-by: Claudiu Manoil <claudiu.manoil@nxp.com>
(cherry picked from commit d5d36549253af1691ebc81dfbbf8644137cf140c)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 .../net/ethernet/freescale/enetc/enetc_ethtool.c  |  2 +-
 drivers/net/ethernet/freescale/enetc/enetc_hw.h   |  8 ++++----
 drivers/net/ethernet/freescale/enetc/enetc_pf.c   | 15 +++++++--------
 3 files changed, 12 insertions(+), 13 deletions(-)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc_ethtool.c b/drivers/net/ethernet/freescale/enetc/enetc_ethtool.c
index c65f6ced6e05..a834db7ec425 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_ethtool.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc_ethtool.c
@@ -120,7 +120,7 @@ static void enetc_get_regs(struct net_device *ndev, struct ethtool_regs *regs,
 		PR_PREG(hw, PSIPMAR1(0));
 		PR_PREG(hw, PCAPR0);
 		PR_PREG(hw, PCAPR1);
-		PR_PREG(hw, PV0CFGR(0));
+		PR_PREG(hw, PSICFGR0(0));
 		PR_PREG(hw, PM0_CMD_CFG);
 		PR_PREG(hw, PM0_MAXFRM);
 	}
diff --git a/drivers/net/ethernet/freescale/enetc/enetc_hw.h b/drivers/net/ethernet/freescale/enetc/enetc_hw.h
index b8683dbb0f97..20d0aec7d9a3 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_hw.h
+++ b/drivers/net/ethernet/freescale/enetc/enetc_hw.h
@@ -179,10 +179,10 @@ enum enetc_bdr_type {TX, RX};
 #define ENETC_PCAPR0	0x00900
 #define ENETC_PCAPR1	0x00904
 
-#define ENETC_PV0CFGR(n)	(0x00920 + (n) * 0x10)  /* n = SI index */
-#define ENETC_PVCFGR_SET_TXBDR(val)	((val) & 0xff)
-#define ENETC_PVCFGR_SET_RXBDR(val)	(((val) & 0xff) << 16)
-#define ENETC_PVCFGR_ASE	BIT(15)
+#define ENETC_PSICFGR0(n)	(0x00940 + (n) * 0xc)  /* n = SI index */
+#define ENETC_PSICFGR0_SET_TXBDR(val)	((val) & 0xff)
+#define ENETC_PSICFGR0_SET_RXBDR(val)	(((val) & 0xff) << 16)
+#define ENETC_PSICFGR0_ASE	BIT(15)
 
 #define ENETC_RSSHASH_KEY_SIZE	40
 #define ENETC_PRSSK(n)		(0x01410 + (n) * 4) /* n = [0..9] */
diff --git a/drivers/net/ethernet/freescale/enetc/enetc_pf.c b/drivers/net/ethernet/freescale/enetc/enetc_pf.c
index c671d0082928..fa645d3338b6 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_pf.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc_pf.c
@@ -224,8 +224,7 @@ static int enetc_pf_set_vf_vlan(struct net_device *ndev, int vf, u16 vlan,
 	return 0;
 }
 
-static int enetc_pf_set_vf_spoofchk(struct net_device *ndev, int vf,
-				    bool setting)
+static int enetc_pf_set_vf_spoofchk(struct net_device *ndev, int vf, bool en)
 {
 	struct enetc_ndev_priv *priv = netdev_priv(ndev);
 	struct enetc_pf *pf = enetc_si_priv(priv->si);
@@ -234,9 +233,9 @@ static int enetc_pf_set_vf_spoofchk(struct net_device *ndev, int vf,
 	if (vf > pf->num_vfs)
 		return -EINVAL;
 
-	cfgr = enetc_port_rd(&priv->si->hw, ENETC_PV0CFGR(vf + 1));
-	cfgr = (cfgr & ~ENETC_PVCFGR_ASE) | (setting ? ENETC_PVCFGR_ASE : 0);
-	enetc_port_wr(&priv->si->hw, ENETC_PV0CFGR(vf + 1), cfgr);
+	cfgr = enetc_port_rd(&priv->si->hw, ENETC_PSICFGR0(vf + 1));
+	cfgr = (cfgr & ~ENETC_PSICFGR0_ASE) | (en ? ENETC_PSICFGR0_ASE : 0);
+	enetc_port_wr(&priv->si->hw, ENETC_PSICFGR0(vf + 1), cfgr);
 
 	return 0;
 }
@@ -296,10 +295,10 @@ static void enetc_port_alloc_rings(struct enetc_si *si)
 	val = enetc_port_rd(hw, ENETC_PCAPR0);
 	num_rings = min(val >> 24, (val >> 16) & 0xff);
 
-	val = ENETC_PVCFGR_SET_TXBDR(num_rings);
-	val |= ENETC_PVCFGR_SET_RXBDR(num_rings);
+	val = ENETC_PSICFGR0_SET_TXBDR(num_rings);
+	val |= ENETC_PSICFGR0_SET_RXBDR(num_rings);
 	for (i = 0; i < pf->total_vfs + 1; i++)
-		enetc_port_wr(hw, ENETC_PV0CFGR(i), val);
+		enetc_port_wr(hw, ENETC_PSICFGR0(i), val);
 }
 
 static void enetc_configure_port_mac(struct enetc_si *si)
-- 
2.17.1

