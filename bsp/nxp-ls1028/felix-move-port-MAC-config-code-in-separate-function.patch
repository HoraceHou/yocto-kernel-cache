From 1181a2210c29852d5b26a6a7eea781610ea09158 Mon Sep 17 00:00:00 2001
From: Catalin Horghidan <catalin.horghidan@nxp.com>
Date: Tue, 12 Feb 2019 15:26:52 +0200
Subject: [PATCH 635/706] felix: move port MAC config code in separate function

Signed-off-by: Catalin Horghidan <catalin.horghidan@nxp.com>
(cherry picked from commit edca2e060d5f40ae77c55d7724b169a50ad4ae07)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/mscc/felix_board.c | 25 ++++++++++++++-----------
 1 file changed, 14 insertions(+), 11 deletions(-)

diff --git a/drivers/net/ethernet/mscc/felix_board.c b/drivers/net/ethernet/mscc/felix_board.c
index a604efc6dc6c..5d45dd11ec16 100644
--- a/drivers/net/ethernet/mscc/felix_board.c
+++ b/drivers/net/ethernet/mscc/felix_board.c
@@ -375,6 +375,17 @@ static void felix_release_ports(struct ocelot_port **ports)
 	}
 }
 
+static void felix_setup_port_mac(struct ocelot_port *port)
+{
+	/* Only 1G full duplex supported for now */
+	ocelot_port_writel(port, DEV_MAC_MODE_CFG_FDX_ENA |
+			   DEV_MAC_MODE_CFG_GIGA_MODE_ENA, DEV_MAC_MODE_CFG);
+	/* Take MAC, Port, Phy (intern) and PCS (SGMII/Serdes)
+	 * clock out of reset
+	 */
+	ocelot_port_writel(port, DEV_CLOCK_CFG_LINK_SPEED(OCELOT_SPEED_1000),
+			   DEV_CLOCK_CFG);
+}
 static int felix_ports_init(struct pci_dev *pdev)
 {
 	struct ocelot *ocelot = pci_get_drvdata(pdev);
@@ -475,20 +486,12 @@ static int felix_ports_init(struct pci_dev *pdev)
 			dev_err(ocelot->dev, "failed to probe ports\n");
 			goto release_ports;
 		}
+
+		/* apply felix config */
 		ocelot_port = ocelot->ports[port];
 		port_dev = ocelot_port->dev;
 
-		/* Only 1G full duplex supported for now */
-		ocelot_port_writel(ocelot_port,
-				   DEV_MAC_MODE_CFG_FDX_ENA |
-				   DEV_MAC_MODE_CFG_GIGA_MODE_ENA,
-				   DEV_MAC_MODE_CFG);
-		/* Take MAC, Port, Phy (intern) and PCS (SGMII/Serdes)
-		 * clock out of reset
-		 */
-		ocelot_port_writel(ocelot_port,
-				   DEV_CLOCK_CFG_LINK_SPEED(OCELOT_SPEED_1000),
-				   DEV_CLOCK_CFG);
+		felix_setup_port_mac(ocelot_port);
 
 #ifdef CONFIG_MSCC_FELIX_SWITCH_TSN
 		tsn_port_register(port_dev, (struct tsn_ops *)&switch_tsn_ops,
-- 
2.17.1

