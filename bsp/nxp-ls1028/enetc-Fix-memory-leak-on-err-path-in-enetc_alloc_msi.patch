From 84f7e0a62dbc73107764f69d70c58943aa057233 Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@nxp.com>
Date: Wed, 8 Aug 2018 14:10:46 +0300
Subject: [PATCH 186/706] enetc: Fix memory leak on err path in
 enetc_alloc_msix()

Signed-off-by: Claudiu Manoil <claudiu.manoil@nxp.com>
(cherry picked from commit 22035d4f8503d8439c2259420f268677cf904c15)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc.c b/drivers/net/ethernet/freescale/enetc/enetc.c
index 8857b9736fb0..6b6b39f23b41 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc.c
@@ -1586,8 +1586,10 @@ int enetc_alloc_msix(struct enetc_ndev_priv *priv)
 	return 0;
 
 fail:
-	while (i--)
+	while (i--) {
+		netif_napi_del(&priv->int_vector[i]->napi);
 		kfree(priv->int_vector[i]);
+	}
 
 	pci_free_irq_vectors(pdev);
 
-- 
2.17.1

