From 3f548bc03b77efe907e0b90fbc370fdd9b71b78d Mon Sep 17 00:00:00 2001
From: Catalin Horghidan <catalin.horghidan@nxp.com>
Date: Mon, 1 Oct 2018 14:03:59 +0300
Subject: [PATCH 311/706] felix: fix checkpatch issues and defines

Signed-off-by: Catalin Horghidan <catalin.horghidan@nxp.com>
(cherry picked from commit e84a7f53fda215f7b8310cc3a153c97e84ea4772)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/mscc/felix_board.c |  6 +++---
 drivers/net/ethernet/mscc/felix_regs.c  | 24 +++++++++++++++---------
 2 files changed, 18 insertions(+), 12 deletions(-)

diff --git a/drivers/net/ethernet/mscc/felix_board.c b/drivers/net/ethernet/mscc/felix_board.c
index d37b3e884f7e..62f0a4525d9d 100644
--- a/drivers/net/ethernet/mscc/felix_board.c
+++ b/drivers/net/ethernet/mscc/felix_board.c
@@ -17,8 +17,8 @@ static const char felix_driver_string[] = "Felix Switch Driver";
 #define DRV_VERSION "0.2"
 static const char felix_driver_version[] = DRV_VERSION;
 
-#define FELIX_EXT_CPU_PORT	5
 #define FELIX_MAX_NUM_PHY_PORTS	6
+#define FELIX_EXT_CPU_PORT_ID	5
 #define PORT_RES_START		(SYS + 1)
 
 #define PCI_DEVICE_ID_FELIX_PF5	0xEEF0
@@ -252,8 +252,8 @@ static int felix_ports_init(struct ocelot *ocelot)
 
 static int felix_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)
 {
-	struct ocelot *ocelot;
 	resource_size_t offset;
+	struct ocelot *ocelot;
 	size_t len;
 	int timeout;
 	int i, err;
@@ -337,7 +337,7 @@ static int felix_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)
 
 	/* set port for external CPU frame extraction/injection */
 	ocelot_write(ocelot, QSYS_EXT_CPU_CFG_EXT_CPUQ_MSK_M |
-		     QSYS_EXT_CPU_CFG_EXT_CPU_PORT(FELIX_EXT_CPU_PORT),
+		     QSYS_EXT_CPU_CFG_EXT_CPU_PORT(FELIX_EXT_CPU_PORT_ID),
 		     QSYS_EXT_CPU_CFG);
 
 	register_netdevice_notifier(&ocelot_netdevice_nb);
diff --git a/drivers/net/ethernet/mscc/felix_regs.c b/drivers/net/ethernet/mscc/felix_regs.c
index 75c8735a9794..aead5dfb4437 100644
--- a/drivers/net/ethernet/mscc/felix_regs.c
+++ b/drivers/net/ethernet/mscc/felix_regs.c
@@ -1,6 +1,5 @@
 // SPDX-License-Identifier: (GPL-2.0 OR MIT)
-/*
- * Microsemi Ocelot Switch driver
+/* Felix Switch driver
  *
  * Copyright 2017 Microsemi Corporation
  * Copyright 2018 NXP
@@ -294,11 +293,16 @@ static const struct reg_field felix_regfields[] = {
 	[ANA_TABLES_MACACCESS_B_DOM] = REG_FIELD(ANA_TABLES_MACACCESS, 16, 16),
 	[ANA_TABLES_MACTINDX_BUCKET] = REG_FIELD(ANA_TABLES_MACTINDX, 11, 12),
 	[ANA_TABLES_MACTINDX_M_INDEX] = REG_FIELD(ANA_TABLES_MACTINDX, 0, 10),
-	[QSYS_TIMED_FRAME_ENTRY_TFRM_VLD] = REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 19, 19),
-	[QSYS_TIMED_FRAME_ENTRY_TFRM_FP] = REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 7, 18),
-	[QSYS_TIMED_FRAME_ENTRY_TFRM_PORTNO] = REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 4, 6),
-	[QSYS_TIMED_FRAME_ENTRY_TFRM_TM_SEL] = REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 1, 3),
-	[QSYS_TIMED_FRAME_ENTRY_TFRM_TM_T] = REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 0, 0),
+	[QSYS_TIMED_FRAME_ENTRY_TFRM_VLD] =
+		REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 19, 19),
+	[QSYS_TIMED_FRAME_ENTRY_TFRM_FP] =
+		REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 7, 18),
+	[QSYS_TIMED_FRAME_ENTRY_TFRM_PORTNO] =
+		REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 4, 6),
+	[QSYS_TIMED_FRAME_ENTRY_TFRM_TM_SEL] =
+		REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 1, 3),
+	[QSYS_TIMED_FRAME_ENTRY_TFRM_TM_T] =
+		REG_FIELD(QSYS_TIMED_FRAME_ENTRY, 0, 0),
 	[SYS_RESET_CFG_CORE_ENA] = REG_FIELD(SYS_RESET_CFG, 0, 0),
 };
 
@@ -475,7 +479,8 @@ void felix_port_adjust_link(struct net_device *dev)
 			   DEV_MAC_ENA_CFG_TX_ENA, DEV_MAC_ENA_CFG);
 
 	/* Take MAC, Port, Phy (intern) and PCS (SGMII/Serdes) clock out of
-	 * reset */
+	 * reset
+	 */
 	ocelot_port_writel(port, DEV_CLOCK_CFG_LINK_SPEED(speed),
 			   DEV_CLOCK_CFG);
 
@@ -511,7 +516,8 @@ void felix_port_adjust_link(struct net_device *dev)
 	ocelot_write_rix(ocelot, 0, ANA_POL_FLOWC, p);
 
 	/* Tail dropping watermark */
-	atop_wm = (ocelot->shared_queue_sz - 9 * VLAN_ETH_FRAME_LEN) / OCELOT_BUFFER_CELL_SZ;
+	atop_wm = ocelot->shared_queue_sz - 9 * VLAN_ETH_FRAME_LEN;
+	atop_wm /= OCELOT_BUFFER_CELL_SZ;
 	ocelot_write_rix(ocelot, ocelot_wm_enc(9 * VLAN_ETH_FRAME_LEN),
 			 SYS_ATOP, p);
 	ocelot_write(ocelot, ocelot_wm_enc(atop_wm), SYS_ATOP_TOT_CFG);
-- 
2.17.1

