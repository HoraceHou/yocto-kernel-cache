From 5cbaeeb2a38a64e3b215501ffc7fc345c70f768e Mon Sep 17 00:00:00 2001
From: Po Liu <Po.Liu@nxp.com>
Date: Wed, 5 Sep 2018 22:36:42 +0800
Subject: [PATCH 280/706] enetc: disable the PHY_TX_EN when loopback mode

Signed-off-by: Po Liu <Po.Liu@nxp.com>
(cherry picked from commit d84edac5f2773985186de32e96994f33d56a138f)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc_pf.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc_pf.c b/drivers/net/ethernet/freescale/enetc/enetc_pf.c
index e373f3930d4e..c94d2f33a9f0 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc_pf.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc_pf.c
@@ -376,6 +376,7 @@ static void enetc_set_loopback(struct net_device *ndev, bool en)
 		/* assume SGMII mode */
 		reg = enetc_port_rd(hw, ENETC_PM0_CMD_CFG);
 		reg = en ? reg | ENETC_PM0_CMD_XGLP : reg & ~ENETC_PM0_CMD_XGLP;
+		reg = en ? reg & ~ENETC_PM0_CMD_PHY_TX_EN : reg | ENETC_PM0_CMD_PHY_TX_EN;
 		enetc_port_wr(hw, ENETC_PM0_CMD_CFG, reg);
 		enetc_port_wr(hw, ENETC_PM1_CMD_CFG, reg);
 	}
-- 
2.17.1

