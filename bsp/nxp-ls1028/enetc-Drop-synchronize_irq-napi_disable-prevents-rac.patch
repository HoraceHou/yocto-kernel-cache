From 0e6b2f813e0c3c1f95b464759bc0c0d162352338 Mon Sep 17 00:00:00 2001
From: Claudiu Manoil <claudiu.manoil@nxp.com>
Date: Fri, 2 Nov 2018 19:02:23 +0200
Subject: [PATCH 463/706] enetc: Drop synchronize_irq(), napi_disable prevents
 race

Signed-off-by: Claudiu Manoil <claudiu.manoil@nxp.com>
(cherry picked from commit 64e5cba70c9a8c7f16fd1e3fa830b33eaaea6a73)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/freescale/enetc/enetc.c | 10 +---------
 1 file changed, 1 insertion(+), 9 deletions(-)

diff --git a/drivers/net/ethernet/freescale/enetc/enetc.c b/drivers/net/ethernet/freescale/enetc/enetc.c
index fc466227e4e9..c37507b336ac 100644
--- a/drivers/net/ethernet/freescale/enetc/enetc.c
+++ b/drivers/net/ethernet/freescale/enetc/enetc.c
@@ -1269,15 +1269,8 @@ static void enetc_enable_interrupts(struct enetc_ndev_priv *priv)
 
 static void enetc_disable_interrupts(struct enetc_ndev_priv *priv)
 {
-	struct pci_dev *pdev = priv->si->pdev;
 	int i;
 
-	for (i = 0; i < priv->bdr_int_num; i++) {
-		int irq = pci_irq_vector(pdev, ENETC_BDR_INT_BASE_IDX + i);
-
-		synchronize_irq(irq);
-	}
-
 	for (i = 0; i < priv->num_tx_rings; i++)
 		enetc_txbdr_wr(&priv->si->hw, i, ENETC_TBIER, 0);
 
@@ -1358,8 +1351,6 @@ int enetc_close(struct net_device *ndev)
 
 	netif_tx_stop_all_queues(ndev);
 
-	enetc_disable_interrupts(priv);
-
 	for (i = 0; i < priv->bdr_int_num; i++) {
 		napi_synchronize(&priv->int_vector[i]->napi);
 		napi_disable(&priv->int_vector[i]->napi);
@@ -1372,6 +1363,7 @@ int enetc_close(struct net_device *ndev)
 		netif_carrier_off(ndev);
 	}
 
+	enetc_disable_interrupts(priv);
 	enetc_clear_bdrs(priv);
 
 	enetc_free_rxtx_rings(priv);
-- 
2.17.1

