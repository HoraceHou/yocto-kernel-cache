From 50d8e5bf22912c77fdf53a8ef104b66288b9e5e6 Mon Sep 17 00:00:00 2001
From: Catalin Horghidan <catalin.horghidan@nxp.com>
Date: Wed, 13 Feb 2019 16:54:54 +0200
Subject: [PATCH 640/706] felix: move ptp init after switch core initialization

Signed-off-by: Catalin Horghidan <catalin.horghidan@nxp.com>
(cherry picked from commit 12512bda69141e33513651a51f3cfc4e646c008a)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/mscc/felix_board.c | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/mscc/felix_board.c b/drivers/net/ethernet/mscc/felix_board.c
index f51305e18723..c0a895dbd715 100644
--- a/drivers/net/ethernet/mscc/felix_board.c
+++ b/drivers/net/ethernet/mscc/felix_board.c
@@ -628,10 +628,6 @@ static int felix_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)
 		goto err_sw_core_init;
 	}
 	/* initialize switch mem ~40us */
-	err = felix_ptp_init(ocelot);
-	if (err)
-		goto err_ptp_init;
-
 	ocelot_write(ocelot, SYS_RAM_INIT_RAM_INIT, SYS_RAM_INIT);
 	timeout = FELIX_INIT_TIMEOUT;
 	do {
@@ -647,6 +643,10 @@ static int felix_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)
 	/* enable switch core */
 	regmap_field_write(ocelot->regfields[SYS_RESET_CFG_CORE_ENA], 1);
 
+	err = felix_ptp_init(ocelot);
+	if (err)
+		goto err_ptp_init;
+
 	err = felix_ports_init(pdev);
 	if (err)
 		goto err_ports_init;
-- 
2.17.1

