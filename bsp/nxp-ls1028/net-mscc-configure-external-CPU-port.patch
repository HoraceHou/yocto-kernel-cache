From 4dd09b4364ff651762b5897a2786ce2f67c8ce0f Mon Sep 17 00:00:00 2001
From: Catalin Horghidan <catalin.horghidan@nxp.com>
Date: Wed, 11 Jul 2018 16:30:38 +0300
Subject: [PATCH 200/706] net: mscc: configure external CPU port

Signed-off-by: Catalin Horghidan <catalin.horghidan@nxp.com>
(cherry picked from commit 5e2fde529a29309b11ec60ee62594ddec8229729)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/mscc/felix_board.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/drivers/net/ethernet/mscc/felix_board.c b/drivers/net/ethernet/mscc/felix_board.c
index 9a40f67d1e46..69dbf8b7dc7e 100644
--- a/drivers/net/ethernet/mscc/felix_board.c
+++ b/drivers/net/ethernet/mscc/felix_board.c
@@ -17,6 +17,7 @@ static const char felix_driver_string[] = "Felix Switch Driver";
 static const char felix_driver_version[] = DRV_VERSION;
 
 #define NUM_PHY_PORTS		6
+#define FELIX_EXT_CPU_PORT	5
 #define PORT_RES_START		(SYS + 1)
 
 #define PCI_DEVICE_ID_FELIX_PF5	0xEEF0
@@ -275,6 +276,11 @@ static int felix_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)
 	if (err)
 		goto err_ports_init;
 
+	/* set port for external CPU frame extraction/injection */
+	ocelot_write(ocelot, QSYS_EXT_CPU_CFG_EXT_CPUQ_MSK_M |
+		     QSYS_EXT_CPU_CFG_EXT_CPU_PORT(FELIX_EXT_CPU_PORT),
+		     QSYS_EXT_CPU_CFG);
+
 	register_netdevice_notifier(&ocelot_netdevice_nb);
 
 	dev_info(&pdev->dev, "%s - version %s probed\n", felix_driver_string,
-- 
2.17.1

