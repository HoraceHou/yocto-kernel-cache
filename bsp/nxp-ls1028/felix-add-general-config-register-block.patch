From b88db9dd657af2c94d4e97dcacb4e6e11b04935f Mon Sep 17 00:00:00 2001
From: Catalin Horghidan <catalin.horghidan@nxp.com>
Date: Wed, 13 Feb 2019 16:53:41 +0200
Subject: [PATCH 638/706] felix: add general config register block

Signed-off-by: Catalin Horghidan <catalin.horghidan@nxp.com>
(cherry picked from commit e61c1fccde75bddc3279c6aef5f5a8d115c35c4c)
Signed-off-by: Zumeng Chen <zumeng.chen@windriver.com>
---
 drivers/net/ethernet/mscc/felix_board.c | 10 ++++++++--
 drivers/net/ethernet/mscc/felix_regs.c  |  6 ++++++
 drivers/net/ethernet/mscc/ocelot.h      |  3 +++
 3 files changed, 17 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/mscc/felix_board.c b/drivers/net/ethernet/mscc/felix_board.c
index ea0b14848c6e..ea6a2f48621d 100644
--- a/drivers/net/ethernet/mscc/felix_board.c
+++ b/drivers/net/ethernet/mscc/felix_board.c
@@ -21,7 +21,7 @@ static const char felix_driver_version[] = DRV_VERSION;
 
 #define FELIX_MAX_NUM_PHY_PORTS	5
 #define FELIX_EXT_CPU_PORT_ID	4
-#define PORT_RES_START		(SYS + 1)
+#define PORT_RES_START		(GCB + 1)
 
 #define PCI_DEVICE_ID_FELIX_PF5	0xEEF0
 
@@ -104,6 +104,12 @@ static struct resource felix_switch_res[] = {
 		.name = "sys",
 		.flags = IORESOURCE_MEM,
 	},
+	{
+		.start	= 0x0070000,
+		.end	= 0x00701ff,
+		.name 	= "devcpu_gcb",
+		.flags 	= IORESOURCE_MEM,
+	},
 	{
 		.start = 0x0100000,
 		.end = 0x010ffff,
@@ -589,7 +595,7 @@ static int felix_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)
 			felix_switch_res[i].end += offset;
 		}
 
-	for (i = ANA; i <= SYS; i++) {
+	for (i = ANA; i <= GCB; i++) {
 		struct regmap *target;
 
 		target = felix_io_init(ocelot, i);
diff --git a/drivers/net/ethernet/mscc/felix_regs.c b/drivers/net/ethernet/mscc/felix_regs.c
index 01298641210b..970637f4d272 100644
--- a/drivers/net/ethernet/mscc/felix_regs.c
+++ b/drivers/net/ethernet/mscc/felix_regs.c
@@ -291,6 +291,10 @@ static const u32 felix_sys_regmap[] = {
 //	REG(SYS_CM_OP,                     0x000f34),
 };
 
+static const u32 felix_gcb_regmap[] = {
+	REG(GCB_SOFT_RST,		   0x000004),
+};
+
 static const u32 *felix_regmap[] = {
 	[ANA] = felix_ana_regmap,
 	[QS] = felix_qs_regmap,
@@ -298,6 +302,7 @@ static const u32 *felix_regmap[] = {
 	[REW] = felix_rew_regmap,
 	[SYS] = felix_sys_regmap,
 	[PTP] = felix_ptp_regmap,
+	[GCB] = felix_gcb_regmap,
 };
 
 static const struct reg_field felix_regfields[] = {
@@ -372,6 +377,7 @@ static const struct reg_field felix_regfields[] = {
 		REG_FIELD(QSYS_TAS_PARAM_CFG_CTRL, 16, 16),
 	[QSYS_TAG_CONFIG_ENABLE_0] = REG_FIELD(QSYS_TAG_CONFIG, 0, 0),
 	[SYS_STAT_CFG_STAT_VIEW_0] = REG_FIELD(SYS_STAT_CFG, 0, 9),
+	[GCB_SOFT_RST_SWC_RST] = REG_FIELD(GCB_SOFT_RST, 0, 0),
 };
 
 static const struct ocelot_stat_layout felix_stats_layout[] = {
diff --git a/drivers/net/ethernet/mscc/ocelot.h b/drivers/net/ethernet/mscc/ocelot.h
index d253727274cb..dfaa2769d43c 100644
--- a/drivers/net/ethernet/mscc/ocelot.h
+++ b/drivers/net/ethernet/mscc/ocelot.h
@@ -74,6 +74,7 @@ enum ocelot_target {
 	QSYS,
 	REW,
 	SYS,
+	GCB,
 	HSIO,
 	TARGET_MAX,
 };
@@ -431,6 +432,7 @@ enum ocelot_reg {
 	HSIO_TEMP_SENSOR_CTRL,
 	HSIO_TEMP_SENSOR_CFG,
 	HSIO_TEMP_SENSOR_STAT,
+	GCB_SOFT_RST = GCB << TARGET_OFFSET,
 };
 
 enum ocelot_regfield {
@@ -494,6 +496,7 @@ enum ocelot_regfield {
 	QSYS_TAS_PARAM_CFG_CTRL_CONFIG_CHANGE_0,
 	QSYS_TAG_CONFIG_ENABLE_0,
 	SYS_STAT_CFG_STAT_VIEW_0,
+	GCB_SOFT_RST_SWC_RST,
 	REGFIELD_MAX
 };
 
-- 
2.17.1

