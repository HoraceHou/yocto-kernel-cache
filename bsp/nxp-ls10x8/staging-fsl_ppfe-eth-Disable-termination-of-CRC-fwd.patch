From d79c88c4b1ad4c7b519f335df05fa30a0debfb4a Mon Sep 17 00:00:00 2001
From: Nagesh Koneti <koneti.nagesh@nxp.com>
Date: Wed, 25 Sep 2019 12:01:19 +0530
Subject: [PATCH 234/245] staging: fsl_ppfe/eth: Disable termination of CRC
 fwd.
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

commit 328b263103fbd83f7c7a5d42acef266375a2f717 from
http://source.codeaurora.org/external/qoriq/qoriq-components/linux.git

LS1012A MAC PCS block has an erratum that is seen with specific PHY AR803x.
The issue is triggered by the (spec-compliant) operation of the AR803x PHY
on the LS1012A-FRWY board.Due to this, good FCS packet is reported as error
packet by MAC, so for these error packets FCS should be validated and
discard only real error packets in PFE Rx packet path.

Signed-off-by: Nagesh Koneti <koneti.nagesh@nxp.com>
Signed-off-by: Nagesh Koneti <“koneti.nagesh@nxp.com”>
Signed-off-by: Zhantao Tang <zhantao.tang@windriver.com>
---
 drivers/staging/fsl_ppfe/pfe_hal.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/staging/fsl_ppfe/pfe_hal.c b/drivers/staging/fsl_ppfe/pfe_hal.c
index be417eb008c1..df71079ee5b1 100644
--- a/drivers/staging/fsl_ppfe/pfe_hal.c
+++ b/drivers/staging/fsl_ppfe/pfe_hal.c
@@ -860,8 +860,9 @@ void gemac_set_mode(void *base, int mode)
 	/*Remove loopbank*/
 	val &= ~EMAC_RCNTRL_LOOP;
 
-	/* Enable flow control and MII mode and terminate received CRC */
-	val |= (EMAC_RCNTRL_FCE | EMAC_RCNTRL_MII_MODE | EMAC_RCNTRL_CRC_FWD);
+	/* Enable flow control and MII mode.PFE firmware always expects
+       CRC should be forwarded by MAC to validate CRC in software.*/
+	val |= (EMAC_RCNTRL_FCE | EMAC_RCNTRL_MII_MODE);
 
 	writel(val, base + EMAC_RCNTRL_REG);
 }
-- 
2.17.1

