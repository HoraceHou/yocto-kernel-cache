From bb6dc40724a1c8f529f0aacadf3fdbc0b6a0c2de Mon Sep 17 00:00:00 2001
From: Limeng <Meng.Li@windriver.com>
Date: Tue, 19 Nov 2019 14:14:08 +0800
Subject: [PATCH 08/40] Revert "can: xilinx: proper acknowledgment of ISR
 Flags."

This reverts commit a5b05158c19a13dc092c0b841c499a32b630c3a4.
---
 drivers/net/can/xilinx_can.c | 16 +++-------------
 1 file changed, 3 insertions(+), 13 deletions(-)

diff --git a/drivers/net/can/xilinx_can.c b/drivers/net/can/xilinx_can.c
index d1ca52886397..3ea89b6138de 100644
--- a/drivers/net/can/xilinx_can.c
+++ b/drivers/net/can/xilinx_can.c
@@ -1304,10 +1304,8 @@ static irqreturn_t xcan_interrupt(int irq, void *dev_id)
 
 	/* Check for the type of interrupt and Processing it */
 	if (isr & (XCAN_IXR_SLP_MASK | XCAN_IXR_WKUP_MASK)) {
-		if (isr & XCAN_IXR_SLP_MASK)
-			priv->write_reg(priv, XCAN_ICR_OFFSET, XCAN_IXR_SLP_MASK);
-		if (isr & XCAN_IXR_WKUP_MASK)
-			priv->write_reg(priv, XCAN_ICR_OFFSET, XCAN_IXR_WKUP_MASK);
+		priv->write_reg(priv, XCAN_ICR_OFFSET, (XCAN_IXR_SLP_MASK |
+				XCAN_IXR_WKUP_MASK));
 		xcan_state_interrupt(ndev, isr);
 	}
 
@@ -1319,15 +1317,7 @@ static irqreturn_t xcan_interrupt(int irq, void *dev_id)
 	isr_errors = isr & (XCAN_IXR_ERROR_MASK | XCAN_IXR_RXOFLW_MASK |
 			    XCAN_IXR_BSOFF_MASK | XCAN_IXR_ARBLST_MASK);
 	if (isr_errors) {
-		if (isr & XCAN_IXR_ERROR_MASK)
-			priv->write_reg(priv, XCAN_ICR_OFFSET, XCAN_IXR_ERROR_MASK);
-		if (isr & XCAN_IXR_RXOFLW_MASK)
-			priv->write_reg(priv, XCAN_ICR_OFFSET, XCAN_IXR_RXOFLW_MASK);
-		if (isr & XCAN_IXR_BSOFF_MASK)
-			priv->write_reg(priv, XCAN_ICR_OFFSET, XCAN_IXR_BSOFF_MASK);
-		if (isr & XCAN_IXR_ARBLST_MASK)
-			priv->write_reg(priv, XCAN_ICR_OFFSET, XCAN_IXR_ARBLST_MASK);
-
+		priv->write_reg(priv, XCAN_ICR_OFFSET, isr_errors);
 		xcan_err_interrupt(ndev, isr);
 	}
 	if (priv->quirks & CANFD_SUPPORT) {
-- 
2.17.1

