From 5f13cbd30b0f31764418fe876bfdab223987868e Mon Sep 17 00:00:00 2001
From: Xulin Sun <xulin.sun@windriver.com>
Date: Thu, 12 Jul 2018 14:43:03 +0800
Subject: [PATCH 1/2] drvier: crypto: caam: qi replace cpus_allowed to
 cpus_mask for RT

Based on the commit fdfae20a1d8d1(kernel: sched: Provide a pointer to the valid CPU mask)
need to replace cpus_allowed to cpus_mask for RT.

Signed-off-by: Xulin Sun <xulin.sun@windriver.com>
---
 drivers/crypto/caam/qi.c |    8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/crypto/caam/qi.c b/drivers/crypto/caam/qi.c
index 1cf58b5..c673179 100644
--- a/drivers/crypto/caam/qi.c
+++ b/drivers/crypto/caam/qi.c
@@ -497,7 +497,11 @@ int caam_qi_shutdown(struct device *qidev)
 	int i, ret;
 	struct caam_qi_priv *priv = dev_get_drvdata(qidev);
 	const cpumask_t *cpus = qman_affine_cpus();
+#ifdef CONFIG_PREEMPT_RT_FULL
+	struct cpumask old_cpumask = current->cpus_mask;
+#else
 	struct cpumask old_cpumask = current->cpus_allowed;
+#endif
 
 	for_each_cpu(i, cpus) {
 		struct napi_struct *irqtask;
@@ -715,7 +719,11 @@ int caam_qi_init(struct platform_device *caam_pdev)
 	struct device *ctrldev = &caam_pdev->dev, *qidev;
 	struct caam_drv_private *ctrlpriv;
 	const cpumask_t *cpus = qman_affine_cpus();
+#ifdef CONFIG_PREEMPT_RT_FULL
+	struct cpumask old_cpumask = current->cpus_mask;
+#else
 	struct cpumask old_cpumask = current->cpus_allowed;
+#endif
 	static struct platform_device_info qi_pdev_info = {
 		.name = "caam_qi",
 		.id = PLATFORM_DEVID_NONE
-- 
1.7.9.5

