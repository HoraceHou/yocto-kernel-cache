From 115e4e20b0d428795df01fde06e74505286ef7d3 Mon Sep 17 00:00:00 2001
From: Stefan Chulski <stefanc@marvell.com>
Date: Thu, 21 Jul 2016 11:33:00 +0300
Subject: [PATCH 0371/1345] net: mvpp2x: validate ethtool coalescing
 parameters

commit  9491b30b99062e269a5038e27de74e7ee936ecd6 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

Change-Id: I9b07a6bb899b43dbb56bf49a9642dbddffb4f172
Signed-off-by: Stefan Chulski <stefanc@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/31305
Reviewed-by: Yuval Caduri <cyuval@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Hanna Hawa <hannah@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 .../net/ethernet/marvell/mvpp2x/mv_pp2x_ethtool.c  |   23 ++++++++++++++++++++
 1 file changed, 23 insertions(+)

diff --git a/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_ethtool.c b/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_ethtool.c
index cb902a1..b32721f 100644
--- a/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_ethtool.c
+++ b/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_ethtool.c
@@ -479,6 +479,29 @@ static int mv_pp2x_ethtool_set_coalesce(struct net_device *dev,
 	struct mv_pp2x_port *port = netdev_priv(dev);
 	int queue;
 
+	/* Check for not supported parameters  */
+	if ((c->rx_coalesce_usecs_irq) ||
+	    (c->rx_max_coalesced_frames_irq) ||
+	    (c->tx_coalesce_usecs_irq) ||
+	    (c->tx_max_coalesced_frames_irq) ||
+	    (c->stats_block_coalesce_usecs) ||
+	    (c->use_adaptive_rx_coalesce) ||
+	    (c->use_adaptive_tx_coalesce) ||
+	    (c->pkt_rate_low) ||
+	    (c->rx_coalesce_usecs_low) ||
+	    (c->rx_max_coalesced_frames_low) ||
+	    (c->tx_coalesce_usecs_low) ||
+	    (c->tx_max_coalesced_frames_low) ||
+	    (c->pkt_rate_high) ||
+	    (c->rx_coalesce_usecs_high) ||
+	    (c->rx_max_coalesced_frames_high) ||
+	    (c->tx_coalesce_usecs_high) ||
+	    (c->tx_max_coalesced_frames_high) ||
+	    (c->rate_sample_interval)) {
+		netdev_err(dev, "unsupported coalescing parameter\n");
+		return -EOPNOTSUPP;
+	}
+
 	for (queue = 0; queue < port->num_rx_queues; queue++) {
 		struct mv_pp2x_rx_queue *rxq = port->rxqs[queue];
 
-- 
1.7.9.5

