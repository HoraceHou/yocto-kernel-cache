From dee0794cc8de0150ed4958d3c7f1eb0b370ad0d1 Mon Sep 17 00:00:00 2001
From: Stefan Chulski <stefanc@marvell.com>
Date: Tue, 16 Aug 2016 14:20:30 +0300
Subject: [PATCH 0413/1345] net: mvpp2x: validate num_cos_queue parameter

commit  8fbc6d6aab242e6567c91b1c4dbbf7d2957bd903 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

Change-Id: I4ab0f2a1813f457111d582cc42510b3d2d02f8fb
Signed-off-by: Stefan Chulski <stefanc@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/31972
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yuval Caduri <cyuval@marvell.com>
Reviewed-by: Hanna Hawa <hannah@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c |    5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c b/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c
index a27c9b6..3fbbcf7 100644
--- a/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c
+++ b/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c
@@ -4017,6 +4017,11 @@ static int mv_pp2x_init(struct platform_device *pdev, struct mv_pp2x *priv)
 	struct mv_pp2x_hw *hw = &priv->hw;
 
 	/* Checks for hardware constraints */
+	if (mv_pp2x_num_cos_queues <= 0 || mv_pp2x_num_cos_queues > MVPP2_MAX_TXQ) {
+		dev_err(&pdev->dev, "Illegal num_cos_queue parameter\n");
+		return -EINVAL;
+	}
+
 	last_log_rx_queue = first_log_rxq_queue + mv_pp2x_rxq_number;
 	if (last_log_rx_queue > priv->pp2xdata->pp2x_max_port_rxqs) {
 		dev_err(&pdev->dev, "too high num_cos_queue parameter\n");
-- 
1.7.9.5

