From f6eca5e709dcdc6c213c9c31cdfc2551c6e26c39 Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Tue, 19 Apr 2016 18:20:29 +0300
Subject: [PATCH 0185/1345] mmc: a70x0: enable eMMC/SD for Armada70x0 in
 device-tree

commit  43df6c543bd2ea8fa0ade12347a6fb93e82455ae from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

- SD/eMMC working without card detect and without voltage change

Change-Id: I03116c7d55fdd43045ab3e3eb931973455b8e57b
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/29214
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Shadi Ammouri <shadi@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/marvell/armada-7040-db.dtsi    |    9 +++++++--
 arch/arm64/boot/dts/marvell/armada-7040.dtsi       |    2 +-
 arch/arm64/boot/dts/marvell/armada-ap806-dual.dtsi |    7 -------
 arch/arm64/boot/dts/marvell/armada-ap806-quad.dtsi |    5 +----
 4 files changed, 9 insertions(+), 14 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db.dtsi b/arch/arm64/boot/dts/marvell/armada-7040-db.dtsi
index 4cae74a..a9b102f 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db.dtsi
@@ -57,7 +57,12 @@
 	};
 
 	ap806 {
-		config-space {
+		config-space@f0000000 {
+			sdhci@6e0000 {
+				bus-width = <4>;
+				non-removable; /* For now, need to configure the GPIO for card detect */
+				status = "okay";
+			};
 			serial@512000 {
 				status = "okay";
 			};
@@ -69,7 +74,7 @@
 	};
 
 	cp110-master {
-		config-space {
+		config-space@f2000000 {
 			spi@700680 {
 				spi-flash@0 {
 					#address-cells = <0x1>;
diff --git a/arch/arm64/boot/dts/marvell/armada-7040.dtsi b/arch/arm64/boot/dts/marvell/armada-7040.dtsi
index 96b5330..b2003a6 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-7040.dtsi
@@ -54,7 +54,7 @@
 		     "marvell,armada-ap806";
 
 	cp110-master {
-		config-space {
+		config-space@f2000000 {
 			ppv22@000000 {
 				dma-coherent;
 			};
diff --git a/arch/arm64/boot/dts/marvell/armada-ap806-dual.dtsi b/arch/arm64/boot/dts/marvell/armada-ap806-dual.dtsi
index b1b11395..95a1ff6 100644
--- a/arch/arm64/boot/dts/marvell/armada-ap806-dual.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-ap806-dual.dtsi
@@ -67,11 +67,4 @@
 			enable-method = "psci";
 		};
 	};
-	ap806 {
-		config-space {
-			sdhci@d8000 {
-				status = "okay";
-			};
-		};
-	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-ap806-quad.dtsi b/arch/arm64/boot/dts/marvell/armada-ap806-quad.dtsi
index a9be9ab..9ca8e9f 100644
--- a/arch/arm64/boot/dts/marvell/armada-ap806-quad.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-ap806-quad.dtsi
@@ -81,10 +81,7 @@
 	};
 
 	ap806 {
-		config-space {
-			sdhci@d8000 {
-				status = "okay";
-			};
+		config-space@f0000000 {
 			etm0@c40000 {
 				compatible = "arm,coresight-etm4x", "arm,primecell";
 				reg = <0xc40000 0x1000>;
-- 
1.7.9.5

