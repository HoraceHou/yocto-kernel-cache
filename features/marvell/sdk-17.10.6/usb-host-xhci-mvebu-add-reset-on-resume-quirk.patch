From 6895ab1d3f0a5d6d101bb0cd3ed84103974fd3a2 Mon Sep 17 00:00:00 2001
From: Ofer Heifetz <oferh@marvell.com>
Date: Mon, 4 May 2015 12:42:42 +0300
Subject: [PATCH 0045/1345] usb: host: xhci: mvebu: add reset on resume quirk

commit  dcb782dec2039ed72e605ee8ca3054ae874c1db0 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

	The resume operation of mvebu xHCI host have some issues,
	so The XHCI_RESET_ON_RESUME quirk is added for it.

Signed-off-by: Ofer Heifetz <oferh@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/18774
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Tested-by: Nadav Haklai <nadavh@marvell.com>

Conflicts:
	drivers/usb/host/xhci-mvebu.c

fix compilation error
Signed-off-by: Grzegorz Jaszczyk <jaz@semihalf.com>

Change-Id: I4261625f738086f698f028416b66074028d45bf4
Reviewed-on: http://vgitil04.il.marvell.com:8080/27490
Reviewed-by: Lior Amsalem <alior@marvell.com>
Tested-by: Lior Amsalem <alior@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/usb/host/xhci-mvebu.c |   11 +++++++++++
 1 file changed, 11 insertions(+)

diff --git a/drivers/usb/host/xhci-mvebu.c b/drivers/usb/host/xhci-mvebu.c
index 85908a3..77ee6ab 100644
--- a/drivers/usb/host/xhci-mvebu.c
+++ b/drivers/usb/host/xhci-mvebu.c
@@ -16,6 +16,7 @@
 #include <linux/usb/hcd.h>
 
 #include "xhci-mvebu.h"
+#include "xhci.h"
 
 #define USB3_MAX_WINDOWS	4
 #define USB3_WIN_CTRL(w)	(0x0 + ((w) * 8))
@@ -44,6 +45,14 @@ static void xhci_mvebu_mbus_config(void __iomem *base,
 	}
 }
 
+static void xhci_mvebu_quirks(struct platform_device *pdev)
+{
+	struct usb_hcd *hcd = platform_get_drvdata(pdev);
+	struct xhci_hcd	*xhci = hcd_to_xhci(hcd);
+
+	xhci->quirks |= XHCI_RESET_ON_RESUME;
+}
+
 int xhci_mvebu_mbus_init_quirk(struct usb_hcd *hcd)
 {
 	struct device *dev = hcd->self.controller;
@@ -73,5 +82,7 @@ int xhci_mvebu_mbus_init_quirk(struct usb_hcd *hcd)
 	 */
 	iounmap(base);
 
+	xhci_mvebu_quirks(pdev);
+
 	return 0;
 }
-- 
1.7.9.5

