From 3f3e9a7f3fdc69657c2ab8bd55e5c68bb75dd45e Mon Sep 17 00:00:00 2001
From: Shadi Ammouri <shadi@marvell.com>
Date: Wed, 23 Nov 2016 16:49:10 +0200
Subject: [PATCH 0614/1345] fix: clk: ap806: fix typo in clock name, dclk
 instead of hclk

commit  137d8a19f06c0f59d36030c4fc97bda43085ceca from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

Fixed all affected drivers and files.
- axim driver
- Documentation
- system-controller driver

Change-Id: I0a51705ddede29e89ffdace9e1a7b9d4e79474bc
Signed-off-by: Shadi Ammouri <shadi@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/34002
Reviewed-by: Hanna Hawa <hannah@marvell.com>
Tested-by: Hanna Hawa <hannah@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 .../arm/marvell/ap806-system-controller.txt        |    4 ++--
 arch/arm64/boot/dts/marvell/armada-ap806.dtsi      |   22 ++++++++++----------
 drivers/clk/mvebu/ap806-system-controller.c        |   22 ++++++++++----------
 3 files changed, 24 insertions(+), 24 deletions(-)

diff --git a/Documentation/devicetree/bindings/arm/marvell/ap806-system-controller.txt b/Documentation/devicetree/bindings/arm/marvell/ap806-system-controller.txt
index e951241..938e1c0 100644
--- a/Documentation/devicetree/bindings/arm/marvell/ap806-system-controller.txt
+++ b/Documentation/devicetree/bindings/arm/marvell/ap806-system-controller.txt
@@ -24,7 +24,7 @@ Required properties:
  - reg: register area of the AP806 system controller
  - #clock-cells: must be set to 1
  - clock-output-names: must be defined to:
-   "ap-cpu-cluster-0", "ap-cpu-cluster-1", "ap-fixed", "ap-mss", "ap-emmc", "ap-hclk"
+   "ap-cpu-cluster-0", "ap-cpu-cluster-1", "ap-fixed", "ap-mss", "ap-emmc", "ap-dclk"
 
 Example:
 
@@ -32,6 +32,6 @@ Example:
 		compatible = "marvell,ap806-system-controller", "syscon";
 		#clock-cells = <1>;
 		clock-output-names = "ap-cpu-cluster-0", "ap-cpu-cluster-1",
-				     "ap-fixed", "ap-mss", "ap-emmc", "ap-hclk";
+				     "ap-fixed", "ap-mss", "ap-emmc", "dp-hclk";
 		reg = <0x6f4000 0x1000>;
 	};
diff --git a/arch/arm64/boot/dts/marvell/armada-ap806.dtsi b/arch/arm64/boot/dts/marvell/armada-ap806.dtsi
index adef92d..7bd61b0 100644
--- a/arch/arm64/boot/dts/marvell/armada-ap806.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-ap806.dtsi
@@ -196,7 +196,7 @@
 			ap806_clock: ap806_clock@6f8200 {
 				compatible = "marvell,ap806-cpu-clk", "syscon";
 				#clock-cells = <1>;
-				clocks = <&syscon 0>;
+				clocks = <&ap_syscon 0>;
 				reg = <0x6f8200 0x100>;
 				status = "okay";
 			};
@@ -204,23 +204,23 @@
 			axim-ddr-rd@840000 {
 				compatible = "marvell,coresight-axim", "arm,primecell";
 				reg = <0x840000 0x1000>;
-				clocks = <&syscon 3>, <&syscon 5>;
-				clock-names = "apb_pclk", "hclk";
+				clocks = <&ap_syscon 3>, <&ap_syscon 5>;
+				clock-names = "apb_pclk", "dclk";
 				bus-width = <40>;
 			};
 
 			axim-ddr-wr@841000 {
 				compatible = "marvell,coresight-axim", "arm,primecell";
 				reg = <0x841000 0x1000>;
-				clocks = <&syscon 3>, <&syscon 5>;
-				clock-names = "apb_pclk", "hclk";
+				clocks = <&ap_syscon 3>, <&ap_syscon 5>;
+				clock-names = "apb_pclk", "dclk";
 				bus-width = <40>;
 			};
 
 			axim-ihb-rd@848000 {
 				compatible = "marvell,coresight-axim", "arm,primecell";
 				reg = <0x848000 0x1000>;
-				clocks = <&syscon 3>;
+				clocks = <&ap_syscon 3>;
 				clock-names = "apb_pclk";
 				bus-width = <40>;
 			};
@@ -228,7 +228,7 @@
 			axim-ihb-rd@849000 {
 				compatible = "marvell,coresight-axim", "arm,primecell";
 				reg = <0x849000 0x1000>;
-				clocks = <&syscon 3>;
+				clocks = <&ap_syscon 3>;
 				clock-names = "apb_pclk";
 				bus-width = <40>;
 			};
@@ -270,7 +270,7 @@
 				      <0x410000 0x1000>;
 				msi-parent = <&gic_v2m0>;
 				dma-coherent;
-				clocks = <&syscon 3>;
+				clocks = <&ap_syscon 3>;
 				status = "okay";
 			};
 
@@ -280,7 +280,7 @@
 				      <0x430000 0x1000>;
 				msi-parent = <&gic_v2m0>;
 				dma-coherent;
-				clocks = <&syscon 3>;
+				clocks = <&ap_syscon 3>;
 				status = "okay";
 			};
 
@@ -290,7 +290,7 @@
 				      <0x450000 0x1000>;
 				msi-parent = <&gic_v2m0>;
 				dma-coherent;
-				clocks = <&syscon 3>;
+				clocks = <&ap_syscon 3>;
 				status = "okay";
 			};
 
@@ -300,7 +300,7 @@
 				      <0x470000 0x1000>;
 				msi-parent = <&gic_v2m0>;
 				dma-coherent;
-				clocks = <&syscon 3>;
+				clocks = <&ap_syscon 3>;
 				status = "okay";
 			};
 
diff --git a/drivers/clk/mvebu/ap806-system-controller.c b/drivers/clk/mvebu/ap806-system-controller.c
index eb76005..9a5b473 100644
--- a/drivers/clk/mvebu/ap806-system-controller.c
+++ b/drivers/clk/mvebu/ap806-system-controller.c
@@ -34,7 +34,7 @@
 
 static int ap806_syscon_clk_probe(struct platform_device *pdev)
 {
-	unsigned int freq_mode, cpuclk_freq, hclk_freq;
+	unsigned int freq_mode, cpuclk_freq, dclk_freq;
 	const char *name, *fixedclk_name;
 	struct device_node *np = pdev->dev.of_node;
 	struct regmap *regmap;
@@ -97,46 +97,46 @@ static int ap806_syscon_clk_probe(struct platform_device *pdev)
 		dev_err(&pdev->dev, "invalid SAR value\n");
 	}
 
-	/* Get HCLK frequency */
+	/* Get DCLK frequency */
 	switch (freq_mode) {
 	case 0x4:
 	case 0x10:
 	case 0x14:
 	case 0x19 ... 0x1D:
-		hclk_freq = 400;
+		dclk_freq = 400;
 		break;
 	case 0xC:
-		hclk_freq = 600;
+		dclk_freq = 600;
 		break;
 	case 0xD:
 	case 0x16:
-		hclk_freq = 525;
+		dclk_freq = 525;
 		break;
 	case 0xB:
 	case 0xE:
 	case 0xF:
-		hclk_freq = 450;
+		dclk_freq = 450;
 		break;
 	case 0x12:
 	case 0x13:
 	case 0x17:
-		hclk_freq = 325;
+		dclk_freq = 325;
 		break;
 	case 0x11:
 	case 0x15:
-		hclk_freq = 800;
+		dclk_freq = 800;
 		break;
 	case 0x18:
-		hclk_freq = 650;
+		dclk_freq = 650;
 		break;
 	default:
-		hclk_freq = 0;
+		dclk_freq = 0;
 		pr_err("invalid SAR value\n");
 	}
 
 	/* Convert to hertz */
 	cpuclk_freq *= 1000 * 1000;
-	hclk_freq *= 1000 * 1000;
+	dclk_freq *= 1000 * 1000;
 
 	/* CPU clocks depend on the Sample At Reset configuration */
 	of_property_read_string_index(np, "clock-output-names",
-- 
1.7.9.5

