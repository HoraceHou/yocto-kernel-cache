From c262c014f78d08917575028bf3a4ae6d9bfd38a1 Mon Sep 17 00:00:00 2001
From: Yelena <yelena@marvell.com>
Date: Thu, 15 Dec 2016 14:11:28 +0200
Subject: [PATCH 0656/1345] mvneta: call to napi_gro_receive() on GRO enable
 only

commit  dc4afe0b509646651baa1e97daa64568adfb9105 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

Change-Id: I96abcea17218ee483de05b9cfa264f1147ce30a6
Signed-off-by: Yelena <yelena@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/34719
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Wilson Ding <dingwei@marvell.com>
Reviewed-by: Neta Zur Hershkovits <neta@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/net/ethernet/marvell/mvneta.c |   20 ++++++++++++++++----
 1 file changed, 16 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/marvell/mvneta.c b/drivers/net/ethernet/marvell/mvneta.c
index fe1fa2e..6614082 100644
--- a/drivers/net/ethernet/marvell/mvneta.c
+++ b/drivers/net/ethernet/marvell/mvneta.c
@@ -2168,7 +2168,10 @@ static int mvneta_rx_swbm(struct mvneta_port *pp, int rx_todo,
 
 			skb->protocol = eth_type_trans(skb, dev);
 			mvneta_rx_csum(pp, rx_status, skb);
-			napi_gro_receive(&port->napi, skb);
+			if (dev->features & NETIF_F_GRO)
+				napi_gro_receive(&port->napi, skb);
+			else
+				netif_receive_skb(skb);
 
 			rcvd_pkts++;
 			rcvd_bytes += rx_bytes;
@@ -2228,7 +2231,10 @@ static int mvneta_rx_swbm(struct mvneta_port *pp, int rx_todo,
 
 		mvneta_rx_csum(pp, rx_status, skb);
 
-		napi_gro_receive(&port->napi, skb);
+		if (dev->features & NETIF_F_GRO)
+			napi_gro_receive(&port->napi, skb);
+		else
+			netif_receive_skb(skb);
 	}
 
 	if (rcvd_pkts) {
@@ -2314,7 +2320,10 @@ static int mvneta_rx_hwbm(struct mvneta_port *pp, int rx_todo,
 
 			skb->protocol = eth_type_trans(skb, dev);
 			mvneta_rx_csum(pp, rx_status, skb);
-			napi_gro_receive(&port->napi, skb);
+			if (dev->features & NETIF_F_GRO)
+				napi_gro_receive(&port->napi, skb);
+			else
+				netif_receive_skb(skb);
 
 			rcvd_pkts++;
 			rcvd_bytes += rx_bytes;
@@ -2358,7 +2367,10 @@ static int mvneta_rx_hwbm(struct mvneta_port *pp, int rx_todo,
 
 		mvneta_rx_csum(pp, rx_status, skb);
 
-		napi_gro_receive(&port->napi, skb);
+		if (dev->features & NETIF_F_GRO)
+			napi_gro_receive(&port->napi, skb);
+		else
+			netif_receive_skb(skb);
 	}
 
 	if (rcvd_pkts) {
-- 
1.7.9.5

