From 6901a5bf739b4d6d6185dec2884e83800037f82a Mon Sep 17 00:00:00 2001
From: Omri Itach <omrii@marvell.com>
Date: Tue, 25 Jul 2017 15:45:33 +0300
Subject: [PATCH 1101/1345] dts: a8040: usb: enable USB Host0 on CP1 for OCP
 board

commit  f00bb0fef1b2644afaefbb828f42b7be812ac4a6 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

enable USB Host0 (USB2 with UTMI only), including VBUS support.

Change-Id: I62adcdec994a8c807d8e7bdba843169fd3fc9f22
Signed-off-by: Omri Itach <omrii@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/42122
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Hanna Hawa <hannah@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/marvell/armada-8040-ocp.dts |   35 +++++++++++++++++++----
 1 file changed, 30 insertions(+), 5 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/armada-8040-ocp.dts b/arch/arm64/boot/dts/marvell/armada-8040-ocp.dts
index 5bbc4af..3916afd 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-ocp.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-ocp.dts
@@ -57,7 +57,7 @@
 	};
 
 	ap806 {
-		config-space {
+		config-space@f0000000 {
 			serial@512000 {
 				status = "okay";
 			};
@@ -80,8 +80,14 @@
 		};
 	};
 
-	cpn-110-master {
-		config-space {
+	cp110-master {
+		config-space@f2000000 {
+			pinctrl@440000 {
+				xhci0_vbus_pins: xhci0-vbus-pins {
+					marvell,pins = "mpp47";
+					marvell,function = "gpio";
+				};
+			};
 			comphy0: comphy {
 				status = "okay";
 			};
@@ -111,14 +117,33 @@
 					status = "okay";
 				};
 			};
+			reg_usb3h0_vbus: usb3-vbus0 {
+				compatible = "regulator-fixed";
+				pinctrl-names = "default";
+				pinctrl-0 = <&xhci0_vbus_pins>;
+				regulator-name = "reg-usb3h0-vbus";
+				regulator-min-microvolt = <5000000>;
+				regulator-max-microvolt = <5000000>;
+				enable-active-high;
+				gpio = <&cpm_gpio1 15 GPIO_ACTIVE_HIGH>;
+				status = "okay";
+			};
 		};
 	};
 
-	cpn-110-slave {
-		config-space {
+	cp110-slave {
+		config-space@f4000000 {
 			comphy1: comphy {
 				status = "okay";
 			};
+			usb3h0_1: usb3@500000 {
+				usb-phy = <&usb3h0_phy>;
+				status = "okay";
+			};
+			usb3h0_phy: usb3_phy0 {
+				compatible = "usb-nop-xceiv";
+				vcc-supply = <&reg_usb3h0_vbus>;
+			};
 			gop {
 				emac0_1: mac0 {
 					phys = <&comphy0 4 COMPHY_SFI>;
-- 
1.7.9.5

