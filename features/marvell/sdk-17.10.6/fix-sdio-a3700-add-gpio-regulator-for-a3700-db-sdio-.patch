From 64501770178e61620eb23cb0e76fb2feb21b7fa7 Mon Sep 17 00:00:00 2001
From: jinghua <jinghua@marvell.com>
Date: Mon, 28 Mar 2016 21:19:49 +0800
Subject: [PATCH 0172/1345] fix: sdio: a3700: add gpio regulator for a3700 db
 sdio fdt node

commit  ac60faa895b28e7a4e58591781315b1aa26bc3e9 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

- add GPIO regulator to switch SDIO voltage for compatibility.
- some SD cards need 1.8V while others need 3.3V, depends on
  negotiation between SDIO controller and SD card.

Change-Id: Ib770ff502337c48359c3151eb2e33c661dc5430e
Signed-off-by: jinghua <jinghua@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/28571
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Omri Itach <omrii@marvell.com>
Reviewed-by: Nadav Haklai <nadavh@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/marvell/armada-3720-db.dts |   20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/arch/arm64/boot/dts/marvell/armada-3720-db.dts b/arch/arm64/boot/dts/marvell/armada-3720-db.dts
index f1c688d..54c47b6 100644
--- a/arch/arm64/boot/dts/marvell/armada-3720-db.dts
+++ b/arch/arm64/boot/dts/marvell/armada-3720-db.dts
@@ -76,6 +76,25 @@
 		compatible = "usb-nop-xceiv";
 		vcc-supply = <&exp_usb3_vbus>;
 	};
+
+	soc {
+		internal-regs {
+			vcc_sd_reg1: regulator@0 {
+				compatible = "regulator-gpio";
+				regulator-name = "vcc_sd1";
+				regulator-min-microvolt = <1800000>;
+				regulator-max-microvolt = <3300000>;
+				regulator-boot-on;
+
+				gpios = <&gpio_sb 22 GPIO_ACTIVE_HIGH>;
+				gpios-states = <0>;
+				states = <1800000 0x1
+					  3300000 0x0>;
+
+				enable-active-high;
+			};
+		};
+	};
 };
 
 &i2c0 {
@@ -174,6 +193,7 @@
 	vqmmc-supply = <&vcc_sd_reg1>;
 	mmc-pwrseq = <&sd_pwrseq>;
 	marvell,pad-type = "sd";
+	vqmmc-supply = <&vcc_sd_reg1>;
 	status = "okay";
 
 	pinctrl-names = "default";
-- 
1.7.9.5

