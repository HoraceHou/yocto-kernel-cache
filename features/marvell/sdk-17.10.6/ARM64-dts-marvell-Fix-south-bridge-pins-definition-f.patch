From ebb2db9dfd83cc1a09cabc8905a5d894c2815e40 Mon Sep 17 00:00:00 2001
From: Ken Ma <make@marvell.com>
Date: Mon, 28 Aug 2017 15:08:51 +0800
Subject: [PATCH 1204/1345] ARM64: dts: marvell: Fix south bridge pins
 definition for for Armada 37xx

commit  ce5c40cca069aac565bc9def2251eb68b64ab3f9 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

Previously pcie group used smi group selection bitmask(bit4) wrongly,
but smi group was not added in dts; and pcie pins are used as gpio
actually, so pcie group's function should be set as "gpio" but not
"pcie".
This patch adds smi pins group definition for Armada 37xx DB and
community boards and sets pcie group function to "gpio".

Change-Id: I7220197a63a9500d7b4d3742435b7bb43f1a293a
Signed-off-by: Ken Ma <make@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/43444
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Victor Gu <xigu@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 .../boot/dts/marvell/armada-3720-community.dts     |    2 ++
 arch/arm64/boot/dts/marvell/armada-3720-db.dts     |    2 +-
 arch/arm64/boot/dts/marvell/armada-37xx.dtsi       |    7 ++++++-
 3 files changed, 9 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/armada-3720-community.dts b/arch/arm64/boot/dts/marvell/armada-3720-community.dts
index cc68158..992c4c9 100644
--- a/arch/arm64/boot/dts/marvell/armada-3720-community.dts
+++ b/arch/arm64/boot/dts/marvell/armada-3720-community.dts
@@ -77,6 +77,8 @@
 			};
 
 			eth0: ethernet@30000 {
+				pinctrl-names = "default";
+				pinctrl-0 = <&rgmii_pins>, <&smi_pins>;
 				phy-mode = "rgmii-id";
 				status = "okay";
 				buffer-manager = <&bm>;
diff --git a/arch/arm64/boot/dts/marvell/armada-3720-db.dts b/arch/arm64/boot/dts/marvell/armada-3720-db.dts
index 81756eb..9d364f8 100644
--- a/arch/arm64/boot/dts/marvell/armada-3720-db.dts
+++ b/arch/arm64/boot/dts/marvell/armada-3720-db.dts
@@ -309,7 +309,7 @@
 
 &eth0 {
 	pinctrl-names = "default";
-	pinctrl-0 = <&rgmii_pins>;
+	pinctrl-0 = <&rgmii_pins>, <&smi_pins>;
 	phy-mode = "rgmii-id";
 	phy = <&phy0>;
 	status = "okay";
diff --git a/arch/arm64/boot/dts/marvell/armada-37xx.dtsi b/arch/arm64/boot/dts/marvell/armada-37xx.dtsi
index c82f9c6..c8b0009 100644
--- a/arch/arm64/boot/dts/marvell/armada-37xx.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-37xx.dtsi
@@ -288,6 +288,11 @@
 					function = "mii";
 				};
 
+				smi_pins: smi-pins {
+					groups = "smi";
+					function = "smi";
+				};
+
 				sdio_pins: sdio-pins {
 					groups = "sdio_sb";
 					function = "sdio";
@@ -295,7 +300,7 @@
 
 				pcie_pins: pcie-pins {
 					groups = "pcie1";
-					function = "pcie";
+					function = "gpio";
 				};
 			};
 
-- 
1.7.9.5

