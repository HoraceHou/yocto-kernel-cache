From 30df4f88a0e317815eb8f879cfa58577582e6733 Mon Sep 17 00:00:00 2001
From: Yelena <yelena@marvell.com>
Date: Wed, 16 Nov 2016 14:12:16 +0200
Subject: [PATCH 0618/1345] fix: mvneta: Fix exit on error in mvneta_probe()

commit  ad25ec82115fa876d6d1bab931d484cb38b8f89d from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

Add unregister_netdev on mvneta_probe error.

Fix for JIRA-SYSTEMSW-2947:
Kernel crash during boot if only SGMII1(neta1) is installed

Change-Id: I5a91325920184a3e8e2c68af21c20e5408d86c2f
Signed-off-by: Yelena <yelena@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/33843
Reviewed-by: Dmitri Epshtein <dima@marvell.com>
Tested-by: Neta Zur Hershkovits <neta@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/net/ethernet/marvell/mvneta.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/marvell/mvneta.c b/drivers/net/ethernet/marvell/mvneta.c
index b462afe..583a344 100644
--- a/drivers/net/ethernet/marvell/mvneta.c
+++ b/drivers/net/ethernet/marvell/mvneta.c
@@ -3767,7 +3767,7 @@ static int mvneta_open(struct net_device *dev)
 		err = mvneta_mdio_probe(pp);
 		if (err < 0) {
 			netdev_err(dev, "cannot probe MDIO bus\n");
-			goto err_free_stats;
+			goto err_free_dead_hp;
 		}
 	}
 
-- 
1.7.9.5

