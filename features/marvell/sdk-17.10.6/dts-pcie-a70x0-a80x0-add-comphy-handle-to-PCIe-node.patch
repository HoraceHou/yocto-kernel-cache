From 35245b7a0bc2b6b7bac6c76e5e47966f2a5d8c9a Mon Sep 17 00:00:00 2001
From: Evan Wang <xswang@marvell.com>
Date: Fri, 16 Jun 2017 16:09:30 +0800
Subject: [PATCH 1155/1345] dts: pcie: a70x0: a80x0: add comphy handle to PCIe
 node

commit  c4970954390eabd065aba57b45b4c39314a0165f from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

Change-Id: I290b9138f5f3f43669da554bb5f04456341691fd
Signed-off-by: Evan Wang <xswang@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/40541
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Igal Liberman <igall@marvell.com>
Reviewed-by: Hanna Hawa <hannah@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 arch/arm64/boot/dts/marvell/armada-7040-db-B.dts   |    8 ++++++++
 arch/arm64/boot/dts/marvell/armada-7040-db-C.dts   |    4 ++++
 arch/arm64/boot/dts/marvell/armada-7040-db-D.dts   |    4 ++++
 arch/arm64/boot/dts/marvell/armada-7040-db-E.dts   |    4 ++++
 .../arm64/boot/dts/marvell/armada-7040-db-nand.dts |    4 ++++
 .../dts/marvell/armada-7040-db-pp2-vanilla.dts     |    2 ++
 arch/arm64/boot/dts/marvell/armada-7040-db.dts     |    2 ++
 arch/arm64/boot/dts/marvell/armada-7040-pd.dts     |    2 ++
 arch/arm64/boot/dts/marvell/armada-8040-db-B.dts   |   14 ++++++++++++++
 arch/arm64/boot/dts/marvell/armada-8040-db-C.dts   |   10 ++++++++++
 arch/arm64/boot/dts/marvell/armada-8040-db-D.dts   |   10 ++++++++++
 arch/arm64/boot/dts/marvell/armada-8040-db-E.dts   |   10 ++++++++++
 .../dts/marvell/armada-8040-db-pp2-vanilla.dts     |   10 ++++++++++
 arch/arm64/boot/dts/marvell/armada-8040-db.dts     |   16 +++++++++++++---
 .../dts/marvell/armada-8040-mcbin-pp2-vanilla.dts  |    6 ++++++
 arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts  |    6 ++++++
 16 files changed, 109 insertions(+), 3 deletions(-)

diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db-B.dts b/arch/arm64/boot/dts/marvell/armada-7040-db-B.dts
index 1668612..ac1417a 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db-B.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db-B.dts
@@ -170,12 +170,20 @@
 		pcie@0x600000 {
 			status = "okay";
 			num-lanes = <4>;
+			phys = <&comphy0 0 COMPHY_PCIE0
+				&comphy0 1 COMPHY_PCIE0
+				&comphy0 2 COMPHY_PCIE0
+				&comphy0 3 COMPHY_PCIE0
+				>;
+			phy-names = "pcie-phy0", "pcie-phy1", "pcie-phy2", "pcie-phy3";
 		};
 		pcie@0x620000 {
 			status = "disabled";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db-C.dts b/arch/arm64/boot/dts/marvell/armada-7040-db-C.dts
index 4ee2792..f16d47b 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db-C.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db-C.dts
@@ -189,12 +189,16 @@
 
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x620000{
 			status = "disabled";
 		};
 		pcie@0x600000{
 			status="okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db-D.dts b/arch/arm64/boot/dts/marvell/armada-7040-db-D.dts
index c4a3d4c..8a8e94a 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db-D.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db-D.dts
@@ -196,12 +196,16 @@
 
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x620000 {
 			status = "disabled";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db-E.dts b/arch/arm64/boot/dts/marvell/armada-7040-db-E.dts
index 9a19b61..16381e1 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db-E.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db-E.dts
@@ -168,12 +168,16 @@
 
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x620000 {
 			status = "disabled";
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db-nand.dts b/arch/arm64/boot/dts/marvell/armada-7040-db-nand.dts
index 8aee146..55a0545 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db-nand.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db-nand.dts
@@ -169,9 +169,13 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db-pp2-vanilla.dts b/arch/arm64/boot/dts/marvell/armada-7040-db-pp2-vanilla.dts
index 5b67d5b..3462379 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db-pp2-vanilla.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db-pp2-vanilla.dts
@@ -205,6 +205,8 @@
 
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-db.dts b/arch/arm64/boot/dts/marvell/armada-7040-db.dts
index 9b5aff2..2efc469 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-db.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-db.dts
@@ -170,6 +170,8 @@
 
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-pd.dts b/arch/arm64/boot/dts/marvell/armada-7040-pd.dts
index 95fffb4..b8f2c71 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-pd.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-pd.dts
@@ -260,6 +260,8 @@
 
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-db-B.dts b/arch/arm64/boot/dts/marvell/armada-8040-db-B.dts
index 8817164..264dc82 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-db-B.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-db-B.dts
@@ -142,9 +142,17 @@
 		pcie@0x600000 {
 			status = "okay";
 			num-lanes = <4>;
+			phys = <&comphy0 0 COMPHY_PCIE0
+				&comphy0 1 COMPHY_PCIE0
+				&comphy0 2 COMPHY_PCIE0
+				&comphy0 3 COMPHY_PCIE0
+				>;
+			phy-names = "pcie-phy0", "pcie-phy1", "pcie-phy2", "pcie-phy3";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 	cpn-110-slave {
@@ -214,12 +222,18 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy1 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x620000 {
 			status = "okay";
+			phys = <&comphy1 4 COMPHY_PCIE1>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy1 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-db-C.dts b/arch/arm64/boot/dts/marvell/armada-8040-db-C.dts
index 04e309b..e32dca0 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-db-C.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-db-C.dts
@@ -156,9 +156,13 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 	cpn-110-slave {
@@ -244,12 +248,18 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy1 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x620000 {
 			status = "okay";
+			phys = <&comphy1 4 COMPHY_PCIE1>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy1 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-db-D.dts b/arch/arm64/boot/dts/marvell/armada-8040-db-D.dts
index 30d87ee..a02dba9 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-db-D.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-db-D.dts
@@ -157,9 +157,13 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 	cpn-110-slave {
@@ -221,12 +225,18 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy1 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x620000 {
 			status = "okay";
+			phys = <&comphy1 4 COMPHY_PCIE1>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy1 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-db-E.dts b/arch/arm64/boot/dts/marvell/armada-8040-db-E.dts
index 15dda62..11bef47 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-db-E.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-db-E.dts
@@ -159,9 +159,13 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 	cpn-110-slave {
@@ -236,12 +240,18 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy1 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x620000 {
 			status = "okay";
+			phys = <&comphy1 4 COMPHY_PCIE1>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy1 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-db-pp2-vanilla.dts b/arch/arm64/boot/dts/marvell/armada-8040-db-pp2-vanilla.dts
index 019fc74..3731296 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-db-pp2-vanilla.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-db-pp2-vanilla.dts
@@ -182,9 +182,13 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 	cpn-110-slave {
@@ -274,12 +278,18 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy1 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x620000 {
 			status = "okay";
+			phys = <&comphy1 4 COMPHY_PCIE1>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy1 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-db.dts b/arch/arm64/boot/dts/marvell/armada-8040-db.dts
index cbdc60c..fbcd571 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-db.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-db.dts
@@ -116,9 +116,13 @@
 		};
 		pcie@0x600000 {
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0>;
+			phy-names = "pcie-phy0";
 		};
 		pcie@0x640000 {
 			status = "okay";
+			phys = <&comphy0 5 COMPHY_PCIE2>;
+			phy-names = "pcie-phy0";
 		};
 
 		cpm_usb3h0_phy: cpm_usb3_phy0 {
@@ -467,10 +471,16 @@
 
 &cps_pcie0 {
 	status = "okay";
-}
+	phys = <&comphy1 0 COMPHY_PCIE0>;
+	phy-names = "pcie-phy0";
+};
 &cps_pcie1 {
 	status = "okay";
-}
+	phys = <&comphy1 4 COMPHY_PCIE1>;
+	phy-names = "pcie-phy0";
+};
 &cps_pcie2 {
 	status = "okay";
-}
+	phys = <&comphy1 5 COMPHY_PCIE2>;
+	phy-names = "pcie-phy0";
+};
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts b/arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts
index 29d9e10..56aa640 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-mcbin-pp2-vanilla.dts
@@ -205,6 +205,12 @@
 		pcie@0x600000 {
 			num-lanes = <4>;
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0
+				&comphy0 1 COMPHY_PCIE0
+				&comphy0 2 COMPHY_PCIE0
+				&comphy0 3 COMPHY_PCIE0
+				>;
+			phy-names = "pcie-phy0", "pcie-phy1", "pcie-phy2", "pcie-phy3";
 		};
 		reg_usb3h0_vbus: usb3-vbus0 {
 			compatible = "regulator-fixed";
diff --git a/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts b/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
index 4e80672..4cc60f3 100644
--- a/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
+++ b/arch/arm64/boot/dts/marvell/armada-8040-mcbin.dts
@@ -126,6 +126,12 @@
 		pcie@0x600000 {
 			num-lanes = <4>;
 			status = "okay";
+			phys = <&comphy0 0 COMPHY_PCIE0
+				&comphy0 1 COMPHY_PCIE0
+				&comphy0 2 COMPHY_PCIE0
+				&comphy0 3 COMPHY_PCIE0
+				>;
+			phy-names = "pcie-phy0", "pcie-phy1", "pcie-phy2", "pcie-phy3";
 		};
 		vccq_sdio_reg: regulator@1 {
 			compatible = "regulator-fixed";
-- 
1.7.9.5

