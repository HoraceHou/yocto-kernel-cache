From d1f84062fddcf67d61f4854b9e246cfa9e05d911 Mon Sep 17 00:00:00 2001
From: Yelena Krivosheev <yelena@marvell.com>
Date: Thu, 11 May 2017 14:16:14 +0300
Subject: [PATCH 1013/1345] mvneta: packet processing with low memory

commit  00be2585dfbc30ae57a88d02ae64759f6726d4b8 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

Change-Id: I6c28bada4757016b21ebbe47bb66e6c056d29590
Signed-off-by: Yelena Krivosheev <yelena@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/39374
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Reviewed-by: Neta Zur Hershkovits <neta@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/39677
Reviewed-by: Victor Gu <xigu@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/net/ethernet/marvell/mvneta.c |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/marvell/mvneta.c b/drivers/net/ethernet/marvell/mvneta.c
index 10ffe03..2bdf3ae 100644
--- a/drivers/net/ethernet/marvell/mvneta.c
+++ b/drivers/net/ethernet/marvell/mvneta.c
@@ -2238,10 +2238,11 @@ static int mvneta_rx_swbm(struct mvneta_port *pp, int rx_todo,
 		if (!atomic_read(&rxq->refill_stop)) {
 			err = mvneta_rx_refill(pp, rx_desc, rxq);
 			if (err) {
-				netdev_err(dev, "Linux processing - Can't refill\n");
 				/* set refill stop flag */
 				atomic_set(&rxq->refill_stop, 1);
-
+				netdev_dbg(dev, "Linux processing - Can't refill queue %d\n",
+					   rxq->id);
+				rx_copybreak = 0;
 				atomic_inc(&rxq->missed);
 
 				/* record the first rx desc refilled failure */
-- 
1.7.9.5

