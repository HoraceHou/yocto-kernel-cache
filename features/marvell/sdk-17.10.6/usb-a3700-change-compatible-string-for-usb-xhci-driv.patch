From f4f3f7025c94521a6eb3c859b96f12e638908224 Mon Sep 17 00:00:00 2001
From: jinghua <xigu@marvell.com>
Date: Thu, 13 Apr 2017 20:48:24 +0800
Subject: [PATCH 0973/1345] usb: a3700: change compatible string for usb xhci
 driver

commit  27b8dadf880cc22054f14bb4c767ac4436d4ded3 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

- A new compatible string for A3700 was introduced in xhci plat
  driver as "marvell,armada-3700-xhci-otg", but actually there
  is no full OTG support in A3700, just a usb_id irq to detect
  usb_id switch between usb host and device.
- So this patch changes the compatible string to
  "marvell,armada-3700-xhci", to avoid confusing..

Change-Id: I4f8189c74552630f82a7936b626ea2a7045f6af4
Signed-off-by: jinghua <xigu@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/38674
Tested-by: Hua Jing <jinghua@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/38754
Tested-by: iSoC Platform CI <ykjenk@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 .../devicetree/bindings/usb/armada3700-usb-phy.txt |    2 +-
 Documentation/devicetree/bindings/usb/usb-xhci.txt |    4 ++--
 drivers/usb/host/xhci-plat.c                       |    6 +++---
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/Documentation/devicetree/bindings/usb/armada3700-usb-phy.txt b/Documentation/devicetree/bindings/usb/armada3700-usb-phy.txt
index 59a8743..9e3ed39 100644
--- a/Documentation/devicetree/bindings/usb/armada3700-usb-phy.txt
+++ b/Documentation/devicetree/bindings/usb/armada3700-usb-phy.txt
@@ -25,7 +25,7 @@ Optional properties:
 
 USB OTG mode example:
 	usb3@58000 {
-		compatible = "marvell,armada-3700-xhci-otg";
+		compatible = "marvell,armada-3700-xhci";
 		status = "okay";
 		usb-phy = <&otg_phy>;
 	};
diff --git a/Documentation/devicetree/bindings/usb/usb-xhci.txt b/Documentation/devicetree/bindings/usb/usb-xhci.txt
index 38ba6f3..0418546 100644
--- a/Documentation/devicetree/bindings/usb/usb-xhci.txt
+++ b/Documentation/devicetree/bindings/usb/usb-xhci.txt
@@ -4,7 +4,7 @@ Required properties:
   - compatible: should be one or more of
 
     - "generic-xhci" for generic XHCI device
-    - "marvell,armada3700-xhci" for Armada 37xx SoCs
+    - "marvell,armada-3700-xhci" for Armada 37xx SoCs
     - "marvell,armada-375-xhci" for Armada 375 SoCs
     - "marvell,armada-380-xhci" for Armada 38x SoCs
     - "renesas,xhci-r8a7790" for r8a7790 SoC
@@ -58,4 +58,4 @@ Examples:
 		phy-names = "usb2", "usb3";
 		separated-phys-for-usb2-usb3;
 		needs-reset-on-resume;
-	};
\ No newline at end of file
+	};
diff --git a/drivers/usb/host/xhci-plat.c b/drivers/usb/host/xhci-plat.c
index b63437c..fcb9062 100644
--- a/drivers/usb/host/xhci-plat.c
+++ b/drivers/usb/host/xhci-plat.c
@@ -130,7 +130,7 @@ static int xhci_plat_start(struct usb_hcd *hcd)
 	}, {
 		.compatible = "xhci-platform",
 	}, {
-		.compatible = "marvell,armada-3700-xhci-otg"
+		.compatible = "marvell,armada-3700-xhci"
 	}, {
 		.compatible = "marvell,armada-375-xhci",
 		.data = &xhci_plat_marvell_armada,
@@ -331,7 +331,7 @@ static int xhci_plat_probe(struct platform_device *pdev)
 	}
 
 	if (of_device_is_compatible(pdev->dev.of_node,
-				    "marvell,armada-3700-xhci-otg")) {
+				    "marvell,armada-3700-xhci")) {
 		/* If Armada3700 needs to enable OTG support, register XHCI
 		 * driver to OTG PHY, and wait for it to call usb_add_hcd
 		 * at the right time (start working in USB Host mode).
@@ -449,7 +449,7 @@ static int xhci_plat_remove(struct platform_device *dev)
 	xhci->xhc_state |= XHCI_STATE_REMOVING;
 
 	if (of_device_is_compatible(dev->dev.of_node,
-				    "marvell,armada-3700-xhci-otg")) {
+				    "marvell,armada-3700-xhci")) {
 		otg_set_host(hcd->usb_phy->otg, NULL);
 	} else {
 		usb_remove_hcd(xhci->shared_hcd);
-- 
1.7.9.5

