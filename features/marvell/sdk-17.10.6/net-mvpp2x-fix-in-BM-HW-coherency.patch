From 077adf7f13855510ac2496282a5fc12b09299132 Mon Sep 17 00:00:00 2001
From: Stefan Chulski <stefanc@marvell.com>
Date: Tue, 28 Jun 2016 18:26:22 +0300
Subject: [PATCH 0306/1345] net: mvpp2x: fix in BM HW coherency

commit  42bb330aace09dd8d3927d60a4c198aa411e5d11 from
https://github.com/MarvellEmbeddedProcessors/linux-marvell.git

- use only one if (is_device_dma_coherent())

Change-Id: Ic7cd5bcc6ea600e86a6605909b23060d37ac3bf5
Signed-off-by: Stefan Chulski <stefanc@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/30801
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Hanna Hawa <hannah@marvell.com>
Reviewed-by: Yuval Caduri <cyuval@marvell.com>
Signed-off-by: Meng Li <Meng.Li@windriver.com>
---
 drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c |   16 +++++++++-------
 1 file changed, 9 insertions(+), 7 deletions(-)

diff --git a/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c b/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c
index 42cd271..329d105 100644
--- a/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c
+++ b/drivers/net/ethernet/marvell/mvpp2x/mv_pp2x_main.c
@@ -4263,18 +4263,13 @@ static int mv_pp2x_init(struct platform_device *pdev, struct mv_pp2x *priv)
 	/*AXI Bridge Configuration */
 
 	if (is_device_dma_coherent(&pdev->dev)) {
+
+		/* BM */
 		mv_pp2x_write(hw, MVPP22_AXI_BM_WR_ATTR_REG,
 			MVPP22_AXI_ATTR_HW_COH_WRITE);
 		mv_pp2x_write(hw, MVPP22_AXI_BM_RD_ATTR_REG,
 			MVPP22_AXI_ATTR_HW_COH_READ);
-	} else {
-		mv_pp2x_write(hw, MVPP22_AXI_BM_WR_ATTR_REG,
-			MVPP22_AXI_ATTR_NON_CACHE);
-		mv_pp2x_write(hw, MVPP22_AXI_BM_RD_ATTR_REG,
-			MVPP22_AXI_ATTR_NON_CACHE);
-	}
 
-	if (is_device_dma_coherent(&pdev->dev)) {
 		/* Descriptors */
 		mv_pp2x_write(hw, MVPP22_AXI_AGGRQ_DESCR_RD_ATTR_REG,
 			MVPP22_AXI_ATTR_HW_COH_READ);
@@ -4291,6 +4286,13 @@ static int mv_pp2x_init(struct platform_device *pdev, struct mv_pp2x *priv)
 		mv_pp2x_write(hw, MVPP22_AXI_RX_DATA_WR_ATTR_REG,
 			MVPP22_AXI_ATTR_HW_COH_WRITE);
 	} else {
+
+		/* BM */
+		mv_pp2x_write(hw, MVPP22_AXI_BM_WR_ATTR_REG,
+			MVPP22_AXI_ATTR_NON_CACHE);
+		mv_pp2x_write(hw, MVPP22_AXI_BM_RD_ATTR_REG,
+			MVPP22_AXI_ATTR_NON_CACHE);
+
 		/* Descriptors */
 		mv_pp2x_write(hw, MVPP22_AXI_AGGRQ_DESCR_RD_ATTR_REG,
 			MVPP22_AXI_ATTR_NON_CACHE);
-- 
1.7.9.5

